<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xsl" href="https://kkwalking.github.com/person-database/person-database/rss.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <atom:link href="https://kkwalking.github.com/person-database/person-database/rss.xml" rel="self" type="application/rss+xml"/>
    <title>zzkçš„ä¸ªäººçŸ¥è¯†åº“</title>
    <link>https://kkwalking.github.com/person-database/person-database/</link>
    <description>æ¬¢è¿æ¥åˆ°zzkçš„ä¸ªäººçŸ¥è¯†åº“</description>
    <language>zh-CN</language>
    <pubDate>Mon, 27 May 2024 07:35:30 GMT</pubDate>
    <lastBuildDate>Mon, 27 May 2024 07:35:30 GMT</lastBuildDate>
    <generator>@vuepress/plugin-feed</generator>
    <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
    <category>ä¸­é—´ä»¶</category>
    <category>é¡¹ç›®å®è·µ</category>
    <item>
      <title>OkHttpå¼€å¯çº¿ç¨‹æ± å¤ç”¨è¿æ¥å¯¼è‡´çš„EOFExceptionè§£å†³æ–¹æ¡ˆ</title>
      <link>https://kkwalking.github.com/person-database/person-database/java/okhttp-conncection-pool-problem.html</link>
      <guid>https://kkwalking.github.com/person-database/person-database/java/okhttp-conncection-pool-problem.html</guid>
      <source url="https://kkwalking.github.com/person-database/person-database/rss.xml">OkHttpå¼€å¯çº¿ç¨‹æ± å¤ç”¨è¿æ¥å¯¼è‡´çš„EOFExceptionè§£å†³æ–¹æ¡ˆ</source>
      <description>æ‹‰ä¸ªStar å¦‚æœæœ¬çŸ¥è¯†åº“çš„å†…å®¹å¸®åŠ©åˆ°ä½ ï¼Œè¿˜è¯·ç‚¹ä¸ªå…è´¹çš„Starï¼Œæ„Ÿè°¢ã€‚ä¼ é€é—¨ï¼šGitHub ä½¿ç”¨OkHttpæ¥è¿›è¡Œhttpè°ƒç”¨ï¼Œé€šå¸¸ä¼šä½¿ç”¨æ± åŒ–æœºåˆ¶ã€‚å¤§å®¶éƒ½çŸ¥é“ï¼ŒHttpæ˜¯åŸºäºTCPçš„ï¼Œè€ŒTCPæ˜¯é¢å‘è¿æ¥çš„ã€‚TCPé“¾æ¥çš„å»ºç«‹éœ€è¦ç»å†ä¸‰æ¬¡æ¡æ‰‹ï¼ŒTCPé“¾æ¥çš„é‡Šæ”¾éœ€è¦ç»è¿‡å››æ¬¡æŒ¥æ‰‹ã€‚å› è€Œï¼Œè¿æ¥çš„å»ºç«‹æ¯”è¾ƒè€—è´¹æ—¶é—´å’Œèµ„æºã€‚æ‰€ä»¥é€šå¸¸ä¼šå°†è¿™äº›é“¾æ¥è¿›è¡Œå¤ç”¨ï¼Œè¡¨ç°åœ¨Htt...</description>
      <pubDate>Mon, 27 May 2024 00:00:00 GMT</pubDate>
      <content:encoded><![CDATA[<div class="hint-container tip">
<p class="hint-container-title">æ‹‰ä¸ªStar</p>
<ul>
<li>å¦‚æœ<a href="https://github.com/kkwalking/person-database" target="blank">æœ¬çŸ¥è¯†åº“</a>çš„å†…å®¹å¸®åŠ©åˆ°ä½ ï¼Œè¿˜è¯·ç‚¹ä¸ªå…è´¹çš„Starï¼Œæ„Ÿè°¢ã€‚ä¼ é€é—¨ï¼š<a href="https://github.com/kkwalking/person-database" target="blank">GitHub</a></li>
</ul>
</div>
<p>ä½¿ç”¨OkHttpæ¥è¿›è¡Œhttpè°ƒç”¨ï¼Œé€šå¸¸ä¼šä½¿ç”¨æ± åŒ–æœºåˆ¶ã€‚å¤§å®¶éƒ½çŸ¥é“ï¼ŒHttpæ˜¯åŸºäºTCPçš„ï¼Œè€ŒTCPæ˜¯é¢å‘è¿æ¥çš„ã€‚TCPé“¾æ¥çš„å»ºç«‹éœ€è¦ç»å†ä¸‰æ¬¡æ¡æ‰‹ï¼ŒTCPé“¾æ¥çš„é‡Šæ”¾éœ€è¦ç»è¿‡å››æ¬¡æŒ¥æ‰‹ã€‚å› è€Œï¼Œè¿æ¥çš„å»ºç«‹æ¯”è¾ƒè€—è´¹æ—¶é—´å’Œèµ„æºã€‚æ‰€ä»¥é€šå¸¸ä¼šå°†è¿™äº›é“¾æ¥è¿›è¡Œå¤ç”¨ï¼Œè¡¨ç°åœ¨Httpå±‚é¢å°±æ˜¯ä½¿ç”¨Connection:keep-aliveï¼Œå†åœ¨ä»£ç ä¸­å°†è¿™äº›å·²ç»å»ºç«‹çš„è¿æ¥ä¿å­˜èµ·æ¥ï¼Œåç»­å¦‚æœæ˜¯åŒä¸€ä¸ªä¸»æœºåœ°å€çš„ä¾¿å¯ä»¥å¤ç”¨ã€‚è¿™å°±æ˜¯OKHttpçš„è¿æ¥æ± æœºåˆ¶ã€‚</p>
<p>æœ€è¿‘åœ¨Spring Booté¡¹ç›®ä¸­ï¼Œæˆ‘ä¹Ÿæ˜¯ç”¨äº†OkHttpæ¥å‘é€httpè¯·æ±‚è°ƒç”¨ï¼Œå¹¶é…ç½®äº†ä¸€ä¸ªè¿æ¥æ± ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OkHttpConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>  
    <span class="token keyword">public</span> <span class="token class-name">ConnectionPool</span> <span class="token function">pool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionPool</span><span class="token punctuation">(</span>  
        <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">5L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MINUTES</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>  
    <span class="token keyword">public</span> <span class="token class-name">OkHttpClient</span> <span class="token function">okHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">OkHttpClient<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
        <span class="token punctuation">.</span><span class="token function">sslSocketFactory</span><span class="token punctuation">(</span><span class="token function">sslSocketFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">x509TrustManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
        <span class="token comment">// é…ç½®è¿æ¥æ± ,å¤ç”¨connection  </span>
        <span class="token punctuation">.</span><span class="token function">connectionPool</span><span class="token punctuation">(</span><span class="token function">pool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
        <span class="token punctuation">.</span><span class="token function">connectTimeout</span><span class="token punctuation">(</span><span class="token number">30L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span>  
        <span class="token punctuation">.</span><span class="token function">readTimeout</span><span class="token punctuation">(</span><span class="token number">30L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span>  
        <span class="token punctuation">.</span><span class="token function">writeTimeout</span><span class="token punctuation">(</span><span class="token number">30L</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span>  
        <span class="token punctuation">.</span><span class="token function">retryOnConnectionFailure</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>  
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>


</code></pre></div><p>ç„¶è€Œåœ¨ä½¿ç”¨é¡¹ç›®è¿‡ç¨‹ä¸­ï¼Œå‘ç°æ—¶ä¸æ—¶è¯·æ±‚ä¼šå‡ºç°å¤±è´¥ï¼Œæ–¹ä¾¿å¤§å®¶æœç´¢åˆ°ï¼Œæˆ‘æŠŠå¼‚å¸¸ç»“æœæ”¾ä¸Šæ¥ï¼š</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>IOException</span><span class="token operator">:</span> unexpected end of stream on http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>xxx<span class="token punctuation">.</span>xxx<span class="token operator">/</span>api<span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	at <span class="token class-name"><span class="token namespace">okhttp3<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>http1<span class="token punctuation">.</span></span>Http1ExchangeCodec</span><span class="token punctuation">.</span><span class="token function">readResponseHeaders</span><span class="token punctuation">(</span><span class="token class-name">Http1ExchangeCodec</span><span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">202</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">okhttp3<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>connection<span class="token punctuation">.</span></span>Exchange</span><span class="token punctuation">.</span><span class="token function">readResponseHeaders</span><span class="token punctuation">(</span><span class="token class-name">Exchange</span><span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">106</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">okhttp3<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>CallServerInterceptor</span><span class="token punctuation">.</span><span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">CallServerInterceptor</span><span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">79</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">okhttp3<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>RealInterceptorChain</span><span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token class-name">RealInterceptorChain</span><span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">109</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">okhttp3<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>connection<span class="token punctuation">.</span></span>ConnectInterceptor</span><span class="token punctuation">.</span><span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">ConnectInterceptor</span><span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">okhttp3<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>RealInterceptorChain</span><span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token class-name">RealInterceptorChain</span><span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">109</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">okhttp3<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>cache<span class="token punctuation">.</span></span>CacheInterceptor</span><span class="token punctuation">.</span><span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">CacheInterceptor</span><span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">95</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">okhttp3<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>RealInterceptorChain</span><span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token class-name">RealInterceptorChain</span><span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">109</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">okhttp3<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>BridgeInterceptor</span><span class="token punctuation">.</span><span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">BridgeInterceptor</span><span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">83</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">okhttp3<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>RealInterceptorChain</span><span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token class-name">RealInterceptorChain</span><span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">109</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">okhttp3<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>RetryAndFollowUpInterceptor</span><span class="token punctuation">.</span><span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">RetryAndFollowUpInterceptor</span><span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">76</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">okhttp3<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>RealInterceptorChain</span><span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token class-name">RealInterceptorChain</span><span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">109</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">okhttp3<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>connection<span class="token punctuation">.</span></span>RealCall</span><span class="token punctuation">.</span>getResponseWithInterceptorChain$<span class="token function">okhttp</span><span class="token punctuation">(</span><span class="token class-name">RealCall</span><span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">201</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">okhttp3<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>connection<span class="token punctuation">.</span></span>RealCall</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">RealCall</span><span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">154</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>eshore<span class="token punctuation">.</span>quanmeiti<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span>OkHttpService</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">OkHttpService</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">194</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>eshore<span class="token punctuation">.</span>quanmeiti<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span>OkHttpService</span><span class="token punctuation">.</span><span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">OkHttpService</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">71</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>eshore<span class="token punctuation">.</span>quanmeiti<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>common<span class="token punctuation">.</span>pool<span class="token punctuation">.</span></span>GatewayTask</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">GatewayTask</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">73</span><span class="token punctuation">)</span>
	at java<span class="token punctuation">.</span>base<span class="token operator">/</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>ThreadPoolExecutor</span><span class="token punctuation">.</span><span class="token function">runWorker</span><span class="token punctuation">(</span><span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1128</span><span class="token punctuation">)</span>
	at java<span class="token punctuation">.</span>base<span class="token operator">/</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>ThreadPoolExecutor</span>$<span class="token class-name">Worker</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">628</span><span class="token punctuation">)</span>
	at java<span class="token punctuation">.</span>base<span class="token operator">/</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Thread</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">834</span><span class="token punctuation">)</span>
<span class="token class-name">Caused</span> by<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>EOFException</span><span class="token operator">:</span> \n not found<span class="token operator">:</span> limit<span class="token operator">=</span><span class="token number">0</span> content<span class="token operator">=</span>â€¦
	at <span class="token class-name"><span class="token namespace">okio<span class="token punctuation">.</span></span>RealBufferedSource</span><span class="token punctuation">.</span><span class="token function">readUtf8LineStrict</span><span class="token punctuation">(</span><span class="token class-name">RealBufferedSource</span><span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">332</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">okhttp3<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>http1<span class="token punctuation">.</span></span>HeadersReader</span><span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token class-name">HeadersReader</span><span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">29</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">okhttp3<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>http1<span class="token punctuation">.</span></span>Http1ExchangeCodec</span><span class="token punctuation">.</span><span class="token function">readResponseHeaders</span><span class="token punctuation">(</span><span class="token class-name">Http1ExchangeCodec</span><span class="token punctuation">.</span>kt<span class="token operator">:</span><span class="token number">178</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token number">19</span> more
</code></pre></div><p>åœ¨stackoverflowä¸ŠæŸ¥åˆ°äº†åŸå› ï¼Œå¤§æ¦‚å°±æ˜¯æœåŠ¡ç«¯ç«¯(ç›¸å¯¹æ¥è¯´æˆ‘ä»¬æ˜¯å®¢æˆ·ç«¯)æ²¡æœ‰æ­£ç¡®å¤„ç†<code>Connection:keep-alive</code>é•¿è¿æ¥ã€‚æœåŠ¡ç«¯é‚£è¾¹å¼‚å¸¸å…³é—­äº†è¿™æ¡TCPè¿æ¥ï¼Œå¯¼è‡´äº†æˆ‘ä»¬è¿™è¾¹è¯·æ±‚å°±å‡ºé”™äº†ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ã€‚</p>
<p>ç¬¬ä¸€ç§ï¼šé‚£æˆ‘ä»¬ä¸ç”¨é•¿è¿æ¥äº†ï¼Œå‘é€è¯·æ±‚çš„æ—¶å€™ä¸»åŠ¨æ·»åŠ ä¸Šè¯·æ±‚å¤´<code>Connection:close</code>, ä¸€æ¡è¿æ¥å°±å˜æˆä¸€æ¬¡æ€§çš„ï¼Œå‘å®Œè¯·æ±‚å°±å…³é—­ã€‚</p>
<p>ä¸€å¼€å§‹æˆ‘ç”¨çš„è¿™ç§æ–¹æ¡ˆï¼Œé—®é¢˜æ˜¯è§£å†³äº†ã€‚åé¢è½¬å¿µä¸€æƒ³ï¼Œé‚£æˆ‘çš„è¿æ¥æ± å°±åºŸäº†å‘€ï¼Œæ¯æ¬¡è¯·æ±‚å®Œéƒ½æŠŠè¿æ¥é‡Šæ”¾æ‰ï¼Œä¸‹æ¬¡è¯·æ±‚å°±è¦é‡æ–°å»ºç«‹ä¸€æ¡è¿æ¥ï¼Œè¿æ¥æ± çš„ä½œç”¨å°±æ— äº†ã€‚</p>
<p>å› æ­¤ï¼Œåé¢æˆ‘é‡‡ç”¨äº†ç¬¬äºŒç§æ–¹æ¡ˆã€‚</p>
<p>ç¬¬äºŒç§æ–¹æ¡ˆï¼šå°†OKHttpClientçš„ä¸€é¡¹é…ç½®retryOnConnectionFailureè®¾ç½®ä¸ºtrueã€‚è¯¥é…ç½®çš„æ„æ€æ˜¯å¯ç”¨è¿æ¥å¤±è´¥é‡è¯•ã€‚</p>
<p>ä»£ç å¦‚ä¸‹:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code>    <span class="token annotation punctuation">@Bean</span>  
    <span class="token keyword">public</span> <span class="token class-name">OkHttpClient</span> <span class="token function">okHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">OkHttpClient<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
        <span class="token punctuation">.</span><span class="token function">sslSocketFactory</span><span class="token punctuation">(</span><span class="token function">sslSocketFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">x509TrustManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
        <span class="token comment">// é…ç½®è¿æ¥æ± ,å¤ç”¨connection  </span>
        <span class="token punctuation">.</span><span class="token function">connectionPool</span><span class="token punctuation">(</span><span class="token function">pool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
        <span class="token punctuation">.</span><span class="token function">connectTimeout</span><span class="token punctuation">(</span><span class="token number">30L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span>  
        <span class="token punctuation">.</span><span class="token function">readTimeout</span><span class="token punctuation">(</span><span class="token number">30L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span>  
        <span class="token punctuation">.</span><span class="token function">writeTimeout</span><span class="token punctuation">(</span><span class="token number">30L</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span>  
        <span class="token punctuation">.</span><span class="token function">retryOnConnectionFailure</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>  
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
	<span class="token punctuation">}</span>
</code></pre></div><p>å…¶å®è¯¥é…ç½®æ˜¯é»˜è®¤å¯ç”¨çš„ï¼Œå¥ˆä½•æˆ‘ä¸€å¼€å§‹é…ç½®çš„æ—¶å€™ä¸»åŠ¨ç»™å…³é—­äº† ğŸ˜ƒ</p>
<p>é…ç½®ä¹‹åï¼Œæˆ‘ä»¬è¿˜æ˜¯èƒ½ç”¨å¯ç”¨é•¿è¿æ¥ï¼Œå› æ­¤å¯ç”¨è¿æ¥æ± æ˜¯æœ‰æ„ä¹‰çš„ã€‚å½“å¶å°”å‡ºç°ç”±äºæœåŠ¡ç«¯é”™è¯¯å…³é—­è¯¥TCPè¿æ¥æ—¶ï¼ŒOkHttpä¾¿ä¼šé‡è¯•ï¼Œé‡æ–°å»ºç«‹ä¸€æ¡æ–°çš„TCPè¿æ¥æ¥å¤ç”¨ã€‚</p>
]]></content:encoded>
    </item>
    <item>
      <title>ä½¿ç”¨jlinkå’Œjpackageå¯¹javafxæ‰“åŒ…æˆå¯æ‰§è¡Œç¨‹åºå’Œå¯å®‰è£…ç¨‹åº</title>
      <link>https://kkwalking.github.com/person-database/person-database/java/javafx-package-introduction.html</link>
      <guid>https://kkwalking.github.com/person-database/person-database/java/javafx-package-introduction.html</guid>
      <source url="https://kkwalking.github.com/person-database/person-database/rss.xml">ä½¿ç”¨jlinkå’Œjpackageå¯¹javafxæ‰“åŒ…æˆå¯æ‰§è¡Œç¨‹åºå’Œå¯å®‰è£…ç¨‹åº</source>
      <description>å…³äºjavaé¡¹ç›®å¦‚ä½•æ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºä¸€ç›´æ˜¯ä¸ªä»¤äººå›°æ‰°çš„é—®é¢˜ï¼Œæˆ‘æ˜¯å› ä¸ºä½¿ç”¨javafxåšæ¡Œé¢ç«¯ç¨‹åºæ‰å¼€å§‹ç ”ç©¶è¿™ä¸ªæ‰“åŒ…é—®é¢˜ï¼Œè¿™ä¸ªæ˜¯æˆ‘ç›®å‰åœ¨ä¸¤å°ç”µè„‘ä¸Šå°è¯•å¯è¡Œçš„æ–¹æ¡ˆï¼Œé’ˆå¯¹çš„æ˜¯æ¨¡å—åŒ–é¡¹ç›®ï¼Œjdkæ˜¯21ï¼ˆå®æµ‹è¿‡17çš„ä¹Ÿæ˜¯okçš„ï¼‰ã€‚ä¸»è¦å°±æ˜¯ä½¿ç”¨jlinkçš„mavenæ’ä»¶ï¼Œç„¶åä½¿ç”¨jdkè‡ªå¸¦çš„jpackageæ‰“å‡ºä¸€ä¸ªå¸¦è¿è¡Œæ—¶çš„æ–‡ä»¶å¤¹ï¼Œå†ç”¨jpackageçš„å…¶ä»–é€‰...</description>
      <pubDate>Sat, 11 May 2024 00:00:00 GMT</pubDate>
      <content:encoded><![CDATA[<blockquote>
<p>å…³äºjavaé¡¹ç›®å¦‚ä½•æ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºä¸€ç›´æ˜¯ä¸ªä»¤äººå›°æ‰°çš„é—®é¢˜ï¼Œæˆ‘æ˜¯å› ä¸ºä½¿ç”¨javafxåšæ¡Œé¢ç«¯ç¨‹åºæ‰å¼€å§‹ç ”ç©¶è¿™ä¸ªæ‰“åŒ…é—®é¢˜ï¼Œè¿™ä¸ªæ˜¯æˆ‘ç›®å‰åœ¨ä¸¤å°ç”µè„‘ä¸Šå°è¯•å¯è¡Œçš„æ–¹æ¡ˆï¼Œé’ˆå¯¹çš„æ˜¯æ¨¡å—åŒ–é¡¹ç›®ï¼Œjdkæ˜¯21ï¼ˆå®æµ‹è¿‡17çš„ä¹Ÿæ˜¯okçš„ï¼‰ã€‚ä¸»è¦å°±æ˜¯ä½¿ç”¨jlinkçš„mavenæ’ä»¶ï¼Œç„¶åä½¿ç”¨jdkè‡ªå¸¦çš„jpackageæ‰“å‡ºä¸€ä¸ªå¸¦è¿è¡Œæ—¶çš„æ–‡ä»¶å¤¹ï¼Œå†ç”¨jpackageçš„å…¶ä»–é€‰é¡¹å¯ä»¥åœ¨è¯¥åŸºç¡€ä¸Šç»§ç»­æ‰“åŒ…æˆå¯å®‰è£…ç¨‹åºã€‚ ä»¥ä¸‹æ“ä½œå‡åœ¨win 10ä¸‹è¿›è¡Œã€‚ä¸æ¸…æ¥šæ˜¯å¦éœ€è¦å®‰è£…wix3ï¼Œæˆ‘æ˜¯å®‰è£…äº†ï¼Œå»ºè®®å¯ä»¥æå‰å…ˆå®‰è£…ä¸€ä¸‹ã€‚</p>
</blockquote>
<h1>ä¸€ã€mavené…ç½®å¦‚ä¸‹æ’ä»¶</h1>
<div class="language-xml" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.11.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>21<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>21<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.openjfx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>javafx-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                    <span class="token comment">&lt;!-- Default configuration for running with: mvn clean javafx:run --&gt;</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>default-cli<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mainClass</span><span class="token punctuation">&gt;</span></span>com.kelton.gatewayconverter/com.kelton.gatewayconverter.BootApplication<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mainClass</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>launcher</span><span class="token punctuation">&gt;</span></span>app<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>launcher</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jlinkZipName</span><span class="token punctuation">&gt;</span></span>app<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jlinkZipName</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jlinkImageName</span><span class="token punctuation">&gt;</span></span>app<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jlinkImageName</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>noManPages</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>noManPages</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>stripDebug</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>stripDebug</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>noHeaderFiles</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>noHeaderFiles</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>å…³äºæ’ä»¶é…ç½®é¡¹çš„ä¸€äº›ç®€å•ä»‹ç»ï¼š</p>
<ul>
<li>
<p><code>mainClass</code>æŒ‡å®šå¯åŠ¨ç±»ï¼ŒæŒ‡å®šæ ¼å¼é‡‡ç”¨ <em>æ¨¡å—å/å¸¦åŒ…åçš„å®Œæ•´ç±»è·¯å¾„</em></p>
</li>
<li>
<p><code>jlinkImageName</code>æŒ‡å®šè¾“å‡ºçš„æ–‡ä»¶å¤¹åç§°</p>
</li>
<li>
<p><code>jlinkZipName</code> æŒ‡å®šå‹ç¼©<code>jlinkImageName</code> æ–‡ä»¶å¤¹ä¹‹åäº§ç”Ÿçš„zipå‹ç¼©åŒ…æ–‡ä»¶å</p>
</li>
</ul>
<h1>äºŒã€æ§åˆ¶å°æ‰§è¡Œå‘½ä»¤</h1>
<p><strong>ç¬¬ä¸€æ­¥ï¼Œåœ¨è¯¥ç›®å½•æ§åˆ¶å°ä¸‹è¾“å…¥å‘½ä»¤</strong></p>
<div class="language-powershell" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code>mvn javafx:jlink
</code></pre></div><p>è¯¥å‘½ä»¤æ˜¯è°ƒç”¨javafxçš„mavenæ’ä»¶ï¼Œä½¿ç”¨jlinkè¿›è¡Œæ‰“åŒ…</p>
<blockquote>
<p>å¦‚æœé‡‡ç”¨çš„ä¾èµ–æ²¡æœ‰æ”¯æŒæ¨¡å—åŒ–ï¼Œåˆ™æ‰“åŒ…ä¼šå‡ºç°æ— æ³•ä½¿ç”¨è‡ªåŠ¨åŒ–æ¨¡å—çš„é”™è¯¯ã€‚è¯·æ¥ç€çœ‹æ–‡æœ«çš„è§£å†³æ–¹æ¡ˆã€‚</p>
</blockquote>
<p><strong>ç¬¬äºŒæ­¥ï¼Œåœ¨å½“å‰é¡¹ç›®æ ¹ç›®å½•ä¸‹ä½¿ç”¨è¯¥å‘½ä»¤</strong></p>
<div class="language-powershell" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code>jpackage <span class="token operator">--</span><span class="token function">type</span> app-image <span class="token operator">-</span>n gateway-converter <span class="token operator">-</span>m <span class="token string">"com.kelton.gatewayconverter/com.kelton.gatewayconverter.BootApplication"</span> <span class="token operator">--</span>icon <span class="token string">"D:\code\gateway-converter\src\main\r
esources\logo.ico"</span> <span class="token operator">--</span>runtime-image <span class="token string">".\target\app"</span> <span class="token operator">--</span>dest <span class="token string">".\target\build-package"</span>
</code></pre></div><p>è¯¥å‘½ä»¤çš„ä¸€äº›å‚æ•°è§£é‡Š:</p>
<ul>
<li><code>-m</code>å‚æ•°æŒ‡å®šå¯åŠ¨ç±»</li>
<li><code>-n</code>æŒ‡å®šæ‰“åŒ…åå¯æ‰§è¡Œæ–‡ä»¶çš„æ–‡ä»¶å</li>
<li><code>--icon</code> æŒ‡å®šlogoçš„ä½ç½®</li>
<li><code>--runtime-image</code> æŒ‡å®šä»å“ªä¸ªç›®å½•æ„å»ºæ‰“åŒ…æ–‡ä»¶ã€‚è¿™é‡Œçš„.\target\appæ­£æ˜¯ä½¿ç”¨mvn javafx:jlink å‘½ä»¤æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶ç›®å½•ï¼ˆæ˜¯åœ¨javafx-maven-pluginæ’ä»¶ä¸­<code>jlinkImageName</code>æ ‡ç­¾ä¸­é…ç½®çš„ï¼‰</li>
<li><code>--dest</code> æŒ‡å®šæ‰“åŒ…è¾“å‡ºæ–‡ä»¶å¤¹</li>
</ul>
<p><strong>æœ€åï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ‰“åŒ…å‡ºå¯å®‰è£…ç¨‹åº.exe</strong></p>
<div class="language-powershell" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code>jpackage<span class="token punctuation">.</span>exe <span class="token operator">-</span>n gateway-converter <span class="token operator">--</span>app-image <span class="token punctuation">.</span>\target\build-package\gateway-converter <span class="token operator">--</span>app-version 1<span class="token punctuation">.</span>0 <span class="token operator">--</span>dest <span class="token punctuation">.</span>\target\build-link-package <span class="token operator">--</span>temp <span class="token punctuation">.</span>\target\build-link-package\temp <span class="token operator">--</span>win-<span class="token function">dir</span><span class="token operator">-</span>chooser <span class="token operator">--</span>win-menu <span class="token operator">--</span>win-menu-<span class="token function">group</span> gateway-converter <span class="token operator">--</span>win-shortcut
</code></pre></div><h1>é™„ï¼šå…³äºé‡‡ç”¨çš„ä¾èµ–æ²¡æœ‰æ”¯æŒæ¨¡å—åŒ–çš„è§£å†³æ–¹æ¡ˆ</h1>
<blockquote>
<p>è¿™ä¸ªæ–¹æ¡ˆæ¥è‡ªæ²¹ç®¡ä¸Šçš„ä¸€ä¸ªupä¸»ï¼Œv=bO6f3U4i0A0</p>
</blockquote>
<p>å¦‚æœé‡‡ç”¨çš„ä¾èµ–æ²¡æœ‰æ”¯æŒæ¨¡å—åŒ–ï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹ä¸‰ä¸ªå‘½ä»¤ï¼Œä¸ºéæ¨¡å—åŒ–çš„ä¾èµ–ç”Ÿæˆæ¨¡å—åŒ–å£°æ˜</p>
<div class="language-powershell" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code>jdeps <span class="token operator">--</span>ignore-missing-deps <span class="token operator">--</span>generate-module-info jars jars/postgresql-42<span class="token punctuation">.</span>2<span class="token punctuation">.</span>18<span class="token punctuation">.</span>jar

javac <span class="token operator">--</span>patch-module org<span class="token punctuation">.</span>postgresql<span class="token punctuation">.</span>jdbc=jars/postgresql-42<span class="token punctuation">.</span>2<span class="token punctuation">.</span>18<span class="token punctuation">.</span>jar jars/module-info<span class="token punctuation">.</span>java

jar uf jars/postgresql-42<span class="token punctuation">.</span>2<span class="token punctuation">.</span>18<span class="token punctuation">.</span>jar <span class="token operator">-</span>C jars module-info<span class="token punctuation">.</span><span class="token keyword">class</span>
</code></pre></div><p>ä¸‹é¢è§£é‡Šä¸€ä¸‹å¦‚ä½•ç”¨è¿™ä¸‰ä¸ªå‘½ä»¤</p>
<p>é¦–å…ˆï¼Œå…ˆç”¨jdepså‘½ä»¤æ¥ä¸ºæŸä¸ªéæ¨¡å—åŒ–çš„jaråŒ…ç”Ÿæˆmodule-info.java</p>
<p>æ¥ç€ï¼Œç”¨javacå‘½ä»¤æ¥ç¼–è¯‘ç”Ÿæˆmodule-info.class</p>
<p>æœ€åï¼Œjar uf å‘½ä»¤æ¥å°†module-info.classåˆå¹¶åˆ°åŸæ¥çš„éæ¨¡å—åŒ–jaråŒ…</p>
<p>ä»¥hutool-allè¿™ä¸ªéæ¨¡å—åŒ–åŒ…ä¸ºä¾‹</p>
<p>ç¬¬ä¸€æ­¥ï¼Œcmdè½¬åˆ°å¯¹åº”çš„mavenä»“åº“ç›®å½•ä¸‹é¢ï¼Œå¦‚D:\software\apache-maven-3.9.2\maven-repository\cn\hutool\hutool-all\5.8.11</p>
<p>ç„¶åæ‰§è¡Œç¬¬ä¸€ä¸ªå‘½ä»¤</p>
<div class="language-powershell" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code>jdeps <span class="token operator">--</span>ignore-missing-deps <span class="token operator">--</span>generate-module-info jars hutool-all-5<span class="token punctuation">.</span>8<span class="token punctuation">.</span>11<span class="token punctuation">.</span>jar
</code></pre></div><p>è¿™ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆ jar/hutool.all/module-info.java</p>
<p>ç¬¬äºŒæ­¥ï¼ŒæŠŠè¿™ä¸ªmodule-info.javaå¤åˆ¶åˆ°å½“å‰jaråŒ…ç›®å½•ä¸‹(ä¹Ÿå¯ä»¥ä¸å¤åˆ¶ï¼ŒæŒ‡å®šå¥½è·¯å¾„å°±è¡Œ)ï¼Œæ‰§è¡Œç¬¬äºŒä¸ªå‘½ä»¤</p>
<div class="language-powershell" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code>javac <span class="token operator">--</span>patch-module hutool<span class="token punctuation">.</span>all=hutool-all-5<span class="token punctuation">.</span>8<span class="token punctuation">.</span>11<span class="token punctuation">.</span>jar module-info<span class="token punctuation">.</span>java

</code></pre></div><p>è¿™ä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆç¼–è¯‘å¥½çš„module-info.class, å¦‚ä¸‹å›¾æ‰€ç¤º</p>
<figure><img src="http://zzk31.320.io/img/20240511095820.png" alt="module-info.classæˆªå›¾" tabindex="0" loading="lazy"><figcaption>module-info.classæˆªå›¾</figcaption></figure>
<p>ç¬¬ä¸‰æ­¥ï¼Œæ‰§è¡Œå‘½ä»¤</p>
<div class="language-powershell" data-ext="powershell" data-title="powershell"><pre class="language-powershell"><code>jar uf hutool-all-5<span class="token punctuation">.</span>8<span class="token punctuation">.</span>11<span class="token punctuation">.</span>jar module-info<span class="token punctuation">.</span><span class="token keyword">class</span>
</code></pre></div><p>è¿™ä¼šå°†å½“å‰ç›®å½•ä¸‹é¢çš„module-info.classåˆå¹¶åˆ°hutool-all-5.8.11.jarä¸­ï¼Œä½¿å…¶æˆä¸ºæ¨¡å—åŒ–jaråŒ…</p>
<p>é¡¹ç›®æ‰“åŒ…å‚è€ƒæºç ï¼Œæ˜¯æˆ‘æ­£åœ¨å†™çš„ä¸€ä¸ªRediså®¢æˆ·ç«¯é¡¹ç›®ï¼Œgithubåœ°å€ï¼š<a href="https://github.com/kkwalking/walkingman-rdm" target="blank">walkingman-rdm</a></p>
<div class="hint-container tip">
<p class="hint-container-title">æ‹‰ä¸ªStar</p>
<ul>
<li>æœ€åï¼Œå¦‚æœ<a href="https://github.com/kkwalking/person-database" target="blank">æœ¬çŸ¥è¯†åº“</a>çš„å†…å®¹å¸®åŠ©åˆ°ä½ ï¼Œè¿˜è¯·ç‚¹ä¸ªå…è´¹çš„Starï¼Œæ„Ÿè°¢ã€‚ä¼ é€é—¨ï¼š<a href="https://github.com/kkwalking/person-database" target="blank">GitHub</a></li>
</ul>
</div>
]]></content:encoded>
      <enclosure url="http://zzk31.320.io/img/20240511095820.png" type="image/png"/>
    </item>
    <item>
      <title>å¦‚ä½•å®ç°ä¸€ä¸ªåˆ†å¸ƒå¼é”</title>
      <link>https://kkwalking.github.com/person-database/person-database/java/how-to-write-a-distributed-lock.html</link>
      <guid>https://kkwalking.github.com/person-database/person-database/java/how-to-write-a-distributed-lock.html</guid>
      <source url="https://kkwalking.github.com/person-database/person-database/rss.xml">å¦‚ä½•å®ç°ä¸€ä¸ªåˆ†å¸ƒå¼é”</source>
      <description>å¦‚ä½•å®ç°ä¸€ä¸ªåˆ†å¸ƒå¼é” å…³äºåˆ†å¸ƒå¼é”çš„åŸºæœ¬çŸ¥è¯†ï¼Œå¯ä»¥å‚è€ƒæˆ‘å…ˆå‰çš„ä¸€ç¯‡æ–‡ç« ï¼šã€‚ æœ¬ç¯‡å†…å®¹ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨ Java è¯­è¨€å®ç°ä¸€ä¸ªæ³¨è§£å¼çš„åˆ†å¸ƒå¼é”ï¼Œä¸»è¦æ˜¯é€šè¿‡æ³¨è§£+AOP ç¯ç»•é€šçŸ¥æ¥å®ç°ã€‚ 1. é”æ³¨è§£ æˆ‘ä»¬é¦–å…ˆå†™ä¸€ä¸ªé”çš„æ³¨è§£ expiredTime æ˜¯è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´ï¼ŒtimeoutForLock æ˜¯è®¾ç½®ç­‰å¾…é”çš„è¶…æ—¶æ—¶é—´ã€‚å¦‚æœæ²¡æœ‰ç­‰å¾…è·å¾—é”çš„è¶…æ—¶æ—¶é—´è¿™ä¸ªåŠŸ...</description>
      <pubDate>Fri, 05 Apr 2024 00:00:00 GMT</pubDate>
      <content:encoded><![CDATA[
<p>å…³äºåˆ†å¸ƒå¼é”çš„åŸºæœ¬çŸ¥è¯†ï¼Œå¯ä»¥å‚è€ƒæˆ‘å…ˆå‰çš„ä¸€ç¯‡æ–‡ç« ï¼š<a href="/person-database/java/distributed-lock-introduction.html" target="_blank">åˆ†å¸ƒå¼é”ç†è®ºä»‹ç»</a>ã€‚</p>
<p>æœ¬ç¯‡å†…å®¹ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨ Java è¯­è¨€å®ç°ä¸€ä¸ªæ³¨è§£å¼çš„åˆ†å¸ƒå¼é”ï¼Œä¸»è¦æ˜¯é€šè¿‡æ³¨è§£+AOP ç¯ç»•é€šçŸ¥æ¥å®ç°ã€‚</p>
<h2>1. é”æ³¨è§£</h2>
<p>æˆ‘ä»¬é¦–å…ˆå†™ä¸€ä¸ªé”çš„æ³¨è§£</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * åˆ†å¸ƒå¼é”æ³¨è§£
 */</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">RedisLock</span> <span class="token punctuation">{</span>

    <span class="token keyword">long</span> <span class="token constant">DEFAULT_TIMEOUT_FOR_LOCK</span> <span class="token operator">=</span> <span class="token number">5L</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> <span class="token constant">DEFAULT_EXPIRE_TIME</span> <span class="token operator">=</span> <span class="token number">60L</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> <span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">"your-biz-key"</span><span class="token punctuation">;</span>

    <span class="token keyword">long</span> <span class="token function">expiredTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token constant">DEFAULT_EXPIRE_TIME</span><span class="token punctuation">;</span>

    <span class="token keyword">long</span> <span class="token function">timeoutForLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token constant">DEFAULT_TIMEOUT_FOR_LOCK</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p>expiredTime æ˜¯è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´ï¼ŒtimeoutForLock æ˜¯è®¾ç½®ç­‰å¾…é”çš„è¶…æ—¶æ—¶é—´ã€‚å¦‚æœæ²¡æœ‰ç­‰å¾…è·å¾—é”çš„è¶…æ—¶æ—¶é—´è¿™ä¸ªåŠŸèƒ½ï¼Œé‚£ä¹ˆå…¶ä»–çº¿ç¨‹åœ¨è·å–é”å¤±è´¥æ—¶åªèƒ½ç›´æ¥å¤±è´¥ï¼Œæ— æ³•è¿›è¡Œæ’é˜Ÿç­‰å¾…ã€‚</p>
<p>æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ³¨è§£å‘¢ï¼Œå¾ˆå®¹æ˜“ï¼Œåœ¨éœ€è¦åŠ é”çš„ä¸šåŠ¡æ–¹æ³•ä¸Šç›´æ¥ç”¨å°±è¡Œ.å¦‚ä¸‹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªåº“å­˜æœåŠ¡ç±»ï¼Œå®ƒæœ‰ä¸€ä¸ªæ‰£å‡åº“å­˜æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†æ•°æ®åº“ä¸­çš„ä¸€ä¸ªåº“å­˜å•†å“çš„æ•°é‡å‡ä¸€ã€‚åœ¨å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰å¯¹å…¶è¿›è¡Œèµ„æºæ§åˆ¶ï¼Œå¿…ç„¶ä¼šå‘ç”Ÿåº“å­˜æ‰£å‡ä¸ä¸€è‡´ç°è±¡ã€‚</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StockServiceImpl</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@RedisLock</span><span class="token punctuation">(</span>key <span class="token operator">=</span> <span class="token string">"stock-lock"</span><span class="token punctuation">,</span> expiredTime <span class="token operator">=</span> <span class="token number">10L</span><span class="token punctuation">,</span> timeoutForLock <span class="token operator">=</span> <span class="token number">5L</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deduct</span><span class="token punctuation">(</span><span class="token class-name">Long</span> stockId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Stock</span> stock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Integer</span> count <span class="token operator">=</span> stock<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stock<span class="token punctuation">.</span><span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>stock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2>2. åœ¨ AOP åˆ‡é¢ä¸­è¿›è¡ŒåŠ é”å¤„ç†</h2>
<p>æˆ‘ä»¬éœ€è¦ä½¿ç”¨ AOP æ¥å¤„ç†ä»€ä¹ˆï¼Ÿè‡ªç„¶æ˜¯å¤„ç†ä½¿ç”¨<code>@RedisLock</code>çš„æ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬å†™ä¸€ä¸ªåˆ‡ç‚¹è¡¨è¾¾å¼ï¼Œå®ƒåŒ¹é…æ‰€æœ‰æ ‡æœ‰ @RedisLock æ³¨è§£çš„æ–¹æ³•ã€‚</p>
<p>æ¥ç€ï¼Œæˆ‘ä»¬å°†æ­¤åˆ‡ç‚¹è¡¨è¾¾å¼ä¸ @Around æ³¨è§£ç»“åˆä½¿ç”¨ï¼Œä»¥åˆ›å»ºç¯ç»•é€šçŸ¥ï¼Œåœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰åæ‰§è¡Œæˆ‘ä»¬çš„åŠ é”è§£é”é€»è¾‘ã€‚
å› æ­¤ï¼ŒåŸºæœ¬çš„é€»è¾‘æˆ‘ä»¬å°±ç†æ¸…äº†ï¼Œä»£ç å¤§è‡´é•¿ä¸‹é¢è¿™ä¸ªæ ·å­:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisLockAspect</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> redisTemplate<span class="token punctuation">;</span>

    <span class="token comment">// é”çš„redis keyå‰ç¼€</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEFAULT_KEY_PREFIX</span> <span class="token operator">=</span> <span class="token string">"lock:"</span><span class="token punctuation">;</span>

    <span class="token comment">// åŒ¹é…æ‰€æœ‰æ ‡æœ‰ @RedisLock æ³¨è§£çš„æ–¹æ³•</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">"@annotation(com.kelton.lock.annotation.RedisLock)"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lockAnno</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">"lockAnno()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// è·å–æ‹¦æˆªæ–¹æ³•ä¸Šçš„RedisLockæ³¨è§£</span>
        <span class="token class-name">RedisLock</span> annotation <span class="token operator">=</span> <span class="token function">getLockAnnotationOnMethod</span><span class="token punctuation">(</span>joinPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è·å–é”key</span>
        <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token function">getKey</span><span class="token punctuation">(</span>annotation<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// é”è¿‡æœŸæ—¶é—´</span>
        <span class="token keyword">long</span> expireTime <span class="token operator">=</span> annotation<span class="token punctuation">.</span><span class="token function">expiredTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è·å–é”çš„ç­‰å¾…æ—¶é—´</span>
        <span class="token keyword">long</span> timeoutForLock <span class="token operator">=</span> annotation<span class="token punctuation">.</span><span class="token function">timeoutForLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åœ¨è¿™é‡ŒåŠ é”</span>
        someCodeForLock<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token comment">// æ‰§è¡Œä¸šåŠ¡</span>
        joinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åœ¨è¿™é‡Œè§£é”</span>
        someCodeForUnLock<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

</code></pre></div><p>æˆ‘ä»¬åœ¨åŠ é”çš„æ—¶å€™ï¼Œéœ€è¦ç”¨ä¸Š timeoutForLock è¿™ä¸ªå±æ€§ï¼Œæˆ‘ä»¬é€šè¿‡è‡ªæ—‹åŠ çº¿ç¨‹ä¼‘çœ çš„æ–¹å¼ï¼Œæ¥è¾¾åˆ°åœ¨ä¸€æ®µæ—¶é—´å†…ç­‰å¾…è·å–é”çš„ç›®çš„ã€‚å¦‚æœè‡ªæ—‹æ—¶é—´ç»“æŸåï¼Œè¿˜æ²¡è·å–é”ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™é‡Œå¯ä»¥æ ¹æ®è‡ªå·±æƒ…å†µè€Œå®šã€‚è‡ªæ—‹åŠ é”ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code>        <span class="token comment">// è‡ªæ—‹è·å–é”</span>
        <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> timeoutForLock <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> acquired <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> uuid <span class="token operator">=</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> endTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Boolean</span> absent <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> uuid<span class="token punctuation">,</span> expireTime<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>absent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                acquired <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// è·å–ä¸åˆ°é”ï¼Œå°è¯•ä¼‘çœ 100æ¯«ç§’åé‡è¯•</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// è¶…æ—¶æœªè·å–åˆ°é”ï¼Œ æŠ›å‡ºå¼‚å¸¸ï¼Œå¯æ ¹æ®è‡ªå·±ä¸šåŠ¡è€Œå®š</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>acquired<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"è·å–é”å¼‚å¸¸"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre></div><p>æˆ‘ä»¬å‘ç°ä¸Šé¢åŠ é”çš„æ—¶å€™è®¾ç½®äº†ä¸€ä¸ª uuid ä½œä¸º value å€¼ï¼Œè¿™æ˜¯ä¸ºäº†åœ¨é”é‡Šæ”¾çš„æ—¶å€™ï¼Œä¸è¯¯åˆ å…¶ä»–çº¿ç¨‹ä¸Šçš„é”ï¼Œå…·ä½“å¯ä»¥å‚è€ƒæˆ‘å…ˆå‰çš„ä¸€ç¯‡æ–‡ç« ï¼š<a href="/person-database/java/distributed-lock-introduction.html" target="_blank">åˆ†å¸ƒå¼é”ç†è®ºä»‹ç»</a>ã€‚éšåï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‰§è¡Œè¢« AOP åˆ‡ä¸­çš„æ–¹æ³•ï¼Œæ‰§è¡Œç»“æŸé‡Šæ”¾é”ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code>        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ‰§è¡Œä¸šåŠ¡</span>
            joinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"ä¸šåŠ¡æ‰§è¡Œå‡ºé”™ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token comment">// è§£é”æ—¶è¿›è¡Œæ ¡éªŒï¼Œåªåˆ é™¤è‡ªå·±çº¿ç¨‹åŠ çš„é”</span>
            <span class="token class-name">String</span> value <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>uuid<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"é”å·²è¿‡æœŸï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre></div><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±ä»¥æ³¨è§£+AOP çš„æ–¹å¼å®ç°äº†åˆ†å¸ƒå¼é”çš„åŠŸèƒ½ã€‚å½“ç„¶ï¼Œä»¥ä¸Šåªå®ç°äº†åˆ†å¸ƒå¼é”çš„ç®€å•åŠŸèƒ½ï¼Œè¿˜ç¼ºå°‘äº†åˆ†å¸ƒå¼é”çš„ key è‡ªåŠ¨ç»­çº¦é˜²æ­¢é”è¿‡æœŸåŠŸèƒ½ï¼Œä»¥åŠé”é‡å…¥åŠŸèƒ½ã€‚</p>
<p>ç›®å‰ï¼Œ<code>RedisLockAspect</code>çš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisLockAspect</span> <span class="token punctuation">{</span>

    <span class="token comment">// åŒ¹é…æ‰€æœ‰æ ‡æœ‰ @RedisLock æ³¨è§£çš„æ–¹æ³•</span>
    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">"@annotation(com.kelton.lock.annotation.RedisLock)"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lockAnno</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">"lockAnno()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// è·å–æ‹¦æˆªæ–¹æ³•ä¸Šçš„RedisLockæ³¨è§£</span>
        <span class="token class-name">RedisLock</span> annotation <span class="token operator">=</span> <span class="token function">getLockAnnotationOnMethod</span><span class="token punctuation">(</span>joinPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> key <span class="token operator">=</span> <span class="token function">getKey</span><span class="token punctuation">(</span>annotation<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// é”è¿‡æœŸæ—¶é—´</span>
        <span class="token keyword">long</span> expireTime <span class="token operator">=</span> annotation<span class="token punctuation">.</span><span class="token function">expiredTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è·å–é”çš„ç­‰å¾…æ—¶é—´</span>
        <span class="token keyword">long</span> timeoutForLock <span class="token operator">=</span> annotation<span class="token punctuation">.</span><span class="token function">timeoutForLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è‡ªæ—‹è·å–é”</span>
        <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> timeoutForLock <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> acquired <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> uuid <span class="token operator">=</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> endTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Boolean</span> absent <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> uuid<span class="token punctuation">,</span> expireTime<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>absent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                acquired <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// è·å–ä¸åˆ°é”ï¼Œå°è¯•ä¼‘çœ 100æ¯«ç§’åé‡è¯•</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// è¶…æ—¶æœªè·å–åˆ°é”ï¼Œ æŠ›å‡ºå¼‚å¸¸ï¼Œå¯æ ¹æ®è‡ªå·±ä¸šåŠ¡è€Œå®š</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>acquired<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"è·å–é”å¼‚å¸¸"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ‰§è¡Œä¸šåŠ¡</span>
            joinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"ä¸šåŠ¡æ‰§è¡Œå‡ºé”™ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token comment">// è§£é”æ—¶è¿›è¡Œæ ¡éªŒï¼Œåªåˆ é™¤è‡ªå·±çº¿ç¨‹åŠ çš„é”</span>
            <span class="token class-name">String</span> value <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>uuid<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"é”å·²è¿‡æœŸï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getKey</span><span class="token punctuation">(</span><span class="token class-name">RedisLock</span> redisLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>redisLock<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token constant">DEFAULT_KEY_PREFIX</span> <span class="token operator">+</span> <span class="token string">"default"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token constant">DEFAULT_KEY_PREFIX</span> <span class="token operator">+</span> redisLock<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">RedisLock</span> <span class="token function">getLockAnnotationOnMethod</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MethodSignature</span> signature <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MethodSignature</span><span class="token punctuation">)</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Method</span> method <span class="token operator">=</span> signature<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> method<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">RedisLock</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2>3. key è‡ªåŠ¨ç»­çº¦é˜²æ­¢é”è¿‡æœŸ</h2>
<p>æˆ‘ä»¬æ¥ç€å®Œå–„è¯¥åˆ†å¸ƒå¼é”ï¼Œä¸ºå…¶æ·»åŠ  key è‡ªåŠ¨ç»­çº¦é˜²æ­¢é”è¿‡æœŸçš„åŠŸèƒ½ã€‚æˆ‘ä»¬çš„æ€è·¯ä¸<em>Redission</em>çš„<em>watch dog</em>ç±»ä¼¼ï¼Œå¼€å¯ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œæ¥å®šæ—¶æ£€æŸ¥éœ€è¦ç»­çº¦çš„é”ã€‚æˆ‘ä»¬å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªé”æ˜¯å¦éœ€è¦ç»­çº¦å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•å®šä¹‰ä¸€ä¸ªç»­çº¦åˆ†ç•Œçº¿ï¼Œæ¯”å¦‚åœ¨é”è¿‡æœŸæ—¶é—´çš„ä¸‰åˆ†ä¹‹äºŒçš„æ—¶é—´ç‚¹åŠä¹‹åï¼Œå¯¹é”è¿›è¡Œç»­çº¦ã€‚</p>
<h3>3.1 å®šä¹‰ä¸€ä¸ªç»­çº¦ä»»åŠ¡</h3>
<p>æˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸ªé”ç»­çº¦ä»»åŠ¡ï¼Œé‚£æˆ‘ä»¬éœ€è¦ä»€ä¹ˆä¿¡æ¯å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬è‡³å°‘éœ€è¦é”çš„ keyï¼Œé”è¦è®¾ç½®çš„è¿‡æœŸæ—¶é—´ã€‚è¿™æ˜¯ä¸¤ä¸ªæœ€åŸºæœ¬çš„ä¿¡æ¯ã€‚</p>
<p>è¦åˆ¤æ–­åœ¨é”è¿‡æœŸæ—¶é—´çš„ä¸‰åˆ†ä¹‹äºŒçš„æ—¶é—´ç‚¹åŠä¹‹åè¿›è¡Œç»­çº¦ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦è®°å½•é”ä¸Šæ¬¡ç»­çº¦çš„æ—¶é—´ç‚¹ã€‚</p>
<p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¸ºé”ç»­çº¦ä»»åŠ¡æ·»åŠ æœ€å¤§ç»­çº¦æ¬¡æ•°é™åˆ¶ï¼Œè¿™å¯ä»¥é¿å…æŸäº›æ‰§è¡Œæ—¶é—´ç‰¹åˆ«ä¹…çš„ä»»åŠ¡ä¸æ–­å ç”¨é”ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦è®°å½•å½“å‰é”ç»­çº¦æ¬¡æ•°å’Œæœ€å¤§ç»­çº¦æ¬¡æ•°ã€‚</p>
<p>å¯¹è¶…è¿‡æœ€å¤§ç»­çº¦æ¬¡æ•°çš„é”çš„çº¿ç¨‹ï¼Œæˆ‘ä»¬ç›´æ¥å°†å…¶åœæ­¢ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿè®°å½•ä¸€ä¸‹è¯¥é”çš„çº¿ç¨‹ã€‚</p>
<p>ç»“åˆä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å®šä¹‰çš„é”ç»­çº¦ä»»åŠ¡ç±»å¦‚ä¸‹ï¼š</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockRenewTask</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * key
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> key<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * è¿‡æœŸæ—¶é—´ã€‚å•ä½ï¼šç§’
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">long</span> expiredTime<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * é”çš„æœ€å¤§ç»­çº¦æ¬¡æ•°
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> maxRenewCount<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * é”çš„å½“å‰ç»­çº¦æ¬¡æ•°
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> currentRenewCount<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * æœ€æ–°æ›´æ–°æ—¶é—´
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> latestRenewTime<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * ä¸šåŠ¡çº¿ç¨‹
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Thread</span> thread<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">LockRenewTask</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> expiredTime<span class="token punctuation">,</span> <span class="token keyword">int</span> maxRenewCount<span class="token punctuation">,</span> <span class="token class-name">Thread</span> thread<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>expiredTime <span class="token operator">=</span> expiredTime<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>maxRenewCount <span class="token operator">=</span> maxRenewCount<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>thread <span class="token operator">=</span> thread<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>latestRenewTime <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token doc-comment comment">/**
     * æ˜¯å¦åˆ°è¾¾ç»­çº¦æ—¶é—´
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isTimeToRenew</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">LocalDateTime</span> now <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Duration</span> duration <span class="token operator">=</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">between</span><span class="token punctuation">(</span>latestRenewTime<span class="token punctuation">,</span> now<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> duration<span class="token punctuation">.</span><span class="token function">toSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>expiredTime <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token doc-comment comment">/**
     * æ˜¯å¦è¾¾åˆ°æœ€å¤§ç»­çº¦æ¬¡æ•°
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">exceedMaxRenewCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currentRenewCount <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxRenewCount<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">renew</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>currentRenewCount<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>latestRenewTime <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å–æ¶ˆä¸šåŠ¡æ–¹æ³•</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        thread<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getExpiredTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> expiredTime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æˆ‘ä»¬æ·»åŠ äº†ä¸€äº›å…³äºé”ç»­çº¦çš„æ–¹æ³•ï¼š</p>
<ul>
<li><code>isTimeToRenew()</code>: åˆ¤æ–­æ˜¯å¦å¯ä»¥å¯¹é”è¿›è¡Œç»­çº¦</li>
<li><code>exceedMaxRenewCount()</code>: åˆ¤æ–­æ˜¯å¦è¾¾åˆ°æœ€å¤§ç»­çº¦æ¬¡æ•°</li>
<li><code>renew()</code>: æ¥æ ‡è®°ä¸€æ¬¡ç»­çº¦æ“ä½œ</li>
<li><code>cancel()</code>: å–æ¶ˆä¸šåŠ¡æ–¹æ³•</li>
</ul>
<h3>3.2 å®šä¹‰ä¸€ä¸ªé”ç»­çº¦ä»»åŠ¡å¤„ç†å™¨</h3>
<p>æ¥ç€ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå®šæ—¶æ‰§è¡Œè¯¥ç»­çº¦ä»»åŠ¡çš„ handlerã€‚è¯¥ handler ä¹Ÿæ¯”è¾ƒç®€ç­”ï¼Œæ ¸å¿ƒé€»è¾‘æ˜¯æŒæœ‰ä¸€ä¸ªç±»å‹ä¸º <code>List&lt;LockRenewTask&gt;</code>çš„ taskList æ¥æ·»åŠ ç»­çº¦ä»»åŠ¡ï¼Œä¸”ä½¿ç”¨ä¸€ä¸ª ScheduledExecutorService æ¥å®šæ—¶éå†è¯¥ taskList æ¥æ‰§è¡Œç»­çº¦ä»»åŠ¡ã€‚è¯¥ handler å†å¯¹å¤–æš´éœ²ä¸€ä¸ª addRenewTask æ–¹æ³•ï¼Œæ–¹ä¾¿å¤–éƒ¨è°ƒç”¨æ¥æ·»åŠ ç»­çº¦ä»»åŠ¡åˆ° taskList ä¸­ã€‚</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockRenewHandler</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> redisTemplate<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * ä¿éšœå¯¹ taskListçš„æ·»åŠ åˆ é™¤æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> taskListLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LockRenewTask</span><span class="token punctuation">&gt;</span></span> taskList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ScheduledExecutorService</span> taskExecutorService<span class="token punctuation">;</span>

    <span class="token punctuation">{</span>
        taskExecutorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newScheduledThreadPool</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">availableProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        taskExecutorService<span class="token punctuation">.</span><span class="token function">scheduleAtFixedRate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token function">executeRenewTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//é”™è¯¯å¤„ç†</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token doc-comment comment">/**
     * æ·»åŠ ç»­çº¦ä»»åŠ¡
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addRenewTask</span><span class="token punctuation">(</span><span class="token class-name">LockRenewTask</span> task<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        taskListLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            taskList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            taskListLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token doc-comment comment">/**
     * æ‰§è¡Œç»­çº¦ä»»åŠ¡
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">executeRenewTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å¼€å§‹æ‰§è¡Œç»­çº¦ä»»åŠ¡"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>taskList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// éœ€è¦åˆ é™¤çš„ä»»åŠ¡ï¼Œæš‚å­˜è¿™ä¸ªé›†åˆä¸­  å–æ¶ˆ</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LockRenewTask</span><span class="token punctuation">&gt;</span></span> cancelTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è·å–ä»»åŠ¡å‰¯æœ¬</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LockRenewTask</span><span class="token punctuation">&gt;</span></span> copyTaskList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>taskList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">LockRenewTask</span> task <span class="token operator">:</span> copyTaskList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// åˆ¤æ–­ Redis ä¸­æ˜¯å¦å­˜åœ¨ key</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>redisTemplate<span class="token punctuation">.</span><span class="token function">hasKey</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    cancelTask<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// å¤§äºç­‰äºæœ€å¤§ç»­çº¦æ¬¡æ•°</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">exceedMaxRenewCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// åœæ­¢ç»­çº¦ä»»åŠ¡</span>
                    task<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    cancelTask<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// åˆ°è¾¾ç»­çº¦æ—¶é—´</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">isTimeToRenew</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ç»­çº¦ä»»åŠ¡ï¼š{}"</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    redisTemplate<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span><span class="token function">getExpiredTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    task<span class="token punctuation">.</span><span class="token function">renew</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//é”™è¯¯å¤„ç†</span>
                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"å¤„ç†ä»»åŠ¡å‡ºé”™ï¼š{}"</span><span class="token punctuation">,</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// åŠ é”ï¼Œåˆ é™¤ taskList ä¸­éœ€è¦ç§»é™¤çš„ä»»åŠ¡</span>
        taskListLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            taskList<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span>cancelTask<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æ¸…ç†cancelTask,é¿å…å †ç§¯ï¼Œäº§ç”Ÿå†…å­˜æ³„éœ²</span>
            cancelTask<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            taskListLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ€»ç»“ä¸€ä¸‹ <code>LockRenewHandler</code>çš„ä¸»è¦ä½œç”¨ï¼šå®ƒè´Ÿè´£ç®¡ç†å’Œæ‰§è¡Œç»­çº¦ä»»åŠ¡ï¼Œä»¥å»¶é•¿ Redis ä¸­é”®çš„è¿‡æœŸæ—¶é—´ã€‚</p>
<ul>
<li><strong>æ·»åŠ ç»­çº¦ä»»åŠ¡</strong>ï¼š<code>addRenewTask()</code> æ–¹æ³•å…è®¸æ·»åŠ æ–°çš„ç»­çº¦ä»»åŠ¡åˆ°å†…éƒ¨åˆ—è¡¨ <code>taskList</code> ä¸­ã€‚</li>
<li><strong>æ‰§è¡Œç»­çº¦ä»»åŠ¡</strong>ï¼š<code>executeRenewTask()</code> æ–¹æ³•å®šæœŸæ‰§è¡Œç»­çº¦ä»»åŠ¡ã€‚å®ƒæ£€æŸ¥æ¯ä¸ªä»»åŠ¡çš„çŠ¶æ€ï¼Œå¹¶æ ¹æ®éœ€è¦ç»­çº¦ Redis ä¸­çš„é”®ã€‚</li>
<li><strong>ç§»é™¤å®Œæˆçš„ä»»åŠ¡</strong>ï¼šç»´æŠ¤ä¸€ä¸ª <code>cancelTask</code> åˆ—è¡¨ï¼Œç”¨äºå­˜å‚¨éœ€è¦ä» <code>taskList</code> ä¸­ç§»é™¤çš„ä»»åŠ¡ã€‚åœ¨ <code>executeRenewTask()</code> æ–¹æ³•ä¸­ï¼Œå®ƒä¼šå°†å®Œæˆçš„ä»»åŠ¡æ·»åŠ åˆ° <code>cancelTask</code> åˆ—è¡¨ä¸­ï¼Œå¹¶åœ¨ä¹‹åå°†å…¶ä» <code>taskList</code> ä¸­ç§»é™¤ã€‚</li>
</ul>
<p><strong>å¤§æ¦‚çš„å·¥ä½œæµç¨‹å¦‚ä¸‹</strong>ï¼š</p>
<ol>
<li>ç»­çº¦ä»»åŠ¡è¢«æ·»åŠ åˆ° <code>taskList</code> ä¸­ã€‚</li>
<li><code>executeRenewTask()</code> æ–¹æ³•å®šæœŸæ‰§è¡Œï¼Œå®ƒæ£€æŸ¥æ¯ä¸ªä»»åŠ¡çš„çŠ¶æ€ï¼š
<ul>
<li>å¦‚æœ Redis ä¸­ä¸å†å­˜åœ¨è¯¥é”®ï¼Œåˆ™å–æ¶ˆä»»åŠ¡ã€‚</li>
<li>å¦‚æœä»»åŠ¡çš„ç»­çº¦æ¬¡æ•°è¾¾åˆ°ä¸Šé™ï¼Œåˆ™å–æ¶ˆä»»åŠ¡ã€‚</li>
<li>å¦‚æœæ˜¯æ—¶å€™ç»­çº¦äº†ï¼Œåˆ™ç»­çº¦ Redis ä¸­çš„é”®å¹¶æ›´æ–°ä»»åŠ¡çš„ç»­çº¦æ¬¡æ•°ï¼Œè®°å½•ç»­çº¦æ—¶é—´ç‚¹ã€‚</li>
</ul>
</li>
<li>å®Œæˆçš„ä»»åŠ¡è¢«æ·»åŠ åˆ° <code>cancelTask</code> åˆ—è¡¨ä¸­ã€‚</li>
<li><code>executeRenewTask()</code> æ–¹æ³•è·å– <code>taskList</code> çš„å‰¯æœ¬ï¼Œå¹¶ä»å‰¯æœ¬ä¸­ç§»é™¤ <code>cancelTask</code> ä¸­çš„ä»»åŠ¡ï¼Œå¹¶ä¸”åœ¨å®Œæˆç§»é™¤ä»»åŠ¡æ“ä½œåæ¸…ç©º<code>cancelTask</code>ã€‚</li>
<li>æ›´æ–°åçš„ <code>taskList</code> è¢«ä¿å­˜å›ç±»ä¸­ã€‚</li>
</ol>
<p>ä¸¤ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹</p>
<ul>
<li>æˆ‘ä»¬éå†<code>taskList</code>æ—¶æ‹·è´äº†ä¸€ä»½å‰¯æœ¬è¿›è¡Œéå†ï¼Œå› ä¸º<code>taskList</code>æ˜¯å¯å˜çš„ï¼Œè¿™æ ·å¯ä»¥é¿å…åœ¨éå†çš„æ—¶å€™äº§ç”Ÿå¹¶å‘ä¿®æ”¹é—®é¢˜ã€‚</li>
<li><code>cancelTask</code>éœ€è¦æ¸…ç†ï¼Œé¿å…äº§ç”Ÿå†…å­˜æ³„æ¼ã€‚</li>
</ul>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œ<code>LockRenewHandler</code> å¯ä»¥ç¡®ä¿ Redis ä¸­çš„é”®åœ¨éœ€è¦æ—¶å¾—åˆ°ç»­çº¦ï¼Œå¹¶è‡ªåŠ¨ç§»é™¤å®Œæˆæˆ–å¤±è´¥çš„ä»»åŠ¡ã€‚</p>
<h3>3.3 æ·»åŠ é”ç»­çº¦ä»»åŠ¡</h3>
<p>åœ¨ä¸Šé¢ 3.1 èŠ‚å’Œ 3.2 èŠ‚æˆ‘ä»¬å®šä¹‰å¥½äº†é”ç»­çº¦ä»»åŠ¡å’Œå¤„ç†é”ç»­çº¦ä»»åŠ¡çš„æ ¸å¿ƒä»£ç ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åœ¨ç¬¬ 2 èŠ‚åŠ é”è§£é”çš„ AOP å¤„ç†é€»è¾‘ä¸Šè¿›è¡Œä¸€ç‚¹å°å°çš„ä¿®æ”¹ï¼Œä¸»è¦å°±æ˜¯åœ¨æ‰§è¡ŒåŠ é”ä¹‹åï¼Œæ‰§è¡Œä¸šåŠ¡ä»£ç ä¹‹å‰ï¼Œæ·»åŠ ä¸Šé”ç»­çº¦ä»»åŠ¡ã€‚ä¿®æ”¹ä½ç½®å¦‚ä¸‹ï¼š</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment">// çœç•¥ä»£ç </span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// æ·»åŠ é”ç»­çº¦ä»»åŠ¡</span>
            <span class="token class-name">LockRenewTask</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LockRenewTask</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> annotation<span class="token punctuation">.</span><span class="token function">expiredTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> annotation<span class="token punctuation">.</span><span class="token function">maxRenew</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            lockRenewHandler<span class="token punctuation">.</span><span class="token function">addRenewTask</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æ·»åŠ ç»­çº¦ä»»åŠ¡, key:{}"</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æ‰§è¡Œä¸šåŠ¡</span>
            joinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"ä¸šåŠ¡æ‰§è¡Œå‡ºé”™ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token comment">// è§£é”æ—¶è¿›è¡Œæ ¡éªŒï¼Œåªåˆ é™¤è‡ªå·±çº¿ç¨‹åŠ çš„é”</span>
            <span class="token class-name">String</span> value <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>uuid<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"é”å·²è¿‡æœŸï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment">// çœç•¥ä»£ç </span>
    <span class="token punctuation">}</span>
</code></pre></div><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„åˆ†å¸ƒå¼é”å·²ç»ç›¸å½“å®Œå–„äº†ï¼ŒæŠŠé”è‡ªåŠ¨ç»­çº¦çš„åŠŸèƒ½ä¹ŸåŠ ä¸Šäº†ã€‚å½“ç„¶ï¼Œè¿˜æ²¡æœ‰å®ç°é”çš„å¯é‡å…¥æ€§ã€‚å¦‚æœä½ æœ‰å¥½çš„ç‚¹å­ï¼Œæ¬¢è¿åˆ°ä»“åº“æ issue åé¦ˆã€‚</p>
<div class="hint-container tip">
<p class="hint-container-title">æ‹‰ä¸ª Star</p>
<ul>
<li>çœ‹åˆ°è¿™é‡Œï¼Œå¦‚æœ<a href="https://github.com/kkwalking/person-database" target="blank">æœ¬ç¯‡æ–‡ç« </a>çš„å†…å®¹å¸®åŠ©åˆ°ä½ ï¼Œè¿˜è¯·ç‚¹ä¸ªå…è´¹çš„ Starï¼Œæ„Ÿè°¢ã€‚ä¼ é€é—¨ï¼š<a href="https://github.com/kkwalking/person-database" target="blank">GitHub</a></li>
</ul>
</div>
]]></content:encoded>
    </item>
    <item>
      <title>åˆ†å¸ƒå¼é”ç†è®ºä»‹ç»</title>
      <link>https://kkwalking.github.com/person-database/person-database/java/distributed-lock-introduction.html</link>
      <guid>https://kkwalking.github.com/person-database/person-database/java/distributed-lock-introduction.html</guid>
      <source url="https://kkwalking.github.com/person-database/person-database/rss.xml">åˆ†å¸ƒå¼é”ç†è®ºä»‹ç»</source>
      <description>åˆ†å¸ƒå¼é”ç†è®ºä»‹ç» é—²è¯æ¼«è°ˆï¼š æœ¬æ¥æ˜¯æƒ³è¦å†™ä¸€ç¯‡å…³äº Spring æä¾›çš„ RedisLockRegistry çš„ä½¿ç”¨æ–¹æ³•åŠåº•å±‚åŸç†è§£æçš„æ–‡ç« ï¼Œå†™ç€å†™ç€å‘ç°å¾—å…ˆä»‹ç»ä¸€ä¸‹åˆ†å¸ƒå¼é”çš„åŸºæœ¬åŸç†ï¼Œæ‰èƒ½æœ‰åŠ©äºç†è§£ä¸€äº›å®ç°å†…å®¹ã€‚æœ€åå‘ç°å…³äºåˆ†å¸ƒå¼é”çš„åŸºæœ¬ä»‹ç»ä¹Ÿå æ®äº†è¾ƒå¤§ç¯‡å¹…ï¼Œå› æ­¤å¦å¼€ä¸€ç¯‡ï¼Œä»‹ç»ä¸€ä¸‹åˆ†å¸ƒå¼é”ã€‚ 1. ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”ï¼Ÿ ä½•ä¸ºåˆ†å¸ƒå¼é”ï¼Œä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼é”ï¼Ÿ...</description>
      <pubDate>Thu, 04 Apr 2024 00:00:00 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>é—²è¯æ¼«è°ˆï¼š æœ¬æ¥æ˜¯æƒ³è¦å†™ä¸€ç¯‡å…³äº Spring æä¾›çš„ RedisLockRegistry çš„ä½¿ç”¨æ–¹æ³•åŠåº•å±‚åŸç†è§£æçš„æ–‡ç« ï¼Œå†™ç€å†™ç€å‘ç°å¾—å…ˆä»‹ç»ä¸€ä¸‹åˆ†å¸ƒå¼é”çš„åŸºæœ¬åŸç†ï¼Œæ‰èƒ½æœ‰åŠ©äºç†è§£ä¸€äº›å®ç°å†…å®¹ã€‚æœ€åå‘ç°å…³äºåˆ†å¸ƒå¼é”çš„åŸºæœ¬ä»‹ç»ä¹Ÿå æ®äº†è¾ƒå¤§ç¯‡å¹…ï¼Œå› æ­¤å¦å¼€ä¸€ç¯‡ï¼Œä»‹ç»ä¸€ä¸‹åˆ†å¸ƒå¼é”ã€‚</p>
</blockquote>
<h2>1. ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼é”ï¼Ÿ</h2>
<p>ä½•ä¸ºåˆ†å¸ƒå¼é”ï¼Œä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼é”ï¼Ÿåœ¨è§£ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œéœ€è¦å…ˆä»‹ç»æœ¬åœ°é”çš„æ¦‚å¿µã€‚Java æä¾›äº† synchronized å…³é”®å­—å’Œ juc ä¸­çš„ Lock é”ï¼Œè¿™ä¸¤è€…éƒ½æ˜¯æœ¬åœ°é”ã€‚æœ¬åœ°é”æŒ‡çš„æ˜¯ï¼Œè¯¥é”åªé’ˆå¯¹å½“å‰è™šæ‹Ÿæœºæœ‰æ•ˆï¼Œä¹Ÿå°±æ˜¯å½“ä½ éƒ¨ç½²è¿è¡Œäº†ä¸€ä¸ª Java é¡¹ç›® A å¹¶ä¸”è·å–é”æ—¶ï¼Œæ–°èµ·å¦ä¸€ä¸ª Java é¡¹ç›®ï¼ŒåŒæ ·è¿˜å¯ä»¥è·å–é”ï¼Œè¿™ä¸¤ä¸ªé”ä¹‹é—´æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚è¿™ä¾¿å±äºæœ¬åœ°é”ã€‚å› æ­¤ï¼Œå½“ä½ çš„æœåŠ¡åªéœ€è¦éƒ¨ç½²ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œé‚£ä¹ˆåªéœ€è¦ç”¨åˆ°æœ¬åœ°é”å³å¯ã€‚å½“ä½ çš„ç³»ç»Ÿéœ€è¦æ”¯æ’‘é«˜å¹¶å‘ã€é«˜æ€§èƒ½ç­‰ç‰¹æ€§è€Œå»éƒ¨ç½²å¤šèŠ‚ç‚¹æ—¶ï¼Œæœ¬åœ°é”ä¾¿ä¸å¤Ÿç”¨äº†ã€‚æœ¬åœ°é”æ— æ³•è§£å†³å¤šèŠ‚ç‚¹ä¹‹é—´çš„èµ„æºç«äº‰é—®é¢˜ã€‚å› æ­¤ï¼Œä¾¿éœ€è¦ç”¨åˆ°åˆ†å¸ƒå¼é”ã€‚åœ¨åˆ†å¸ƒå¼é”ä¸­ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹è·å–åˆ°é”åï¼Œå…¶ä½™èŠ‚ç‚¹åœ¨è¯¥é”è¢«é‡Šæ”¾å‰å‡ä¸å¯ä»¥è·å–é”ã€‚
å¦‚ä½•å®ç°åˆ†å¸ƒå¼é”ï¼Ÿåˆ†å¸ƒå¼é”æ²¡æœ‰é‚£ä¹ˆç„ä¹ï¼Œå…¶å®å°±æ˜¯å°†èµ„æºç«äº‰æ¡ä»¶ä»å•ä¸ªèŠ‚ç‚¹ä¸­æ‹å‡ºæ¥ï¼Œæ”¾åˆ°ä¸€ä¸ªå…¬å…±çš„ã€å„èŠ‚ç‚¹å‡å¯ä»¥è®¿é—®åˆ°çš„åœ°æ–¹ï¼Œå„èŠ‚ç‚¹éƒ½å…±åŒå»äº‰æŠ¢è¿™ä¸ªé”ã€‚è¿™æ ·ï¼Œå¤§å®¶å°±éƒ½èƒ½çœ‹åˆ°è¿™ä¸ªé”çš„äº‰æŠ¢æƒ…å†µï¼Œè‡ªç„¶å¯ä»¥è¿›è¡Œé”çš„è°ƒåº¦ç®¡æ§ã€‚</p>
<h2>2. åˆ†å¸ƒå¼é”ç†è®ºçš„ç®€å•å›¾ç¤º</h2>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸€å¼€å§‹ï¼Œä¸‰ä¸ªèŠ‚ç‚¹å…±åŒå»äº‰æŠ¢ä¸€æŠŠé”</p>
<figure><img src="http://zzk31.320.io//img/20240403095528.png" alt="å›¾1" tabindex="0" loading="lazy"><figcaption>å›¾1</figcaption></figure>
<p>æ¥ç€ï¼ŒèŠ‚ç‚¹ A ç‡å…ˆæŠ¢åˆ°äº†è¿™ä¸ªé”</p>
<figure><img src="http://zzk31.320.io/img/20240403095923.png" alt="å›¾2" tabindex="0" loading="lazy"><figcaption>å›¾2</figcaption></figure>
<p>åœ¨èŠ‚ç‚¹ A æ‰§è¡Œå®Œé”å†…æ“ä½œåï¼Œé‡Šæ”¾äº†è¿™æŠŠé”ï¼Œå¦å¤–ä¸¤ä¸ªèŠ‚ç‚¹ç»§ç»­äº‰æŠ¢è¯¥é”</p>
<figure><img src="http://zzk31.320.io/img/20240403100024.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h2>3. åˆ†å¸ƒå¼é”çš„ç‰¹å¾</h2>
<p>ä¸ºäº†èƒ½å¤Ÿç¨³å®šå¯é çš„å®ç°ä¸Šè¿°ç›®çš„ï¼Œä¸€ä¸ªåˆ†å¸ƒå¼é”éœ€è¦å…·å¤‡ä»¥ä¸‹ç‰¹å¾ï¼š</p>
<ul>
<li>äº’æ–¥æ€§: ä»»æ„æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½æŒæœ‰é”ã€‚</li>
<li>é”è¶…æ—¶é‡Šæ”¾ï¼šæŒæœ‰é”è¶…æ—¶ï¼Œå¯ä»¥é‡Šæ”¾ï¼Œé˜²æ­¢ä¸å¿…è¦çš„èµ„æºæµªè´¹ï¼Œä¹Ÿå¯ä»¥é˜²æ­¢æ­»é”ã€‚</li>
<li>å¯é‡å…¥æ€§:ä¸€ä¸ªçº¿ç¨‹å¦‚æœè·å–äº†é”ä¹‹å,å¯ä»¥å†æ¬¡å¯¹å…¶è¯·æ±‚åŠ é”ã€‚</li>
<li>é«˜æ€§èƒ½å’Œé«˜å¯ç”¨ï¼šåŠ é”å’Œè§£é”éœ€è¦å¼€é”€å°½å¯èƒ½ä½ï¼ŒåŒæ—¶ä¹Ÿè¦ä¿è¯é«˜å¯ç”¨ï¼Œé¿å…åˆ†å¸ƒå¼é”å¤±æ•ˆã€‚</li>
<li>å®‰å…¨æ€§ï¼šé”åªèƒ½è¢«æŒæœ‰çš„å®¢æˆ·ç«¯åˆ é™¤ï¼Œä¸èƒ½è¢«å…¶ä»–å®¢æˆ·ç«¯åˆ é™¤</li>
</ul>
<h2>4. Redis åˆ†å¸ƒå¼é”å®ç°æ–¹å¼ç®€ä»‹</h2>
<p>åˆ†å¸ƒå¼é”çš„å®ç°å¯ä»¥æœ‰å¤šç§æ–¹å¼ï¼Œç›®å‰æ¯”è¾ƒç†ŸçŸ¥çš„æœ‰ Zookeeperã€æ•°æ®åº“å’Œ Redis å®ç°ã€‚æˆ‘ä»¬è¿™é‡Œä¸»è¦ä»‹ç»åœ¨ Redis ä¸­å®ç°åˆ†å¸ƒå¼é”ã€‚</p>
<p>å…ˆè¯´ä¸€ä¸‹ Redis ä¸­å®ç°åˆ†å¸ƒå¼é”çš„åŸºæœ¬ç†è®ºã€‚å¤šä¸ªèŠ‚ç‚¹å»åŒä¸€ä¸ª Redis æœåŠ¡è®¾ç½®ä¸€ä¸ªç›¸åŒçš„ keyï¼Œè°å…ˆè®¾ç½®æˆåŠŸè°å°±æŠ¢åˆ°äº†è¯¥é”ï¼ŒæœªæˆåŠŸè®¾ç½® key çš„èŠ‚ç‚¹åˆ™ç­‰å¾…é”é‡Šæ”¾ï¼ˆè¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯èŠ‚ç‚¹ä¸»åŠ¨å®šæ—¶å»å°è¯•è®¾ç½®è¯¥ keyï¼Œå¤±è´¥äº†å°±è¯´æ˜è¯¥é”è¿˜åœ¨ä½¿ç”¨;å¦ä¸€ç§æ–¹å¼æ˜¯åˆ©ç”¨ Redis æä¾›çš„å‘å¸ƒè®¢é˜…åŠŸèƒ½ï¼ŒèŠ‚ç‚¹è®¢é˜…è¯¥ keyï¼Œå½“è¯¥ key å¤±æ•ˆæ—¶ï¼Œredis ä¸»åŠ¨é€šçŸ¥èŠ‚ç‚¹ï¼‰ã€‚å½“ç„¶ï¼Œä¸€ä¸ª key ä¸èƒ½æ°¸è¿œç”Ÿæ•ˆï¼ŒèŠ‚ç‚¹éœ€è¦ä¸º key è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¿™æ®µæ—¶é—´å°±æ˜¯è¯¥èŠ‚ç‚¹æŒæœ‰è¯¥é”çš„æ—¶é—´ã€‚å½“è¯¥ key è¿‡æœŸï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥ç»§ç»­äº‰æŠ¢è¯¥é”ã€‚å› æ­¤ï¼Œç¬¬ 3 å°èŠ‚ä¸­æåˆ°çš„äº’æ–¥æ€§å’Œé”è¶…æ—¶é‡Šæ”¾å¾—ä»¥åŸºæœ¬å®ç°ã€‚</p>
<p>Redis ä¸ºæˆ‘ä»¬æä¾›äº†<code>setnx</code>å’Œ<code>expire</code>å‘½ä»¤ã€‚ä½¿ç”¨<code>setnx</code>æ¥æŠ¢é”ï¼Œå¦‚æœæŠ¢åˆ°ä¹‹åï¼Œå†ç”¨<code>expire</code>ä¸ºé”è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢é”å¿˜è®°äº†é‡Šæ”¾ã€‚</p>
<p>ç„¶è€Œ setnx å’Œ expire æ˜¯ä¸¤ä¸ªå‘½ä»¤,å¹¶éåŸå­æ“ä½œã€‚å¦‚æœæ‰§è¡Œäº†<code>setnx</code>å‘½ä»¤åï¼ŒèŠ‚ç‚¹å´©æºƒäº†ï¼Œè¿˜æ²¡æ¥å¾—åŠæ‰§è¡Œ<code>expire</code>å‘½ä»¤ï¼Œé‚£ä¹ˆè¯¥é”å°±æ°¸è¿œä¸ä¼šè¿‡æœŸäº†ï¼Œå…¶ä»–èŠ‚ç‚¹å°±æ°¸è¿œæ— æ³•è·å¾—è¯¥é”äº†ã€‚</p>
<blockquote>
<p>è¿™é‡Œçš„åŸå­æ“ä½œä¸æˆ‘ä»¬åœ¨æ•°æ®åº“äº‹åŠ¡ä¸­ç”¨åˆ°çš„åŸå­æ€§å¹¶ä¸ç­‰åŒã€‚æ•°æ®åº“äº‹åŠ¡ä¸­çš„åŸå­æ€§æŒ‡â€œè¦ä¹ˆéƒ½æˆåŠŸè¦ä¹ˆéƒ½å¤±è´¥â€ã€‚è€Œæˆ‘ä»¬è¿™é‡Œçš„åŸå­æ“ä½œï¼Œä»…æ˜¯æŒ‡æ“ä½œä¸å¯è¢«æ‹†åˆ†ï¼Œå®é™…ä¸Š Redis ä¸­æ‰§è¡Œ Lua è„šæœ¬å³ä½¿å‡ºé”™ä¹Ÿä¸ä¼šå›æ»šã€‚</p>
</blockquote>
<p>ä¸ºäº†è§£å†³è¯¥é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Lua è„šæœ¬ã€‚Lua è„šæœ¬å…è®¸æˆ‘ä»¬å°†å¤šä¸ªå‘½ä»¤æ‰“åŒ…æ‰§è¡Œ,æˆä¸ºåŸå­æ“ä½œã€‚</p>
<p>é™¤äº†ä½¿ç”¨ Lua è„šæœ¬ï¼Œä¿è¯ <code>setnx</code> + <code>expire</code> ä¸¤æ¡æŒ‡ä»¤çš„åŸå­æ€§ï¼ŒRedis è¿˜ä¸ºæˆ‘ä»¬æä¾›äº† <code>set</code> æŒ‡ä»¤æ‰©å±•å‚æ•°ï¼Œé€šè¿‡ä½¿ç”¨æ‰©å±•å‚æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å®ç°ä¸Šé¢çš„ç›®çš„ã€‚</p>
<div class="language-Redis" data-ext="Redis" data-title="Redis"><pre class="language-Redis"><code>SET key value [EX seconds] [PX milliseconds] [NX|XX]ï¼‰
</code></pre></div><ul>
<li>EX seconds :è®¾å®š key çš„è¿‡æœŸæ—¶é—´ï¼Œæ—¶é—´å•ä½æ˜¯ç§’ã€‚</li>
<li>PX milliseconds: è®¾å®š key çš„è¿‡æœŸæ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’</li>
<li>NX :è¡¨ç¤º key ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œæ‰èƒ½ set æˆåŠŸã€‚</li>
<li>XX: è¡¨ç¤º key å­˜åœ¨çš„æ—¶å€™ï¼Œæ‰èƒ½ set æˆåŠŸã€‚</li>
</ul>
<p>è§£å†³äº†è®¾ç½® key å’Œä¸º key è®¾ç½®è¿‡æœŸæ—¶é—´ä¸¤ä¸ªå‘½ä»¤çš„åŸå­æ“ä½œé—®é¢˜ï¼Œæˆ‘ä»¬è¿˜æ— æ³•å®ç°ä¸€æŠŠé è°±çš„åˆ†å¸ƒå¼é”ã€‚å‡è®¾è¿™ç§åœºæ™¯ï¼šèŠ‚ç‚¹ a è·å–é”æˆåŠŸï¼Œå¼€å§‹æ‰§è¡Œä¸´ç•ŒåŒºä»£ç ã€‚å½“é”è¿‡æœŸäº†ï¼ŒèŠ‚ç‚¹ a è¿˜æ²¡æ‰§è¡Œå®Œä¸´ç•ŒåŒºä»£ç ã€‚æ­¤æ—¶èŠ‚ç‚¹ b ä¹Ÿè¯·æ±‚è¿‡æ¥ï¼Œæ˜¾ç„¶èŠ‚ç‚¹ b æ˜¯å¯ä»¥æˆåŠŸè·å¾—è¯¥é”çš„ã€‚èŠ‚ç‚¹ b ä¹Ÿå¼€å§‹æ‰§è¡Œä¸´ç•ŒåŒºä»£ç ï¼Œé‚£ä¹ˆä¸´ç•ŒåŒºä»£ç çš„äº’æ–¥æ€§ä¸²è¡Œæ€§å°±è¢«ç ´åäº†ã€‚æ­¤å¤–ï¼Œå½“èŠ‚ç‚¹ a æ‰§è¡Œå®Œä¸´ç•ŒåŒºä»£ç ï¼Œå»é‡Šæ”¾é”ï¼Œç„¶è€Œæ­¤æ—¶èŠ‚ç‚¹ b è¿˜æ²¡æ‰§è¡Œå®Œä¸´ç•ŒåŒºä»£ç ï¼ˆèŠ‚ç‚¹ a ä»¥ä¸ºé‡Šæ”¾çš„æ˜¯è‡ªå·±çš„é”ï¼‰ã€‚è¿™ä¸ªé—®é¢˜åŒæ ·å¾ˆä¸¥é‡ã€‚ä¸€ä¸ªèŠ‚ç‚¹çš„é”è¢«å¦ä¸€ä¸ªèŠ‚ç‚¹é”™è¯¯é‡Šæ”¾äº†ï¼Œä¸æ»¡è¶³ ç¬¬ 3 å°èŠ‚ä¸­æåˆ°<em>å®‰å…¨æ€§</em>ã€‚</p>
<p>æ€»ç»“ä»¥ä¸‹ï¼Œä¸Šé¢æåˆ°çš„ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>é”è¿‡æœŸé‡Šæ”¾äº†ï¼ŒèŠ‚ç‚¹çš„ä¸šåŠ¡è¿˜æœªæ‰§è¡Œå®Œã€‚</li>
<li>é”è¢«åˆ«çš„èŠ‚ç‚¹è¯¯åˆ ã€‚</li>
</ol>
<p>æˆ‘ä»¬å…ˆè§£å†³é—®é¢˜ 2ã€‚ä¸ºäº†é˜²æ­¢èŠ‚ç‚¹ä¸Šçš„é”è¢«åˆ«çš„èŠ‚ç‚¹è¯¯åˆ ï¼Œæˆ‘ä»¬å¯ä»¥å°† value å€¼è®¾ç½®ä¸ºä¸€ä¸ªèƒ½å¤Ÿæ ‡è®°å½“å‰èŠ‚ç‚¹çš„å”¯ä¸€å€¼ã€‚åœ¨é‡Šæ”¾é”æ—¶ï¼Œå¯¹ value è¿›è¡Œæ ¡éªŒï¼Œä»…é‡Šæ”¾å±äºå½“å‰èŠ‚ç‚¹ä¸Šçš„é”ã€‚
ä¼ªä»£ç å¦‚ä¸‹ï¼š</p>
<div class="language-C" data-ext="C" data-title="C"><pre class="language-C"><code>// ä¸Šé”
redisClient.set(key, clientId, "NX", "EX", expireTime) // clientIdå³æ˜¯æ ‡è®°å½“å‰èŠ‚ç‚¹çš„å”¯ä¸€å€¼
// æ‰§è¡Œä¸šåŠ¡æ–¹æ³•
doBusness()
// æ¯”è¾ƒå¹¶è§£é”
if compare(redisClient.get(key), clientId)
  redisClient.del(key)
</code></pre></div><p>ä¸Šè¿°æ¯”è¾ƒ value ç›¸ç­‰ååˆ é™¤ key çš„æ“ä½œä¹Ÿå¯ä»¥ä½¿ç”¨ Lua è„šæœ¬æ¥å®ç°åŸå­æ“ä½œ</p>
<p>ç¦»è®¾è®¡ä¸€ä¸ªé è°±çš„åˆ†å¸ƒå¼é”è¶Šæ¥è¶Šè¿‘äº†ï¼Œæˆ‘ä»¬è¿˜å‰©ä¸‹ä¸€ä¸ªé—®é¢˜æ²¡è§£å†³ï¼š é”è¿‡æœŸé‡Šæ”¾äº†ï¼ŒèŠ‚ç‚¹çš„ä¸šåŠ¡è¿˜æœªæ‰§è¡Œå®Œ</p>
<p>ä¸€ç§ç®€å•çš„æ–¹æ³•æ˜¯å°†é”çš„è¿‡æœŸæ—¶é—´è®¾ç½®å¾—ä¹…ä¸€ç‚¹ï¼Œè¿™å½“ç„¶ä¹Ÿå¯ä»¥ã€‚
ä½†æ˜¯è¿™ç§å¤„ç†æ–¹å¼å¾ˆä¸çµæ´»ï¼Œè€Œä¸”ä¸åŒä¸šåŠ¡æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´ä¸åŒï¼Œæœ‰çš„ä¹…ä¸€ç‚¹ï¼Œæœ‰çš„çŸ­ä¸€ç‚¹ã€‚å¦‚æœå¯¹æ‰€æœ‰ä¸šåŠ¡æ–¹æ³•éƒ½åº”ç”¨ä¸€ä¸ªæ¯”è¾ƒä¹…çš„è¿‡æœŸæ—¶é—´ï¼Œé‚£ä¹ˆç³»ç»Ÿçš„å“åº”é€Ÿåº¦å°±ä¼šå˜æ…¢ï¼Œä¸è¶³ä»¥ç§°å¾—ä¸Š<em>é«˜å¯ç”¨é«˜æ€§èƒ½</em></p>
<p>ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•æ˜¯è®¾ç½®ä¸€ä¸ªå®šæ—¶çº¿ç¨‹ï¼Œå‘¨æœŸæ€§åœ°æ£€æŸ¥é”ï¼Œå¯¹å³å°†è¿‡æœŸçš„é”å»¶é•¿å…¶è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢é”è¿‡æœŸæå‰é‡Šæ”¾ã€‚åœ¨è¿™æ–¹é¢ï¼ŒJava çš„ Redission ä¾¿æ˜¯é‡‡ç”¨äº†è¿™ç§æ–¹å¼ï¼Œå…¶ä½¿ç”¨äº†ä¸€ä¸ª watch dog æœºåˆ¶æ¥å‘¨æœŸæ£€æŸ¥é”ï¼Œå¯¹é”æ‰§è¡Œå»¶é•¿è¿‡æœŸæ—¶é—´æ“ä½œã€‚</p>
<p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„åˆ†å¸ƒå¼é”å·²ç»åšåˆ°äº†<em>äº’æ–¥æ€§</em>ã€<em>é”è¶…æ—¶é‡Šæ”¾</em>ã€<em>é«˜æ€§èƒ½é«˜å¯ç”¨</em>å’Œ<em>å®‰å…¨æ€§</em>ï¼Œè¿˜å‰©ä¸‹ä¸€ä¸ª<em>å¯é‡å…¥</em>ç‰¹æ€§è¿˜æ²¡å®ç°ã€‚å…³äºå¯é‡å…¥ï¼Œé€šå¸¸ç”±å…·ä½“çš„å®¢æˆ·ç«¯æ¥å®ç°ï¼Œæ¯”å¦‚ Spring æä¾›çš„ RedisLockRegistryï¼Œåˆ™æ˜¯åˆ©ç”¨çš„ JDK æä¾›çš„ Lock æ¥å®ç°å¯é‡å…¥ã€‚</p>
<div class="hint-container tip">
<p class="hint-container-title">æ‹‰ä¸ª Star</p>
<ul>
<li>çœ‹åˆ°è¿™é‡Œï¼Œå¦‚æœ<a href="https://github.com/shzyjbr/person-database" target="blank">æœ¬ç¯‡æ–‡ç« </a>çš„å†…å®¹å¸®åŠ©åˆ°ä½ ï¼Œè¿˜è¯·ç‚¹ä¸ªå…è´¹çš„ Starï¼Œæ„Ÿè°¢ã€‚ä¼ é€é—¨ï¼š<a href="https://github.com/shzyjbr/person-database" target="blank">GitHub</a></li>
</ul>
</div>
]]></content:encoded>
      <enclosure url="http://zzk31.320.io//img/20240403095528.png" type="image/png"/>
    </item>
    <item>
      <title>RedisLockRegistryçš„ä»‹ç»åŠæºç è¯¦è§£</title>
      <link>https://kkwalking.github.com/person-database/person-database/java/redis-lock-registry.html</link>
      <guid>https://kkwalking.github.com/person-database/person-database/java/redis-lock-registry.html</guid>
      <source url="https://kkwalking.github.com/person-database/person-database/rss.xml">RedisLockRegistryçš„ä»‹ç»åŠæºç è¯¦è§£</source>
      <description>RedisLockRegistry çš„ä»‹ç»åŠæºç è¯¦è§£ 1. RedisLockRegistry çš„åŸºæœ¬ä½¿ç”¨ Spring æä¾›äº†ä¸€å¥—åˆ†å¸ƒå¼é”çš„è§£å†³æ–¹æ¡ˆâ€”â€”â€”RedisLockRegistry 1.1 ç®€å•å…¥é—¨ä½¿ç”¨ 1.2 å·¥å…·å°è£… 2. æºç è¯¦è§£ 2.1 å¯é‡å…¥ 2.2 è‡ªæ—‹ç­‰å¾…ã€PubSub æœºåˆ¶ 3. å‚è€ƒæ–‡ç«  https://juejin.cn/...</description>
      <pubDate>Tue, 02 Apr 2024 00:00:00 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>1. RedisLockRegistry çš„åŸºæœ¬ä½¿ç”¨</h2>
<p>Spring æä¾›äº†ä¸€å¥—åˆ†å¸ƒå¼é”çš„è§£å†³æ–¹æ¡ˆâ€”â€”â€”RedisLockRegistry</p>
<h3>1.1 ç®€å•å…¥é—¨ä½¿ç”¨</h3>
<h3>1.2 å·¥å…·å°è£…</h3>
<h2>2. æºç è¯¦è§£</h2>
<h3>2.1 å¯é‡å…¥</h3>
<h3>2.2 è‡ªæ—‹ç­‰å¾…ã€PubSub æœºåˆ¶</h3>
<h2>3. å‚è€ƒæ–‡ç« </h2>
<ul>
<li>https://juejin.cn/post/6924573058674098184</li>
<li>https://juejin.cn/post/6844904041185558536?searchId=20240402230806574C1E91E47F3A2F6C0A</li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>å…³äºæ­»é”çš„ä¸€ç‚¹ç¬”è®°</title>
      <link>https://kkwalking.github.com/person-database/person-database/operating-system/deadlock.html</link>
      <guid>https://kkwalking.github.com/person-database/person-database/operating-system/deadlock.html</guid>
      <source url="https://kkwalking.github.com/person-database/person-database/rss.xml">å…³äºæ­»é”çš„ä¸€ç‚¹ç¬”è®°</source>
      <description>æ‹‰ä¸ªStar å¦‚æœæœ¬çŸ¥è¯†åº“çš„å†…å®¹å¸®åŠ©åˆ°ä½ ï¼Œè¿˜è¯·ç‚¹ä¸ªå…è´¹çš„Starï¼Œæ„Ÿè°¢ã€‚ä¼ é€é—¨ï¼šGitHub å£°æ˜ï¼šä»¥ä¸‹å†…å®¹å‡æ¥è‡ªä¹¦ç±ã€Šç°ä»£æ“ä½œç³»ç»Ÿã€‹ï¼Œå†…å®¹ç•¥æœ‰æ”¹åŠ¨ã€‚ 1.èµ„æº æ­»é”çš„äº§ç”Ÿä¸èµ„æºç›¸å…³ï¼Œå› è€Œå…ˆç»™å‡ºèµ„æºçš„å®šä¹‰ï¼šåœ¨è¿›ç¨‹å¯¹è®¾å¤‡ã€æ–‡ä»¶ç­‰å–å¾—æ’ä»–æ€§è®¿é—®æƒæ—¶ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°æ­»é”ï¼Œä¸ºä¾¿äºè®¨è®ºï¼ŒæŠŠè¿™ç±»éœ€è¦æ’ä»–æ€§ä½¿ç”¨çš„å¯¹è±¡ç§°ä¸ºèµ„æºï¼ˆresourceï¼‰ã€‚èµ„æºå¯ä»¥æ˜¯ç¡¬ä»¶è®¾å¤‡ï¼ˆå¦‚...</description>
      <pubDate>Wed, 05 Apr 2023 00:00:00 GMT</pubDate>
      <content:encoded><![CDATA[<div class="hint-container tip">
<p class="hint-container-title">æ‹‰ä¸ªStar</p>
<ul>
<li>å¦‚æœ<a href="https://github.com/kkwalking/person-database" target="blank">æœ¬çŸ¥è¯†åº“</a>çš„å†…å®¹å¸®åŠ©åˆ°ä½ ï¼Œè¿˜è¯·ç‚¹ä¸ªå…è´¹çš„Starï¼Œæ„Ÿè°¢ã€‚ä¼ é€é—¨ï¼š<a href="https://github.com/kkwalking/person-database" target="blank">GitHub</a></li>
</ul>
</div>
<blockquote>
<p>å£°æ˜ï¼šä»¥ä¸‹å†…å®¹å‡æ¥è‡ªä¹¦ç±ã€Šç°ä»£æ“ä½œç³»ç»Ÿã€‹ï¼Œå†…å®¹ç•¥æœ‰æ”¹åŠ¨ã€‚</p>
</blockquote>
<h3>1.èµ„æº</h3>
<p>æ­»é”çš„äº§ç”Ÿä¸èµ„æºç›¸å…³ï¼Œå› è€Œå…ˆç»™å‡ºèµ„æºçš„å®šä¹‰ï¼šåœ¨è¿›ç¨‹å¯¹è®¾å¤‡ã€æ–‡ä»¶ç­‰å–å¾—æ’ä»–æ€§è®¿é—®æƒæ—¶ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°æ­»é”ï¼Œä¸ºä¾¿äºè®¨è®ºï¼ŒæŠŠè¿™ç±»éœ€è¦æ’ä»–æ€§ä½¿ç”¨çš„å¯¹è±¡ç§°ä¸ºèµ„æºï¼ˆresourceï¼‰ã€‚èµ„æºå¯ä»¥æ˜¯ç¡¬ä»¶è®¾å¤‡ï¼ˆå¦‚æ‰“å°æœºï¼‰ï¼Œæˆ–æ˜¯ä¸€ç»„ä¿¡æ¯ï¼ˆå¦‚æ•°æ®åº“ä¸­ä¸€æ¡åŠ é”çš„è®°å½•ï¼‰ã€‚ç®€è€Œè¨€ä¹‹ï¼Œèµ„æºæ˜¯éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå¿…é¡»èƒ½è·å¾—ã€ä½¿ç”¨å’Œé‡Šæ”¾çš„ä»»ä½•ä¸œè¥¿ã€‚</p>
<p>èµ„æºåˆåˆ†ä¸ºå¯æŠ¢å èµ„æºå’Œä¸å¯æŠ¢å èµ„æºã€‚</p>
<p>å¯æŠ¢å èµ„æºå¯ä»¥ä»æ‹¥æœ‰å®ƒçš„è¿›ç¨‹ä¸­è¢«æŠ¢å è€Œä¸ä¼šäº§ç”Ÿä»»ä½•å‰¯ä½œç”¨ï¼Œå­˜å‚¨å™¨å°±æ˜¯ä¸€ç±»å¯æŠ¢å çš„èµ„æºã€‚æ“ä½œç³»ç»Ÿå¯ä»¥æŠŠä¸€ä¸ªè¿›ç¨‹ä»å†…å­˜ä¸­æ¢å‡ºï¼Œæ¢å…¥å¦ä¸€ä¸ªè¿›ç¨‹ã€‚</p>
<p>ä¸å¯æŠ¢å èµ„æºæ˜¯æŒ‡åœ¨ä¸å¼•èµ·ç›¸å…³çš„è®¡ç®—å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œæ— æ³•æŠŠå®ƒä»å æœ‰å®ƒçš„è¿›ç¨‹å¤„æŠ¢å è¿‡æ¥ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨æ‰“å°æœºæ¥æ‰“å°å†…å®¹ï¼Œçªç„¶å°†æ‰“å°æœºåˆ†é…ç»™å¦ä¸€ä¸ªè¿›ç¨‹å¯¼è‡´æ‰“å°å†…å®¹æ··ä¹±ã€‚å› æ­¤æ‰“å°æœºå±äºä¸å¯æŠ¢å èµ„æºã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œæ­»é”ä¸ä¸å¯æŠ¢å èµ„æºæœ‰å…³ã€‚</p>
<h3>2.èµ„æºè·å–</h3>
<p>ä½¿ç”¨ä¿¡å·é‡æ¥ç®¡ç†èµ„æºï¼Œdownæ“ä½œæ¥è·å–èµ„æºï¼Œä½¿ç”¨èµ„æºï¼Œupæ“ä½œæ¥é‡Šæ”¾èµ„æºã€‚å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<div class="language-C" data-ext="C" data-title="C"><pre class="language-C"><code>tydedef int semaphore;
semaphore resource_1;
void process_A(void) {
    down(&amp;resource_1);
    use(&amp;resource_1);
    up(&amp;resource_1);
}
</code></pre></div><p>é€šå¸¸ï¼Œè¿›ç¨‹éœ€è¦ä¸¤ä¸ªæˆ–æ›´å¤šçš„èµ„æºï¼Œå®ƒä»¬å¯ä»¥é¡ºåºè·å–ï¼Œå¦‚ä¸‹æ‰€ç¤º</p>
<div class="language-C" data-ext="C" data-title="C"><pre class="language-C"><code>tydedef int semaphore;
semaphore resource_1;
semaphore resource_2;
void process_A(void) {
    down(&amp;resource_1);
    down(&amp;resource_2);
    use_resources();
    up(&amp;resource_2);
    up(&amp;resource_1);
}
</code></pre></div><p>ç°åœ¨è€ƒè™‘ä¸¤ä¸ªè¿›ç¨‹ï¼ˆAå’ŒBï¼‰ä»¥åŠä¸¤ä¸ªèµ„æºçš„æƒ…å†µã€‚</p>
<p>ç¬¬ä¸€ç§æ–¹å¼å¦‚ä¸‹ï¼š</p>
<div class="language-C" data-ext="C" data-title="C"><pre class="language-C"><code>typedef int semaphore;
semaphore resource_1;
semaphore resource_2;
void process_A(void) {
    down(&amp;resource_1);
    down(&amp;resource_2);
    use_resources();
    up(&amp;resource_2);
    up(&amp;resource_1);
}
void process_B(void) {
   down(&amp;resource_1);
    down(&amp;resource_2);
    use_resources();
    up(&amp;resource_2);
    up(&amp;resource_1);
}
</code></pre></div><p>ç¬¬äºŒç§æ–¹å¼å¦‚ä¸‹ï¼š</p>
<div class="language-C" data-ext="C" data-title="C"><pre class="language-C"><code>typedef int semaphore;
semaphore resource_1;
semaphore resource_2;
void process_A(void) {
    down(&amp;resource_1);
    down(&amp;resource_2);
    use_resources();
    up(&amp;resource_2);
    up(&amp;resource_1);
}
void process_B(void) {
    down(&amp;resource_2);
    down(&amp;resource_1);
    use_resources();
    up(&amp;resource_1);
    up(&amp;resource_2);
}
</code></pre></div><p>ç¬¬ä¸€ç§æ–¹å¼ä¸­ï¼Œä¸¤ä¸ªè¿›ç¨‹ä»¥ç›¸åŒçš„æ¬¡åºè¯·æ±‚èµ„æºï¼Œç¬¬äºŒç§æ–¹å¼ä¸­ï¼Œä¸¤ä¸ªè¿›ç¨‹è¯·æ±‚èµ„æºçš„æ¬¡åºä¸åŒã€‚è¿™å°±å¯èƒ½é€ æˆä¸åŒçš„ç»“æœã€‚</p>
<p>åœ¨ç¬¬ä¸€ç§æ–¹å¼ä¸­ï¼Œä¸€ä¸ªè¿›ç¨‹å…ˆäºå¦ä¸€ä¸ªè¿›ç¨‹è·å–èµ„æºï¼Œä»è€Œèƒ½å¤ŸæˆåŠŸç¬¬äºŒä¸ªèµ„æºå¹¶å®Œæˆå®ƒçš„ä»»åŠ¡ã€‚å¦‚æœå¦ä¸€ä¸ªè¿›ç¨‹æƒ³åœ¨ç¬¬ä¸€ä¸ªèµ„æºè¢«é‡Šæ”¾ä¹‹å‰è·å–è¯¥èµ„æºï¼Œåˆ™ä¼šç”±äºèµ„æºè¢«åŠ é”è€Œè¢«é˜»å¡ï¼Œç›´åˆ°è¯¥èµ„æºå¯ç”¨ä¸ºæ­¢ã€‚ç„¶è€Œåœ¨ç¬¬äºŒç§æ–¹å¼ä¸­ï¼Œåˆ™æœ‰äº§ç”Ÿæ­»é”çš„é£é™©ã€‚å¯èƒ½è¿›ç¨‹Aè·å–äº†èµ„æº1ï¼Œè¿›ç¨‹Bè·å–äº†èµ„æº2ï¼Œè¿™æ—¶ä¸¤ä¸ªè¿›ç¨‹éƒ½æƒ³è¯·æ±‚è¿˜æœªæ‹¥æœ‰çš„å¦ä¸€ä¸ªèµ„æºï¼Œç„¶è€Œéƒ½ä¼šå› æ­¤è¢«é˜»å¡ï¼Œä¸¤ä¸ªè¿›ç¨‹éƒ½æ— æ³•ç»§ç»­è¿è¡Œã€‚</p>
<h3>3.æ­»é”</h3>
<p>æ­»é”çš„è§„èŒƒå®šä¹‰ï¼šå¦‚æœä¸€ä¸ªè¿›ç¨‹é›†åˆä¸­çš„æ¯ä¸ªè¿›ç¨‹éƒ½åœ¨ç­‰å¾…åªèƒ½ç”±è¯¥è¿›ç¨‹é›†åˆä¸­çš„å…¶ä»–è¿›ç¨‹æ‰èƒ½å¼•å‘çš„äº‹ä»¶ï¼Œé‚£ä¹ˆè¯¥è¿›ç¨‹é›†åˆå°±æ˜¯æ­»é”çš„ã€‚</p>
<p>æ­»é”è¿›ç¨‹é›†åˆä¸­çš„æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½åœ¨ç­‰å¾…å¦ä¸€ä¸ªæ­»é”çš„è¿›ç¨‹å·²ç»å æœ‰çš„èµ„æºï¼Œä½†æ˜¯ç”±äºæ‰€æœ‰è¿›ç¨‹éƒ½ä¸èƒ½è¿è¡Œï¼Œå®ƒä»¬ä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ½æ— æ³•é‡Šæ”¾èµ„æºï¼Œæ‰€ä»¥æ²¡æœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥å”¤é†’ã€‚è¿›ç¨‹çš„æ•°é‡ä»¥åŠå æœ‰æˆ–è€…è¯·æ±‚çš„èµ„æºæ•°é‡å’Œç§ç±»éƒ½æ˜¯æ— å…³ç´§è¦çš„ã€‚è¿™ç§æ­»é”ç§°ä¸ºèµ„æºæ­»é”ï¼ˆresource deadlockï¼‰ã€‚èµ„æºæ­»é”å¾ˆå¸¸è§ï¼Œä½†ä¸æ˜¯å”¯ä¸€ç±»å‹ã€‚</p>
<h4>3.1 èµ„æºæ­»é”çš„æ¡ä»¶</h4>
<p>Coffmanç­‰äººæ€»ç»“äº†å‘ç”Ÿèµ„æºæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼š</p>
<ul>
<li>äº’æ–¥æ¡ä»¶ã€‚æ¯ä¸ªèµ„æºè¦ä¹ˆå·²ç»åˆ†é…ç»™äº†ä¸€ä¸ªè¿›ç¨‹ï¼Œè¦ä¹ˆå°±æ˜¯å¯ç”¨çš„ã€‚</li>
<li>å æœ‰å’Œç­‰å¾…æ¡ä»¶ã€‚å·²ç»å¾—åˆ°äº†æŸä¸ªèµ„æºçš„è¿›ç¨‹ï¼Œå¯ä»¥å†ç”³è¯·æ–°çš„èµ„æºã€‚</li>
<li>ä¸å¯æŠ¢å æ¡ä»¶ã€‚å·²ç»åˆ†é…ç»™æŸä¸€ä¸ªè¿›ç¨‹çš„èµ„æºï¼Œä¸èƒ½è¢«å¼ºåˆ¶æ€§åœ°æŠ¢å ï¼Œå®ƒåªèƒ½ç”±å æœ‰å®ƒçš„è¿›ç¨‹æ˜¾å¼åœ°é‡Šæ”¾ã€‚</li>
<li>å¾ªç¯ç­‰å¾…æ¡ä»¶ã€‚æ­»é”å‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿä¸­ä¸€å®šæœ‰ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„è¿›ç¨‹ç»„æˆçš„ä¸€æ¡ç¯è·¯ï¼Œè¯¥ç¯è·¯ä¸­çš„æ¯ä¸ªè¿›ç¨‹éƒ½åœ¨ç­‰å¾…ç€ä¸‹ä¸€ä¸ªè¿›ç¨‹æ‰€å æœ‰çš„èµ„æºã€‚</li>
</ul>
<p>æœ‰å››ç§å¤„ç†æ­»é”çš„ç­–ç•¥ï¼š</p>
<ul>
<li>å¿½ç•¥è¯¥é—®é¢˜ã€‚</li>
<li>æ£€æµ‹æ­»é”å¹¶ä»ä¸­æ¢å¤ã€‚</li>
<li>é¿å…æ­»é”ã€‚é€šè¿‡ä»”ç»†å¯¹èµ„æºè¿›è¡Œåˆ†é…ï¼Œå¯ä»¥åŠ¨æ€åœ°é¿å…æ­»é”ã€‚</li>
<li>é˜²æ­¢æ­»é”ã€‚é€šè¿‡ç ´åå¼•èµ·æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ä¹‹ä¸€ï¼Œé˜²æ­¢æ­»é”çš„äº§ç”Ÿã€‚</li>
</ul>
<h4>3.2 æ­»é”æ£€æµ‹å’Œæ­»é”æ¢å¤</h4>
<p>ä½¿ç”¨è¿™ç§æŠ€æœ¯çš„ç³»ç»Ÿä¸è¯•å›¾é˜»æ­¢æ­»é”çš„äº§ç”Ÿï¼Œè€Œæ˜¯å…è®¸æ­»é”çš„å‘ç”Ÿï¼Œå½“æ£€æµ‹åˆ°æ­»é”å‘ç”Ÿåï¼Œé‡‡å–æªæ–½è¿›è¡Œæ¢å¤ã€‚</p>
<h5>3.2.1 æ¯ç§ç±»å‹ä¸€ä¸ªèµ„æºçš„æ­»é”æ£€æµ‹</h5>
<p>æ­»é”æ£€æµ‹æ–¹æ³•æœ‰å¤šç§ï¼Œä»ç®€å•çš„ä¾‹å­å¼€å§‹ï¼Œå³æ¯ç§èµ„æºç±»å‹åªæœ‰ä¸€ä¸ªèµ„æºã€‚ä¾‹å¦‚ï¼Œæ‰«æä»ªã€å…‰ç›˜é©±åŠ¨ã€ç»˜å›¾ä»ªå’Œæ‰“å°æœºï¼ˆä»…æœ‰ä¸€å°çš„æƒ…å†µï¼‰ã€‚</p>
<p>é’ˆå¯¹è¿™ç§ç³»ç»Ÿå¯ä»¥æ„é€ ä¸€å¼ èµ„æºåˆ†é…å›¾</p>
<p>å…¶ä¸­ï¼Œåœ†åœˆæŒ‡ä»£è¿›ç¨‹ï¼Œæ­£æ–¹å½¢æŒ‡ä»£èµ„æº</p>
<ol>
<li>Aè¿›ç¨‹æŒæœ‰Rèµ„æºï¼Œä¸”éœ€è¦Sèµ„æºã€‚</li>
<li>Bè¿›ç¨‹ä¸æŒæœ‰ä»»ä½•èµ„æºï¼Œä½†éœ€è¦Tèµ„æº</li>
<li>Cè¿›ç¨‹ä¸æŒæœ‰ä»»ä½•èµ„æºï¼Œä½†éœ€è¦Sèµ„æºã€‚</li>
<li>Dè¿›ç¨‹æŒæœ‰Uèµ„æºï¼Œä¸”éœ€è¦Sèµ„æºå’ŒTèµ„æºã€‚</li>
<li>Eè¿›ç¨‹æŒæœ‰Tèµ„æºï¼Œä¸”éœ€è¦Vèµ„æºã€‚</li>
<li>Fè¿›ç¨‹æŒæœ‰Wèµ„æºï¼Œä¸”éœ€è¦Sèµ„æºã€‚</li>
<li>Gè¿›ç¨‹æŒæœ‰Vèµ„æºï¼Œä¸”éœ€è¦Uèµ„æºã€‚</li>
</ol>
<p>![image-20210306164921075](D:\OneDrive - e.gzhu.edu.cn\æ–‡æ¡£\blog\image-20210306164921075.png)</p>
<p>ç°åœ¨æ£€æµ‹æ­»é”çš„äº§ç”Ÿã€‚ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºå­˜åœ¨ä¸€ä¸ªç¯ï¼ˆDTEVGUDï¼‰ï¼Œå…¶ä¸­Dã€Eã€Gå·²ç»æ­»é”ã€‚è¿™æ ·çš„å›¾è™½ç„¶å¯ä»¥çœ‹å‡ºæ­»é”è¿›ç¨‹ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ­£è§„çš„ç®—æ³•æ¥æ£€æµ‹æ­»é”ã€‚æœ‰å¾ˆå¤šæ£€æµ‹æœ‰å‘å›¾ç¯è·¯çš„æ–¹æ³•ã€‚ä¸‹é¢ç»™å‡ºä¸€ä¸ªç®€å•çš„ç®—æ³•ï¼Œæ£€æµ‹æœ‰å‘å›¾æ˜¯å¦å­˜åœ¨ç¯ã€‚è¿™ä¸€ç®—æ³•ä½¿ç”¨æ•°æ®ç»“æ„Lï¼ŒLä»£è¡¨ä¸€äº›èŠ‚ç‚¹çš„é›†åˆï¼Œé€šè¿‡å¯¹å·²ç»æ£€æµ‹çš„æœ‰å‘è¾¹è¿›è¡Œæ ‡è®°ï¼Œé¿å…é‡å¤æ£€æŸ¥ã€‚ç®—æ³•æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>å¯¹å›¾ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹Nï¼Œå°†Nä½œä¸ºèµ·å§‹ç‚¹æ‰§è¡Œä¸‹é¢äº”ä¸ªæ­¥éª¤ã€‚</li>
<li>å°†Låˆå§‹åŒ–ä¸ºç©ºè¡¨ï¼Œå¹¶æ¸…é™¤æ‰€æœ‰æœ‰å‘è¾¹æ ‡è®°ã€‚</li>
<li>å°†å½“å‰èŠ‚ç‚¹æ·»åŠ åˆ°Lå°¾éƒ¨ï¼Œæ£€æµ‹è¯¥èŠ‚ç‚¹æ˜¯å¦å·²ç»åœ¨Lä¸­å‡ºç°ä¸¤æ¬¡ã€‚å¦‚æœæ˜¯ï¼Œé‚£ä¹ˆè¯¥å›¾åŒ…å«äº†ä¸€ä¸ªç¯ï¼Œç®—æ³•ç»“æŸã€‚</li>
<li>ä»ç»™å®šçš„èŠ‚ç‚¹å¼€å§‹ï¼Œæ£€æµ‹æ˜¯å¦å­˜åœ¨æ²¡æœ‰æ ‡è®°çš„ä»è¯¥èŠ‚ç‚¹å‡ºå‘çš„æœ‰å‘è¾¹ã€‚å¦‚æœå­˜åœ¨çš„è¯ï¼Œè¿›è¡Œç¬¬5æ­¥ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œè·³åˆ°ç¬¬6æ­¥ã€‚</li>
<li>éšæœºé€‰å–ä¸€æ¡æ²¡æœ‰æ ‡è®°çš„ä»è¯¥èŠ‚ç‚¹å‡ºå‘çš„æœ‰å‘è¾¹ï¼Œæ ‡è®°å®ƒï¼Œç„¶åå°†è¯¥è¾¹æŒ‡å‘çš„èŠ‚ç‚¹ä½œä¸ºæ–°çš„å½“å‰èŠ‚ç‚¹ï¼Œè·³åˆ°ç¬¬3æ­¥ã€‚</li>
<li>å¦‚æœè¿™ä¸€èŠ‚ç‚¹æ˜¯èµ·å§‹èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¡¨æ˜è¯¥å›¾ä¸å­˜åœ¨ä»»ä½•ç¯ï¼Œç®—æ³•ç»“æŸã€‚å¦åˆ™æ„å‘³ç€æˆ‘ä»¬èµ°è¿›äº†æ­»èƒ¡åŒï¼Œæ‰€ä»¥éœ€è¦ç§»èµ°è¯¥èŠ‚ç‚¹ï¼Œè¿”å›åˆ°å‰ä¸€èŠ‚ç‚¹ï¼Œå¹¶ä½œä¸ºæ–°çš„å½“å‰èŠ‚ç‚¹ï¼Œè·³è½¬åˆ°ç¬¬3æ­¥ã€‚</li>
</ol>
<p>è¿™ä¸€ç®—æ³•å®é™…ä¸Šæ˜¯ä¾æ¬¡å°†æ¯ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºä¸€æ£µæ ‘çš„æ ¹èŠ‚ç‚¹è¿›è¡Œæ·±åº¦</p>
<p>ä¼˜å…ˆæœç´¢ï¼Œå¦‚æœç¢°åˆ°å·²ç»é‡åˆ°è¿‡çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå°±ç®—æ‰¾åˆ°ä¸€ä¸ªç¯ã€‚å¦‚æœä»ä»»ä½•ç»™å®šçš„èŠ‚ç‚¹å‡ºå‘çš„æœ‰å‘è¾¹éƒ½è¢«ç©·ä¸¾äº†ï¼Œåˆ™å›æº¯åˆ°å‰é¢çš„èŠ‚ç‚¹ã€‚å¦‚æœå›æº¯åˆ°æ ¹ï¼Œå¹¶ä¸”ä¸èƒ½å†æ·±å…¥ä¸‹å»ï¼Œé‚£ä¹ˆä»å½“å‰èŠ‚ç‚¹å‡ºå‘çš„å­å›¾ä¸­å°±ä¸å­˜åœ¨ç¯ã€‚è‹¥æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯å¦‚æ­¤ï¼Œåˆ™æ•´ä¸ªå›¾ä¸å­˜åœ¨ç¯ï¼Œå³ç³»ç»Ÿä¸å­˜åœ¨æ­»é”ã€‚</p>
<p>å¯¹ä¸Šå›¾åº”ç”¨è¿™ä¸€ç®—æ³•ã€‚ä»RèŠ‚ç‚¹å¼€å§‹ï¼Œä¾æ¬¡æ˜¯Aã€Bã€Cã€Sã€Dã€Tã€Eã€Fï¼Œå¦‚æœé‡åˆ°ä¸€ä¸ªç¯ï¼Œåˆ™ç®—æ³•åœæ­¢ã€‚</p>
<p>æˆ‘ä»¬å…ˆä»RèŠ‚ç‚¹å¼€å§‹ï¼Œå°†Låˆå§‹åŒ–ä¸ºç©ºè¡¨ï¼Œå°†Ræ·»åŠ åˆ°Lä¸­ï¼Œæ¥ç€ç§»åŠ¨åˆ°Aï¼ŒAæ·»åŠ åˆ°Lä¸­ï¼ŒL=[R,A]ã€‚ä»Aåˆ°è¾¾Sï¼ŒL=[R,A,S]ã€‚Sæ²¡æœ‰å‡ºå‘çš„è¾¹ï¼Œæ‰€ä»¥å›æº¯åˆ°Aï¼ŒåŒç†å†å›æº¯åˆ°Rï¼Œä»è€Œå®Œæˆäº†å¯¹Rä¸ºèµ·ç‚¹çš„æ£€æµ‹ã€‚</p>
<p>ç°åœ¨ä»¥Aä¸ºèµ·ç‚¹è¿›è¡Œæ£€æµ‹ï¼Œç½®Lä¸ºç©ºè¡¨ï¼Œç”±ä¸Šä¸€æ®µåˆ†ææˆ‘ä»¬å¾ˆå¿«å°±èƒ½å®Œæˆå¯¹Açš„æ£€æµ‹ã€‚</p>
<p>ç°åœ¨ä»BèŠ‚ç‚¹å¼€å§‹ï¼Œä¸€è·¯é¡ºç€æœ‰å‘è¾¹åˆ°è¾¾Dï¼Œæ­¤æ—¶L=[B,T,E,V,G,U,D]ã€‚æ­¤æ—¶éšæœºé€‰æ‹©ä¸€æ¡è¾¹ï¼Œå¦‚æœé€‰Sï¼Œåˆ™æ˜¯æ­»è·¯ï¼Œå°†å›æº¯åˆ°Dã€‚æ¥ç€é€‰Tï¼Œæ­¤æ—¶å‡ºç°äº†L=[B,T,E,V,G,U,D,T]ï¼Œå‘ç°äº†ç¯ï¼ˆæ£€æµ‹åˆ°ä¸¤ä¸ªTï¼‰ï¼Œç®—æ³•ç»“æŸã€‚</p>
<h5>3.2.2 æ¯ç§ç±»å‹å¤šä¸ªèµ„æºçš„æ­»é”æ£€æµ‹</h5>
<p>æ¯ç§ç±»å‹å¤šç§èµ„æºçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é‡‡ç”¨åŸºäºçŸ©é˜µçš„ç®—æ³•æ¥æ£€æµ‹æ­»é”ã€‚ç°åœ¨æ£€æµ‹$P_1$åˆ°$P_n$è¿™nä¸ªè¿›ç¨‹ä¸­æ˜¯å¦å­˜åœ¨æ­»é”ï¼Œå‡è®¾èµ„æºç±»å‹æœ‰mç§ï¼Œ$E_1$ä»£è¡¨èµ„æºç±»å‹1ï¼Œ$E_2$ä»£è¡¨èµ„æºç±»å‹2ï¼Œ$E_i$ä»£è¡¨èµ„æºç±»å‹$i(1\le i\le m)$ã€‚$E$æ˜¯ç°æœ‰èµ„æºå‘é‡ï¼Œä»£è¡¨æ¯ç§å·²å­˜åœ¨çš„èµ„æºæ€»æ•°ï¼Œæ¯”å¦‚èµ„æºç±»å‹1ä»£è¡¨æ‰“å°æœºï¼Œé‚£ä¹ˆ$E_1=2$è¡¨ç¤ºç³»ç»Ÿæœ‰ä¸¤å°æ‰“å°æœºã€‚åœ¨ä»»æ„æ—¶åˆ»ï¼ŒæŸäº›èµ„æºè¢«åˆ†é…æ‰€ä»¥ä¸å¯ç”¨ã€‚è®¾Aæ˜¯å¯ç”¨èµ„æºå‘é‡ï¼Œé‚£ä¹ˆ$A_i$è¡¨ç¤ºå½“å‰å¯ä¾›ä½¿ç”¨çš„èµ„æºæ•°ã€‚å¦‚æœä»…æœ‰çš„ä¸¤å°æ‰“å°æœºè¢«åˆ†é…å‡ºå»ï¼Œé‚£ä¹ˆ$A_i=0$ã€‚</p>
<p>å¦å¤–éœ€è¦ä¸¤ä¸ªçŸ©é˜µï¼Œ$C$ä»£è¡¨å½“å‰åˆ†é…çŸ©é˜µï¼Œ$R$ä»£è¡¨è¯·æ±‚çŸ©é˜µã€‚Cçš„ç¬¬$i$è¡Œä»£è¡¨$P_i$å½“å‰æ‰€æŒæœ‰çš„æ¯ä¸€ç§ç±»å‹èµ„æºçš„èµ„æºæ•°ã€‚æ‰€ä»¥ï¼Œ$C_{ij}$ä»£è¡¨$P_i$æ‰€æŒæœ‰çš„èµ„æº$j$çš„æ•°é‡ã€‚åŒç†ï¼Œ$R_{ij}$ä»£è¡¨$P_i$æ‰€éœ€è¦çš„èµ„æº$j$çš„æ•°é‡ã€‚å››ç§æ•°æ®ç»“æ„åˆ†åˆ«è¡¨ç¤ºå¦‚ä¸‹ã€‚
$$
ç°æœ‰èµ„æº\
(E_1,E_2,E_3,...,E_m)
$$</p>
<p>$$
å¯ç”¨èµ„æº\
(A_1,A_2,A_3,...,A_m)
$$</p>
<p>$$
å½“å‰åˆ†é…çŸ©é˜µ\
\left[
\begin{matrix}
C_{11}&amp;C_{12}&amp;C_{13}&amp; ... &amp;C_{1m}\
C_{21}&amp;C_{22}&amp;C_{23}&amp; ... &amp;C_{2m}\
\vdots &amp; \vdots &amp; \vdots &amp;  &amp; \vdots    \
C_{n1}&amp;C_{n2}&amp;C_{n3}&amp; ... &amp;C_{nm}\
\end{matrix}
\right]
$$</p>
<p>$$
è¯·æ±‚çŸ©é˜µ\
\left[
\begin{matrix}
R_{11}&amp;R_{12}&amp;R_{13}&amp; ... &amp;R_{1m}\
R_{21}&amp;R_{22}&amp;R_{23}&amp; ... &amp;R_{2m}\
\vdots &amp; \vdots &amp; \vdots &amp;  &amp; \vdots    \
R_{n1}&amp;R_{n2}&amp;R_{n3}&amp; ... &amp;R_{nm}\
\end{matrix}
\right]
$$</p>
<p>è¿™å››ç§æ•°æ®ç»“æ„ä¹‹é—´æ»¡è¶³ä¸€ä¸ªæ’ç­‰å¼ï¼Œå³
$$
\sum_{i=1}^nC_{ij} + A_j = E_j
$$
ä¸Šå¼è¡¨ç¤ºï¼Œå°†æ‰€æœ‰å·²åˆ†é…çš„èµ„æº$j$æ•°é‡ç´¯åŠ èµ·æ¥ï¼Œå¹¶ä¸”åŠ ä¸Šèµ„æºjçš„å¯ç”¨èµ„æºæ•°ï¼Œç­‰äºè¯¥ç±»èµ„æºçš„æ€»æ•°ã€‚</p>
<p>å®šä¹‰å‘é‡Aå’Œå‘é‡Bä¹‹é—´çš„å…³ç³»ä¸º$A\le B$å½“ä¸”ä»…å½“$A_i \le B_i(0 \le i \le m)$ã€‚</p>
<p>è§„å®šï¼šæ¯ä¸ªè¿›ç¨‹åˆå§‹æœªè¢«æ ‡è®°ï¼Œå½“ç®—æ³•å¼€å§‹åï¼Œä¼šå¯¹è¿›ç¨‹åšæ ‡è®°ï¼Œè¢«æ ‡è®°åå³è¡¨æ˜è¯¥è¿›ç¨‹èƒ½å¤Ÿè¢«æ‰§è¡Œï¼Œä¸ä¼šè¿›å…¥æ­»é”ã€‚å› æ­¤ï¼Œå½“ç®—æ³•ç»“æŸæ—¶ï¼Œæœªè¢«æ ‡è®°çš„è¿›ç¨‹éƒ½æ˜¯æ­»é”è¿›ç¨‹ã€‚</p>
<p>æ­»é”æ£€æµ‹ç®—æ³•å¦‚ä¸‹ï¼š</p>
<ol>
<li>éœ€è¦ä¸€ä¸ªæ²¡æœ‰æ ‡è®°çš„è¿›ç¨‹$P_i$ï¼Œå¯¹äºå®ƒè€Œè¨€RçŸ©é˜µçš„ç¬¬$i$è¡Œå‘é‡å°äºæˆ–ç­‰äºAï¼Œå³$R_{i}\le A$.</li>
<li>å¦‚æœæ‰¾åˆ°è¿™æ ·ä¸€ä¸ªè¿›ç¨‹ï¼Œé‚£ä¹ˆå°†CçŸ©é˜µçš„ç¬¬$i$è¡Œå‘é‡åŠ åˆ°Aä¸­ï¼ˆå› ä¸ºèµ„æºè¶³å¤Ÿè¯¥è¿›ç¨‹è¿è¡Œï¼‰ï¼Œæ ‡è®°è¯¥è¿›ç¨‹ï¼Œå¹¶è½¬åˆ°ç¬¬1æ­¥ã€‚</li>
<li>å¦‚æœæ²¡æœ‰è¿™æ ·çš„è¿›ç¨‹ï¼Œç®—æ³•ç»“æŸã€‚</li>
</ol>
<h5>3.2.3 ä½•æ—¶å»æ£€æµ‹æ­»é”</h5>
<p>çŸ¥é“äº†å¦‚ä½•å»æ£€æµ‹æ­»é”ï¼Œé‚£ä¹ˆè¯¥åœ¨ä½•æ—¶å»æ£€æµ‹ä»–ä»¬å‘¢ã€‚ä¸€ç§æ–¹æ³•æ˜¯æ¯å½“æœ‰èµ„æºè¯·æ±‚æ—¶å°±å»æ£€æµ‹ï¼Œè¿™ç§æ–¹æ³•ä¼šå ç”¨æ˜‚è´µçš„CPUæ—¶é—´ï¼›å¦ä¸€ç§æ–¹æ³•æ˜¯å®šæ—¶æ£€æµ‹ï¼Œå¯ä»¥æ¯ä¸ª$k$åˆ†é’Ÿæ£€æµ‹ä¸€æ¬¡ï¼Œåˆæˆ–è€…åœ¨CPUä½¿ç”¨ç‡é™åˆ°æŸä¸€é˜ˆå€¼æ—¶å»æ£€æµ‹ï¼Œä¾æ®æ˜¯å¦‚æœæ­»é”è¿›ç¨‹æ•°è¾¾åˆ°ä¸€å®šæ•°é‡ï¼Œå°±æ²¡æœ‰å¤šå°‘è¿›ç¨‹å¯è¿è¡Œï¼Œé‚£ä¹ˆCPUä¼šç©ºé—²ä¸‹æ¥ã€‚</p>
<h5>3.2.4 ä»æ­»é”ä¸­æ¢å¤</h5>
<p>ä»æ­»é”ä¸­æ¢å¤æœ‰å¦‚ä¸‹æ–¹æ³•ï¼š</p>
<ul>
<li>åˆ©ç”¨æŠ¢å æ¢å¤</li>
<li>åˆ©ç”¨å›æ»šæ¢å¤</li>
<li>æ€æ­»è¿›ç¨‹æ¢å¤</li>
</ul>
<p>æŠ¢å æ¢å¤å°†èµ„æºä»æŒæœ‰è¿›ç¨‹Aæ‹¿èµ°ï¼Œåˆ†é…ç»™å¦ä¸€ä¸ªè¿›ç¨‹Bï¼Œå¾…è¿›ç¨‹Bä½¿ç”¨å®Œæ¯•åå†åˆ†é…ç»™è¿›ç¨‹Aã€‚</p>
<p>å›æ»šæ¢å¤éœ€è¦å¯¹è¿›ç¨‹è®¾ç½®<strong>æ£€æŸ¥ç‚¹æ£€æŸ¥</strong>ã€‚è¿›ç¨‹æ£€æŸ¥ç‚¹æ£€æŸ¥å°±æ˜¯å°†è¿›ç¨‹å†™å…¥ä¸€ä¸ªæ–‡ä»¶ä»¥å¤‡ä»¥åé‡å¯ã€‚è¯¥æ£€æŸ¥ç‚¹ä¸­ä¸ä»…åŒ…æ‹¬å­˜å‚¨æ˜ åƒï¼Œè¿˜åŒ…æ‹¬äº†èµ„æºçŠ¶æ€ï¼Œå³å“ªäº›èµ„æºåˆ†é…ç»™äº†è¯¥è¿›ç¨‹ã€‚ä¸€æ—¦æ£€æµ‹åˆ°æ­»é”ï¼Œå°±å¾ˆå®¹æ˜“å‘ç°éœ€è¦å“ªäº›èµ„æºã€‚ä¸ºäº†è¿›è¡Œæ¢å¤ï¼Œè¦ä»ä¸€ä¸ªè¾ƒæ—©çš„æ£€æŸ¥ç‚¹ä¸Šå¼€å§‹ï¼Œè¿™æ ·æ‹¥æœ‰æ‰€éœ€è¦èµ„æºçš„è¿›ç¨‹ä¼šå›æ»šåˆ°ä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œå†æ­¤æ—¶é—´ç‚¹ä¹‹å‰è¯¥è¿›ç¨‹è·å–äº†ä¸€äº›å…¶ä»–çš„èµ„æºï¼Œè€Œåœ¨æ­¤æ—¶é—´ç‚¹ä¹‹åè¯¥è¿›ç¨‹æ‰€åšçš„æ‰€æœ‰å·¥ä½œéƒ½ä¸¢å¤±ã€‚å®é™…ä¸Šæ˜¯å°†è¯¥è¿›ç¨‹å¤ä½åˆ°ä¸€ä¸ªæ›´æ—©çš„çŠ¶æ€ï¼Œé‚£æ—¶å®ƒè¿˜æ²¡æœ‰å–å¾—å¯¼è‡´æ­»é”çš„èµ„æºï¼Œæ¥ç€å°†è¯¥èµ„æºåˆ†é…ç»™ä¸€ä¸ªæ­»é”è¿›ç¨‹ã€‚</p>
<p>æ€æ­»ä¸€ä¸ªæˆ–è‹¥å¹²ä¸ªè¿›ç¨‹æ˜¯æœ€ç›´æ¥ä¹Ÿæ˜¯æœ€ç®€å•çš„è§£å†³æ­»é”çš„æ–¹æ³•ã€‚ä¸€ç§æ–¹æ³•æ˜¯æ€æ‰ç¯ä¸­çš„ä¸€ä¸ªè¿›ç¨‹ï¼Œä½¿å¾—å…¶ä»–è¿›ç¨‹å¯ä»¥ç»§ç»­ï¼Œå¦‚æ— æ³•ç»§ç»­ï¼Œåˆ™å†æ€æ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œç›´åˆ°æ‰“ç ´æ­»é”å¾ªç¯ã€‚å¦ä¸€ç§æ–¹æ³•æ˜¯é€‰ä¸€ä¸ªç¯å¤–çš„è¿›ç¨‹ä½œä¸ºç‰ºç‰²å“ï¼Œé‡Šæ”¾è¯¥è¿›ç¨‹çš„èµ„æºã€‚è¿™ç§æ–¹æ³•éœ€è¦å°å¿ƒé€‰æ‹©ä¸€ä¸ªç¯å¤–è¿›ç¨‹ï¼Œå®ƒåº”è¯¥æ­£å¥½æŒæœ‰ç¯ä¸­æŸäº›è¿›ç¨‹éœ€è¦çš„èµ„æºã€‚æ€æ­»è¿›ç¨‹è¿™ç±»æ–¹æ³•ï¼Œæœ€å¥½æ˜¯é€‰æ‹©å¯ä»¥ä»å¤´å¼€å§‹é‡æ–°è¿è¡Œè€Œä¸ä¼šå¸¦æ¥å‰¯ä½œç”¨çš„è¿›ç¨‹ã€‚ä¾‹å¦‚ç¼–è¯‘ç¨‹åºå¯ä»¥é‡æ–°è¿è¡Œäº§ç”Ÿæ–°çš„ç›®æ ‡æ–‡ä»¶ã€‚</p>
<h4>3.3 æ­»é”é¿å…</h4>
]]></content:encoded>
    </item>
    <item>
      <title>æµ…è°ˆå•ä¾‹æ¨¡å¼</title>
      <link>https://kkwalking.github.com/person-database/person-database/pattern-design/about-singleton-pattern.html</link>
      <guid>https://kkwalking.github.com/person-database/person-database/pattern-design/about-singleton-pattern.html</guid>
      <source url="https://kkwalking.github.com/person-database/person-database/rss.xml">æµ…è°ˆå•ä¾‹æ¨¡å¼</source>
      <description>æ‹‰ä¸ªStar å¦‚æœæœ¬çŸ¥è¯†åº“çš„å†…å®¹å¸®åŠ©åˆ°ä½ ï¼Œè¿˜è¯·ç‚¹ä¸ªå…è´¹çš„Starï¼Œæ„Ÿè°¢ã€‚ä¼ é€é—¨ï¼šGitHub æµ…è°ˆå•ä¾‹æ¨¡å¼ é¥¿æ±‰æ¨¡å¼ ç¼ºç‚¹ï¼šåœ¨éœ€è¦åˆå§‹åŒ–è®¸å¤šå¯¹è±¡çš„æ—¶å€™ä¼šå¯¼è‡´ç³»ç»Ÿå¯åŠ¨è¾ƒæ…¢ï¼Œæ¯”å¦‚åœ¨æœ‰è®¸å¤šä¸ªå•ä¾‹å¯¹è±¡çš„å®¹å™¨ä¸­ï¼Œå¯åŠ¨è¯¥å®¹å™¨çš„åˆå§‹è¿‡ç¨‹ä¼šæ¯”è¾ƒé•¿ã€‚ æ‡’åŠ è½½æ¨¡å¼ ç¼ºç‚¹ï¼šåŒæ­¥æ–¹æ³•é”ä½äº†å¯¹è±¡ï¼Œé™ä½äº†ç³»ç»Ÿçš„å¤„ç†é€Ÿåº¦ã€‚ é”™è¯¯çš„åŒé‡é”æ£€æŸ¥ è¿™æ ·çš„å†™æ³•æ˜¯æœ‰é—®é¢˜çš„ã€‚åœ¨JVMä¸­ï¼Œ in...</description>
      <pubDate>Fri, 10 Feb 2023 00:00:00 GMT</pubDate>
      <content:encoded><![CDATA[<div class="hint-container tip">
<p class="hint-container-title">æ‹‰ä¸ªStar</p>
<ul>
<li>å¦‚æœ<a href="https://github.com/kkwalking/person-database" target="blank">æœ¬çŸ¥è¯†åº“</a>çš„å†…å®¹å¸®åŠ©åˆ°ä½ ï¼Œè¿˜è¯·ç‚¹ä¸ªå…è´¹çš„Starï¼Œæ„Ÿè°¢ã€‚ä¼ é€é—¨ï¼š<a href="https://github.com/kkwalking/person-database" target="blank">GitHub</a></li>
</ul>
</div>
<h1>æµ…è°ˆå•ä¾‹æ¨¡å¼</h1>
<h4>é¥¿æ±‰æ¨¡å¼</h4>
<div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ç¼ºç‚¹ï¼šåœ¨éœ€è¦åˆå§‹åŒ–è®¸å¤šå¯¹è±¡çš„æ—¶å€™ä¼šå¯¼è‡´ç³»ç»Ÿå¯åŠ¨è¾ƒæ…¢ï¼Œæ¯”å¦‚åœ¨æœ‰è®¸å¤šä¸ªå•ä¾‹å¯¹è±¡çš„å®¹å™¨ä¸­ï¼Œå¯åŠ¨è¯¥å®¹å™¨çš„åˆå§‹è¿‡ç¨‹ä¼šæ¯”è¾ƒé•¿ã€‚</p>
<h4>æ‡’åŠ è½½æ¨¡å¼</h4>
<div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ç¼ºç‚¹ï¼šåŒæ­¥æ–¹æ³•é”ä½äº†å¯¹è±¡ï¼Œé™ä½äº†ç³»ç»Ÿçš„å¤„ç†é€Ÿåº¦ã€‚</p>
<h4>é”™è¯¯çš„åŒé‡é”æ£€æŸ¥</h4>
<div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™æ ·çš„å†™æ³•æ˜¯æœ‰é—®é¢˜çš„ã€‚åœ¨JVMä¸­ï¼Œ instance = new Singleton(); è¯­å¥å¹¶ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œåˆ†ä¸ºåˆ›å»ºå¯¹è±¡å’Œå¼•ç”¨èµ‹å€¼ä¸¤æ­¥ã€‚å…¶ä¸­ï¼Œåˆ›å»ºå¯¹è±¡éœ€è¦ä¸ºå¯¹è±¡åˆ†é…ç©ºé—´ï¼Œå†è¿›è¡Œåˆå§‹åŒ–ã€‚ä»¥ä¸Šä¸‰æ­¥ï¼Œåˆ†é…å†…å­˜æ°¸è¿œæ˜¯ç¬¬ä¸€æ­¥ï¼Œä½†æ˜¯åé¢ä¸¤æ­¥åˆ™å¯èƒ½è¢«é‡æ’åºã€‚</p>
<p>JVMå¹¶ä¸ä¿è¯åˆå§‹åŒ–å…ˆäºå¼•ç”¨èµ‹å€¼çš„é¡ºåºï¼Œå› æ­¤å¾ˆå¯èƒ½æ˜¯å…ˆåˆ›å»ºäº†å¯¹è±¡ï¼Œå³åœ¨Singletonå®ä¾‹åˆ†é…äº†å†…å­˜ç©ºé—´ï¼Œä½†æ˜¯è¿˜æœªè¿›è¡Œåˆå§‹åŒ–ï¼Œç„¶åèµ‹å€¼ç»™äº†<code>instance</code>ï¼Œè¿™æ˜¯å®ä¾‹è™½ç„¶åˆ†é…åˆ°äº†ç©ºé—´ï¼Œä½†æ˜¯å…¶å¹¶æœªå®Œæˆåˆå§‹åŒ–ï¼Œè€Œ<code>instance</code>å¼•ç”¨å´ä¸ä¸ºç©ºï¼Œè¿™æ—¶å¦ä¸€ä¸ªçº¿ç¨‹æŠ¢å æ‰§è¡Œï¼Œæ‰§è¡Œäº†<code>getInstanceï¼ˆï¼‰</code>æ–¹æ³•ï¼Œä¾¿ä¼šå‘ç°<code>instance</code>ä¸ä¸º<code>null</code>ï¼Œä»è€Œç›´æ¥è¿”å›äº†<code>instance</code>ï¼Œå¯¼è‡´ç³»ç»Ÿå‡ºé”™ã€‚</p>
<h4>æ­£ç¡®çš„åŒé‡é”æ£€æŸ¥</h4>
<div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">volatile</span> <span class="token class-name">Singleton</span> instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åˆ©ç”¨volatileçš„å†…å­˜å¯è§æ€§å¯ä»¥ä½¿å¾—<code>instance</code>ä¸ä¼šè¢«çº¿ç¨‹ç¼“å­˜ï¼Œæ‰€æœ‰çš„çº¿ç¨‹è¯»å†™è¯¥å¯¹è±¡éƒ½éœ€è¦å¯¹ä¸»å†…å­˜è¿›è¡Œæ“ä½œã€‚</p>
<p>volatileè¿˜å¯ä»¥é˜²æ­¢æŒ‡ä»¤é‡æ’åºï¼Œä»è€Œä½¿å¾—ä¸Šè¿°çš„åŒé‡é”æ£€æŸ¥ä»£ç æ­£ç¡®æ‰§è¡Œã€‚è¿™é‡Œçš„é˜²æ­¢æŒ‡ä»¤é‡æ’åºæ˜¯æŒ‡ï¼Œvolatileä¿®é¥°çš„<code>instance</code>å¯¹è±¡ï¼Œåœ¨æ‰§è¡Œä»£ç  <code>instance = new Singleton()</code>æ—¶ä¸ä¼šå†è¢«JVMè¿›è¡ŒæŒ‡ä»¤é‡æ’åºï¼Œä¼šæŒ‰ç…§ <code>å†…å­˜åˆ†é… -&gt; åˆå§‹åŒ– -&gt; å¼•ç”¨èµ‹å€¼</code> çš„é¡ºåºæ‰§è¡Œ</p>
<h4>ä½¿ç”¨é™æ€å†…éƒ¨ç±»</h4>
<div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SingletonFactory</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">SingletonFactory</span><span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//åºåˆ—åŒ–æ–¹æ³•  å¯å¿½ç•¥</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">readResolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™æ ·çš„å†™æ³•åˆ©ç”¨äº†JVMçš„ç±»åŠ è½½æœºåˆ¶ï¼ŒJVMåœ¨åŠ è½½ç±»çš„è¿‡ç¨‹ä¸­ç¡®ä¿äº†çº¿ç¨‹äº’æ–¥ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¤–éƒ¨ç±»è¢«åŠ è½½æ—¶ï¼Œä¸ä¼šç«‹å³åŠ è½½å†…éƒ¨ç±»ï¼Œä»è€Œ<code>instance</code>ä¸ä¼šç«‹å³è¢«å®ä¾‹åŒ–ã€‚å½“<code>getInstance()</code> ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨æ—¶ï¼Œå†…éƒ¨ç±»ç¬¬ä¸€æ¬¡è¢«å¼•ç”¨ï¼Œä»è€ŒåŠ è½½äº†å†…éƒ¨ç±»ï¼Œå¹¶å®Œæˆäº†<code>instance</code>çš„å®ä¾‹åŒ–ï¼Œè€ŒJVMçš„ç±»åŠ è½½æœºåˆ¶ç¡®ä¿äº†å®ä¾‹åŒ–instanceçš„è¿‡ç¨‹ä¸­çš„çº¿ç¨‹å®‰å…¨æ€§ã€‚</p>
<p>ç¼ºç‚¹ï¼šä½¿ç”¨é™æ€å†…éƒ¨ç±»çš„æ–¹å¼ï¼Œåˆ™å­˜åœ¨ä¼ å‚çš„é—®é¢˜ï¼Œå¤–éƒ¨æ— æ³•ä¼ é€’å‚æ•°ç»™å†…éƒ¨ç±»</p>
<h4>ä½¿ç”¨æšä¸¾</h4>
<div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
    <span class="token constant">INSTANCE</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token comment">//å…¶ä»–æ–¹æ³•ä»£ç </span>
<span class="token punctuation">}</span>
</code></pre></div><p>æšä¸¾ç±»å‹çš„å®ä¾‹åˆ›å»ºå‡ºæ¥å¤©ç„¶å°±æ˜¯å•ä¾‹çš„ï¼Œå¹¶ä¸”æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
]]></content:encoded>
    </item>
    <item>
      <title>Rediså­¦ä¹ ç¬”è®°ä¹‹é“¾è¡¨</title>
      <link>https://kkwalking.github.com/person-database/person-database/middleware/redis/redis-learn-list.html</link>
      <guid>https://kkwalking.github.com/person-database/person-database/middleware/redis/redis-learn-list.html</guid>
      <source url="https://kkwalking.github.com/person-database/person-database/rss.xml">Rediså­¦ä¹ ç¬”è®°ä¹‹é“¾è¡¨</source>
      <description>æ‹‰ä¸ªStar å¦‚æœæœ¬çŸ¥è¯†åº“çš„å†…å®¹å¸®åŠ©åˆ°ä½ ï¼Œè¿˜è¯·ç‚¹ä¸ªå…è´¹çš„Starï¼Œæ„Ÿè°¢ã€‚ä¼ é€é—¨ï¼šGitHub æœ¬ç³»åˆ—æ˜¯ä¸ªäººçš„Rediså­¦ä¹ ç¬”è®°ï¼Œå‚è€ƒçš„ä¹¦ç±æœ‰ã€ŠRedisè®¾è®¡ä¸å®ç°ã€‹ã€ã€ŠRedisæ·±åº¦å†é™©--æ ¸å¿ƒåŸç†ä¸åº”ç”¨å®è·µã€‹ï¼ŒRedisæºç ç‰ˆæœ¬æ˜¯é»„å¥å®è€å¸ˆæ³¨é‡Šçš„Redis-3.0-annotatedç‰ˆæœ¬ ä¸€ã€Redisä¸­çš„é“¾è¡¨åº”ç”¨åœºæ™¯ é“¾è¡¨æ˜¯ä¸€ç§åº”ç”¨éå¸¸å¹¿æ³›çš„æ•°æ®ç»“...</description>
      <category>ä¸­é—´ä»¶</category>
      <pubDate>Sat, 14 Oct 2023 00:00:00 GMT</pubDate>
      <content:encoded><![CDATA[<div class="hint-container tip">
<p class="hint-container-title">æ‹‰ä¸ªStar</p>
<ul>
<li>å¦‚æœ<a href="https://github.com/kkwalking/person-database" target="blank">æœ¬çŸ¥è¯†åº“</a>çš„å†…å®¹å¸®åŠ©åˆ°ä½ ï¼Œè¿˜è¯·ç‚¹ä¸ªå…è´¹çš„Starï¼Œæ„Ÿè°¢ã€‚ä¼ é€é—¨ï¼š<a href="https://github.com/kkwalking/person-database" target="blank">GitHub</a></li>
</ul>
</div>
<blockquote>
<p>æœ¬ç³»åˆ—æ˜¯ä¸ªäººçš„Rediså­¦ä¹ ç¬”è®°ï¼Œå‚è€ƒçš„ä¹¦ç±æœ‰ã€ŠRedisè®¾è®¡ä¸å®ç°ã€‹ã€ã€ŠRedisæ·±åº¦å†é™©--æ ¸å¿ƒåŸç†ä¸åº”ç”¨å®è·µã€‹ï¼ŒRedisæºç ç‰ˆæœ¬æ˜¯é»„å¥å®è€å¸ˆæ³¨é‡Šçš„<a href="https://github.com/huangz1990/redis-3.0-annotated" target="_blank" rel="noopener noreferrer">Redis-3.0-annotated</a>ç‰ˆæœ¬</p>
</blockquote>
<h2>ä¸€ã€Redisä¸­çš„é“¾è¡¨åº”ç”¨åœºæ™¯</h2>
<p>é“¾è¡¨æ˜¯ä¸€ç§åº”ç”¨éå¸¸å¹¿æ³›çš„æ•°æ®ç»“æ„ï¼Œåœ¨å¾ˆå¤šè¯­è¨€ä¸­éƒ½æœ‰ç›¸åº”çš„å®ç°å’Œä½¿ç”¨ï¼Œæ¯”å¦‚Javaä¸­çš„LinkedListã€‚Cè¯­è¨€ä¸­å¹¶æ²¡æœ‰å†…ç½®çš„é“¾è¡¨å®ç°ï¼Œå› æ­¤Rediså®ç°äº†è‡ªå·±çš„é“¾è¡¨ç»“æ„ï¼Œå¹¶å°†å®ƒåº”ç”¨åœ¨è®¸å¤šåœºæ™¯ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨Redisä¸­ä½¿ç”¨çš„listï¼Œå…¶åº•å±‚å°±æ˜¯ç”¨é“¾è¡¨å®ç°çš„ã€‚</p>
<p>Redisä¸­çš„listæ˜¯ç”±å­—ç¬¦ä¸²å€¼ç»„æˆçš„åŒå‘é“¾è¡¨ï¼Œå…¶åŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<div class="language-text" data-ext="text" data-title="text"><pre class="language-text"><code>127.0.0.1:6379&gt; lpush fruits apple banana orange
(integer) 3
127.0.0.1:6379&gt;
</code></pre></div><p>Redisä¸­çš„listæ”¯æŒä»ä¸¤è¾¹å¯¹é“¾è¡¨è¿›è¡Œæ“ä½œï¼Œå…¶ä¸»è¦ä½¿ç”¨çš„å‘½ä»¤æœ‰LPUSHï¼ŒRPUSHï¼ŒLPOPï¼ŒRPOPã€‚</p>
<p>åˆ©ç”¨è¿™äº›å‘½ä»¤ï¼Œå¯ä»¥æŠŠlistä½œä¸ºé˜Ÿåˆ—æˆ–è€…æ ˆæ¥ä½¿ç”¨ã€‚</p>
<p>æ¯”å¦‚ç»„åˆä½¿ç”¨LPUSHå’ŒRPOPï¼Œå³å·¦è¿›å³å‡ºï¼Œé‚£ä¹ˆå¯ä»¥æ¨¡æ‹Ÿæˆ<strong>é˜Ÿåˆ—</strong>ã€‚å½“ç„¶ä¹Ÿå¯ä»¥åè¿‡æ¥ï¼ŒRPUSHå’ŒLPOPï¼Œå³å³è¿›å·¦å‡ºã€‚æ¯”å¦‚åƒä¸‹é¢è¿™æ ·ä½¿ç”¨ï¼š</p>
<div class="language-text" data-ext="text" data-title="text"><pre class="language-text"><code>127.0.0.1:6379&gt; lpush fruits apple banana orange
(integer) 3
127.0.0.1:6379&gt; rpop fruits
"apple"
</code></pre></div><h2>äºŒã€Redisçš„é“¾è¡¨å®ç°</h2>
<p>Redisä¸­çš„é“¾è¡¨å®ç°ä¸å¸¸è§çš„é“¾è¡¨å·®ä¸å¤šï¼ŒåŸºæœ¬ç»“æ„æœ‰listNodeå’Œlistã€‚listNodeæ˜¯é“¾è¡¨èŠ‚ç‚¹ç»“æ„ï¼Œlistæ˜¯é“¾è¡¨ç»“æ„ã€‚listNodeçš„åŸºæœ¬ç»“æ„å¦‚ä¸‹ï¼š</p>
<div class="language-c" data-ext="c" data-title="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">listNode</span> <span class="token punctuation">{</span>

    <span class="token comment">// å‰ç½®èŠ‚ç‚¹</span>
    <span class="token keyword">struct</span> <span class="token class-name">listNode</span> <span class="token operator">*</span>prev<span class="token punctuation">;</span>
    <span class="token comment">// åç½®èŠ‚ç‚¹</span>
    <span class="token keyword">struct</span> <span class="token class-name">listNode</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>
    <span class="token comment">// èŠ‚ç‚¹çš„å€¼</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>value<span class="token punctuation">;</span>

<span class="token punctuation">}</span> listNode<span class="token punctuation">;</span>
</code></pre></div><p>nextæŒ‡é’ˆä½œä¸ºå‰å‘æŒ‡é’ˆï¼Œå¯ä»¥æ²¿ç€è¡¨å¤´åˆ°è¡¨å°¾çš„æ–¹å‘è¿›è¡Œéå†ï¼›prevæŒ‡é’ˆä½œä¸ºåå‘æŒ‡é’ˆï¼Œå¯ä»¥æ²¿ç€è¡¨å°¾åˆ°è¡¨å¤´çš„æ–¹å‘è¿›è¡Œéå†ï¼›valueæ˜¯ä¸€ä¸ªå€¼æŒ‡é’ˆã€‚</p>
<p>ä½¿ç”¨listNodeç»„æˆçš„åŒå‘é“¾è¡¨ç»“æ„å¦‚ä¸‹æ‰€ç¤º:</p>
<figure><img src="http://zzk31.320.io/img/20230521171907.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>listçš„ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="language-C" data-ext="C" data-title="C"><pre class="language-C"><code>typedef struct list {

    // å¤´èŠ‚ç‚¹
    listNode *head;
    // å°¾èŠ‚ç‚¹
    listNode *tail;
    // é“¾è¡¨é•¿åº¦ï¼Œå³é“¾è¡¨æ‰€åŒ…å«çš„èŠ‚ç‚¹æ•°
    unsigned long len;
    // èŠ‚ç‚¹å€¼å¤åˆ¶å‡½æ•°
    void *(*dup)(void *ptr);
    // èŠ‚ç‚¹å€¼é‡Šæ”¾å‡½æ•°
    void (*free)(void *ptr);
    // èŠ‚ç‚¹å€¼å¯¹æ¯”å‡½æ•°
    int (*match)(void *ptr, void *key);

} list;
</code></pre></div><p>é€šè¿‡list ç»“æ„å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å–åˆ°é“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€å°¾èŠ‚ç‚¹ä»¥åŠé“¾è¡¨é•¿åº¦ã€‚dup ã€ free å’Œ match å±æ€§æ˜¯ç”¨äºå®ç°å¤šæ€é“¾è¡¨æ‰€éœ€çš„ç±»å‹ç‰¹å®šå‡½æ•°ï¼Œå…·ä½“åœ°ï¼Œdup å‡½æ•°ç”¨äºå¤åˆ¶é“¾è¡¨èŠ‚ç‚¹æ‰€ä¿å­˜çš„å€¼ï¼›free å‡½æ•°ç”¨äºé‡Šæ”¾é“¾è¡¨èŠ‚ç‚¹æ‰€ä¿å­˜çš„å€¼ï¼›match å‡½æ•°åˆ™ç”¨äºå¯¹æ¯”é“¾è¡¨èŠ‚ç‚¹æ‰€ä¿å­˜çš„å€¼å’Œå¦ä¸€ä¸ªè¾“å…¥å€¼æ˜¯å¦ç›¸ç­‰ã€‚ä½¿ç”¨listä¹‹åçš„é“¾è¡¨ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure><img src="http://zzk31.320.io/img/20230521172758.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>Redis çš„é“¾è¡¨å®ç°çš„ç‰¹æ€§å¯ä»¥æ€»ç»“å¦‚ä¸‹ï¼š</p>
<ul>
<li>åŒç«¯ï¼š listNodeæœ‰ prev å’Œ next æŒ‡é’ˆï¼Œ å¯ä»¥ä»¥$O(1)$çš„æ—¶é—´å¤æ‚åº¦è·å–æŸä¸ªèŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹å’Œåç½®èŠ‚ç‚¹</li>
<li>æ— ç¯ï¼š è¡¨å¤´èŠ‚ç‚¹çš„ prev æŒ‡é’ˆå’Œè¡¨å°¾èŠ‚ç‚¹çš„ next æŒ‡é’ˆéƒ½ä¸º NULL ï¼Œ å¯¹é“¾è¡¨çš„è®¿é—®ä»¥ NULL ä¸ºç»ˆç‚¹</li>
<li>å¸¦è¡¨å¤´æŒ‡é’ˆå’Œè¡¨å°¾æŒ‡é’ˆï¼š é€šè¿‡ listçš„ head æŒ‡é’ˆå’Œ tail æŒ‡é’ˆå¯ä»¥å¾ˆå®¹æ˜“è·å–è¡¨å¤´ç»“ç‚¹å’Œè¡¨å°¾èŠ‚ç‚¹</li>
<li>$O(1)$æ—¶é—´å¤æ‚åº¦è·å–é“¾è¡¨é•¿åº¦ï¼šlist çš„len å±æ€§æ¥è®°å½•äº†é“¾è¡¨èŠ‚ç‚¹</li>
<li>å¤šæ€ï¼š listNodeä½¿ç”¨ void* æŒ‡é’ˆæ¥ä¿å­˜èŠ‚ç‚¹å€¼ï¼Œ å¹¶ä¸”å¯ä»¥é€šè¿‡ list çš„ dup ã€free ã€match ä¸‰ä¸ªå±æ€§ä¸ºèŠ‚ç‚¹å€¼è®¾ç½®ç±»å‹ç‰¹å®šå‡½æ•°ï¼Œ æ‰€ä»¥é“¾è¡¨å¯ä»¥ç”¨äºä¿å­˜å„ç§ä¸åŒç±»å‹çš„å€¼å¹¶ä¸”åº”ç”¨ä¸åŒçš„å¤åˆ¶å‡½æ•°ã€å†…å­˜é‡Šæ”¾å‡½æ•°å’ŒåŒ¹é…å‡½æ•°ã€‚</li>
</ul>
<h2>ä¸‰ã€listä¸­ä¸€äº›å‡½æ•°çš„æºç å®ç°</h2>
<ol>
<li>å°†å…ƒç´ æ’å…¥åˆ°listè¡¨å¤´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå‘è¡¨å¤´æ’å…¥val0ä¹‹ålistçš„å˜åŒ–ï¼Œçº¢è‰²çš„ç›¸å…³æŒ‡é’ˆæ˜¯å‘ç”Ÿå˜åŒ–çš„æŒ‡é’ˆã€‚</li>
</ol>
<figure><img src="http://zzk31.320.io/img/20230521230420.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<div class="language-C" data-ext="C" data-title="C"><pre class="language-C"><code>/*
 * ä½¿ç”¨ç»™å®šçš„valueå€¼æ„é€ æ–°çš„èŠ‚ç‚¹å¹¶æ·»åŠ åˆ°é“¾è¡¨çš„è¡¨å¤´
 * å¦‚æœä¸ºæ–°èŠ‚ç‚¹åˆ†é…å†…å­˜å‡ºé”™ï¼Œé‚£ä¹ˆä¸æ‰§è¡Œä»»ä½•åŠ¨ä½œï¼Œä»…è¿”å› NULL
 * å¦‚æœæ‰§è¡ŒæˆåŠŸï¼Œè¿”å›ä¼ å…¥çš„é“¾è¡¨æŒ‡é’ˆ
 * T = O(1)
 */
list *listAddNodeHead(list *list, void *value)
{
    listNode *node;

    // ä¸ºèŠ‚ç‚¹åˆ†é…å†…å­˜
    if ((node = zmalloc(sizeof(*node))) == NULL)
        return NULL;

    // ä¿å­˜å€¼æŒ‡é’ˆ
    node-&gt;value = value;

    // æ·»åŠ èŠ‚ç‚¹åˆ°ç©ºé“¾è¡¨
    // å½“é“¾è¡¨ä¸ºç©ºæ—¶ï¼Œæ–°æ’å…¥çš„èŠ‚ç‚¹æ—¢æ˜¯å¤´ç»“ç‚¹ä¹Ÿæ˜¯å°¾ç»“ç‚¹
    if (list-&gt;len == 0) {
        list-&gt;head = list-&gt;tail = node;
        // æ³¨æ„å¤´ç»“ç‚¹çš„å‰é©±æŒ‡é’ˆåº”è¯¥ä¸ºç©ºï¼Œå°¾ç»“ç‚¹çš„åç»§æŒ‡é’ˆåº”è¯¥ä¸ºç©º
        node-&gt;prev = node-&gt;next = NULL;
    // æ·»åŠ èŠ‚ç‚¹åˆ°éç©ºé“¾è¡¨
    // å½“é“¾è¡¨éç©ºæ—¶,é‡‡ç”¨å¤´æ’æ³•å°†æ–°æ’å…¥èŠ‚ç‚¹é“¾æ¥åˆ°é“¾è¡¨å¤´éƒ¨,å¹¶æ›´æ–°listçš„headæŒ‡é’ˆ
    } else {
        node-&gt;prev = NULL; //æ³¨æ„å¤´ç»“ç‚¹çš„å‰é©±æŒ‡é’ˆåº”è¯¥ä¸ºç©º
        node-&gt;next = list-&gt;head;
        list-&gt;head-&gt;prev = node;
        list-&gt;head = node;
    }

    // æ›´æ–°é“¾è¡¨èŠ‚ç‚¹æ•°
    list-&gt;len++;

    return list;
}
</code></pre></div><ol start="2">
<li>å°†å…ƒç´ æ’å…¥åˆ°listè¡¨å°¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæƒ³è¡¨å°¾æ’å…¥val5ä¹‹ålistçš„å˜åŒ–ï¼Œçº¢è‰²çš„ç›¸å…³æŒ‡é’ˆæ˜¯å‘ç”Ÿå˜åŒ–çš„æŒ‡é’ˆã€‚</li>
</ol>
<figure><img src="http://zzk31.320.io/img/20230521230452.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<div class="language-C" data-ext="C" data-title="C"><pre class="language-C"><code>/*
 * ä½¿ç”¨ç»™å®šçš„valueå€¼æ„é€ æ–°çš„èŠ‚ç‚¹å¹¶æ·»åŠ åˆ°é“¾è¡¨çš„è¡¨å°¾
 * å¦‚æœä¸ºæ–°èŠ‚ç‚¹åˆ†é…å†…å­˜å‡ºé”™ï¼Œé‚£ä¹ˆä¸æ‰§è¡Œä»»ä½•åŠ¨ä½œï¼Œä»…è¿”å› NULL
 * å¦‚æœæ‰§è¡ŒæˆåŠŸï¼Œè¿”å›ä¼ å…¥çš„é“¾è¡¨æŒ‡é’ˆ
 * T = O(1)
 */
list *listAddNodeTail(list *list, void *value)
{
    listNode *node;

    // ä¸ºæ–°èŠ‚ç‚¹åˆ†é…å†…å­˜
    if ((node = zmalloc(sizeof(*node))) == NULL)
        return NULL;

    // ä¿å­˜å€¼æŒ‡é’ˆ
    node-&gt;value = value;

    // ç›®æ ‡é“¾è¡¨ä¸ºç©º
    // å½“é“¾è¡¨ä¸ºç©ºæ—¶ï¼Œæ–°æ’å…¥çš„èŠ‚ç‚¹æ—¢æ˜¯å¤´ç»“ç‚¹ä¹Ÿæ˜¯å°¾ç»“ç‚¹
    if (list-&gt;len == 0) {
        list-&gt;head = list-&gt;tail = node;
        // æ³¨æ„å¤´ç»“ç‚¹çš„å‰é©±æŒ‡é’ˆåº”è¯¥ä¸ºç©ºï¼Œå°¾ç»“ç‚¹çš„åç»§æŒ‡é’ˆåº”è¯¥ä¸ºç©º
        node-&gt;prev = node-&gt;next = NULL;
    // ç›®æ ‡é“¾è¡¨éç©º
    } else {
        node-&gt;prev = list-&gt;tail;
        node-&gt;next = NULL;
        list-&gt;tail-&gt;next = node;
        list-&gt;tail = node;
    }

    // æ›´æ–°é“¾è¡¨èŠ‚ç‚¹æ•°
    list-&gt;len++;

    return list;
}
</code></pre></div><ol start="3">
<li>åˆ›å»ºlistï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶ä¸­NULLæŒ‡é’ˆæ²¡æœ‰ç”»å‡ºï¼š</li>
</ol>
<figure><img src="http://zzk31.320.io/img/20230521230555.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<div class="language-C" data-ext="C" data-title="C"><pre class="language-C"><code>/*
 * åˆ›å»ºä¸€ä¸ªæ–°çš„é“¾è¡¨
 * åˆ›å»ºæˆåŠŸè¿”å›é“¾è¡¨ï¼Œå¤±è´¥è¿”å› NULL ã€‚
 * T = O(1)
 */
list *listCreate(void)
{
    struct list *list;

    // åˆ†é…å†…å­˜
    if ((list = zmalloc(sizeof(*list))) == NULL)
        return NULL;

    // åˆå§‹åŒ–å„é¡¹å±æ€§
    list-&gt;head = list-&gt;tail = NULL;
    list-&gt;len = 0;
    list-&gt;dup = NULL;
    list-&gt;free = NULL;
    list-&gt;match = NULL;

    return list;
}
</code></pre></div>]]></content:encoded>
      <enclosure url="http://zzk31.320.io/img/20230521171907.png" type="image/png"/>
    </item>
    <item>
      <title>Rediså­¦ä¹ ç¬”è®°ä¹‹å­—ç¬¦ä¸²</title>
      <link>https://kkwalking.github.com/person-database/person-database/middleware/redis/redis-learn-string.html</link>
      <guid>https://kkwalking.github.com/person-database/person-database/middleware/redis/redis-learn-string.html</guid>
      <source url="https://kkwalking.github.com/person-database/person-database/rss.xml">Rediså­¦ä¹ ç¬”è®°ä¹‹å­—ç¬¦ä¸²</source>
      <description>æ‹‰ä¸ªStar å¦‚æœæœ¬çŸ¥è¯†åº“çš„å†…å®¹å¸®åŠ©åˆ°ä½ ï¼Œè¿˜è¯·ç‚¹ä¸ªå…è´¹çš„Starï¼Œæ„Ÿè°¢ã€‚ä¼ é€é—¨ï¼šGitHub æœ¬ç³»åˆ—æ˜¯ä¸ªäººçš„Rediså­¦ä¹ ç¬”è®°ï¼Œå‚è€ƒçš„ä¹¦ç±æœ‰ã€ŠRedisè®¾è®¡ä¸å®ç°ã€‹ã€ã€ŠRedisæ·±åº¦å†é™©--æ ¸å¿ƒåŸç†ä¸åº”ç”¨å®è·µã€‹ï¼ŒRedisæºç ç‰ˆæœ¬æ˜¯é»„å¥å®è€å¸ˆæ³¨é‡Šçš„Redis-3.0-annotatedç‰ˆæœ¬ ä¸€ã€SDSåŸºæœ¬æ¦‚å¿µä»‹ç» Redisæœ‰äº”ç§åŸºç¡€æ•°æ®ç»“æ„ï¼Œåˆ†åˆ«æ˜¯s...</description>
      <category>ä¸­é—´ä»¶</category>
      <pubDate>Thu, 12 Oct 2023 00:00:00 GMT</pubDate>
      <content:encoded><![CDATA[<div class="hint-container tip">
<p class="hint-container-title">æ‹‰ä¸ªStar</p>
<ul>
<li>å¦‚æœ<a href="https://github.com/kkwalking/person-database" target="blank">æœ¬çŸ¥è¯†åº“</a>çš„å†…å®¹å¸®åŠ©åˆ°ä½ ï¼Œè¿˜è¯·ç‚¹ä¸ªå…è´¹çš„Starï¼Œæ„Ÿè°¢ã€‚ä¼ é€é—¨ï¼š<a href="https://github.com/kkwalking/person-database" target="blank">GitHub</a></li>
</ul>
</div>
<blockquote>
<p>æœ¬ç³»åˆ—æ˜¯ä¸ªäººçš„Rediså­¦ä¹ ç¬”è®°ï¼Œå‚è€ƒçš„ä¹¦ç±æœ‰ã€ŠRedisè®¾è®¡ä¸å®ç°ã€‹ã€ã€ŠRedisæ·±åº¦å†é™©--æ ¸å¿ƒåŸç†ä¸åº”ç”¨å®è·µã€‹ï¼ŒRedisæºç ç‰ˆæœ¬æ˜¯é»„å¥å®è€å¸ˆæ³¨é‡Šçš„<a href="https://github.com/huangz1990/redis-3.0-annotated" target="_blank" rel="noopener noreferrer">Redis-3.0-annotated</a>ç‰ˆæœ¬</p>
</blockquote>
<h2>ä¸€ã€SDSåŸºæœ¬æ¦‚å¿µä»‹ç»</h2>
<p>Redisæœ‰äº”ç§åŸºç¡€æ•°æ®ç»“æ„ï¼Œåˆ†åˆ«æ˜¯stringï¼ˆå­—ç¬¦ä¸²ï¼‰ã€listï¼ˆåˆ—è¡¨ï¼‰ã€hashï¼ˆå­—å…¸ï¼‰ã€setï¼ˆé›†åˆï¼‰ä»¥åŠzsetï¼ˆä¹Ÿå«åšsorted setï¼Œæœ‰åºé›†åˆï¼‰ã€‚å…¶ä¸­ï¼ŒRedisä¸­çš„å­—ç¬¦ä¸²é‡‡ç”¨äº†ä¸€ç§åä¸ºç®€å•åŠ¨æ€å­—ç¬¦ä¸²çš„ç±»å‹ï¼ˆsimple dynamic string, SDSï¼‰ï¼Œè€Œä¸æ˜¯Cå­—ç¬¦ä¸²ï¼ˆå…·ä½“åŸå› åç»­ä¼šè§£é‡Šï¼‰ã€‚åœ¨Redisä¸­ï¼ŒCå­—ç¬¦ä¸²ä»…ä½œä¸ºå­—ç¬¦ä¸²å­—é¢é‡ï¼Œå³ç±»ä¼¼<code>"Hello, world"</code>ï¼Œè€Œåœ¨éœ€è¦ä½¿ç”¨å¯ä¿®æ”¹çš„å­—ç¬¦ä¸²çš„åœ°æ–¹ï¼Œå‡é‡‡ç”¨SDSæ¥è¡¨ç¤ºå­—ç¬¦ä¸²ã€‚</p>
<p>å½“å®¢æˆ·ç«¯æ‰§è¡Œå‘½ä»¤ï¼š</p>
<div class="language-text" data-ext="text" data-title="text"><pre class="language-text"><code>redis&gt; SET name zzk
OK
</code></pre></div><p>Rediså°†åœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„é”®å€¼å¯¹ã€‚å…¶ä¸­ï¼Œé”®å€¼å¯¹çš„keyæ˜¯ä¸€ä¸ªSDSå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«ç€å­—ç¬¦ä¸²"name"ï¼›valueæ˜¯ä¸€ä¸ªSDSå¯¹è±¡ï¼Œå†…éƒ¨åŒ…å«ç€å­—ç¬¦ä¸²â€œzzkâ€ã€‚</p>
<p>åˆå¦‚ï¼Œå½“å®¢æˆ·ç«¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>
<div class="language-text" data-ext="text" data-title="text"><pre class="language-text"><code>redis&gt; LPUSH classmates xiaoming xiaohong xiaobai
</code></pre></div><p>Rediså°†åœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªé”®å€¼å¯¹ï¼Œå…¶ä¸­ï¼Œkeyæ˜¯ä¸€ä¸ªåŒ…å«ç€å­—ç¬¦ä¸²"classmates"çš„SDSå¯¹è±¡ï¼Œvalueæ˜¯ä¸€ä¸ªlistå¯¹è±¡ã€‚è¿™ä¸ªlistå¯¹è±¡æœ‰ä¸‰ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªSDSå¯¹è±¡ï¼Œç¬¬ä¸€ä¸ªSDSå¯¹è±¡åŒ…å«å­—ç¬¦ä¸²"xiaoming"ï¼Œç¬¬äºŒä¸ªSDSå¯¹è±¡åŒ…å«å­—ç¬¦ä¸²"xiaohong"ç­‰ã€‚</p>
<p>ä»ä¸Šè¿°ä¾‹å­å¯ä»¥çœ‹å‡ºï¼ŒSDSä½œä¸ºRedisçš„å­—ç¬¦ä¸²å®ç°ï¼Œè¢«é¢‘ç¹ç”¨åœ¨å„ç§ä½¿ç”¨åœºæ™¯ã€‚</p>
<h2>äºŒã€ä¸ºä»€ä¹ˆä½¿ç”¨SDSè€Œä¸æ˜¯Cå­—ç¬¦ä¸²ï¼Ÿ</h2>
<blockquote>
<p>ä»¥ä¸‹æ¶‰åŠçš„Redisä»£ç æ¥è‡ªRedis3.0ï¼Œè™½ç„¶Redisç›®å‰å·²ç»æ›´æ–°åˆ°7.0ï¼Œä½†æ˜¯æ•°æ®ç»“æ„çš„å®ç°åŸç†æ˜¯ä¸€è„‰ç›¸æ‰¿çš„ï¼Œ3.0ç‰ˆæœ¬çš„ä»£ç æ›´åŠ ç®€å•ï¼Œæœ‰åŠ©äºåŸç†çš„ç†è§£ã€‚</p>
</blockquote>
<p>SDSçš„ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="language-C" data-ext="C" data-title="C"><pre class="language-C"><code>struct sdshdr {

    int len;
    
    int free;
    
    char buf[];

};
</code></pre></div><p>å…¶ä¸­ï¼Œbufæ˜¯ä¸€ä¸ªå­—ç¬¦æ•°ç»„ï¼Œç”¨äºä¿å­˜å­—ç¬¦ä¸²ï¼›lenç”¨äºè®°å½•bufæ•°ç»„ä¸­å·²ä½¿ç”¨å­—èŠ‚çš„æ•°é‡ï¼Œä¹Ÿå°±æ˜¯SDSæ‰€ä¿å­˜çš„å­—ç¬¦ä¸²çš„é•¿åº¦ï¼›freeç”¨äºè®°å½•bufæ•°ç»„ä¸­æœªä½¿ç”¨å­—èŠ‚çš„æ•°é‡ã€‚</p>
<p>ä¸‹å›¾è¡¨ç¤ºä¸€ä¸ªåŒ…å«å­—ç¬¦ä¸²â€œzzkâ€çš„SDSå¯¹è±¡ã€‚</p>
<figure><img src="http://zzk31.320.io/img/20230521135841.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>åœ¨è¿™ä¸ªSDSå¯¹è±¡ä¸­ï¼Œbufæ˜¯ä¸€ä¸ªcharæ•°ç»„ï¼Œå…¶æ•°ç»„å†…å®¹ä¸º:'z'ï¼Œ'z'ï¼Œ'k'å’Œæœ«å°¾çš„'\0'ã€‚freeä¸º0è¡¨ç¤ºæ²¡æœ‰å¤šä½™çš„å­—èŠ‚å¯ä¾›ä½¿ç”¨ï¼Œlenä¸º3è¡¨ç¤ºè¿™ä¸ªSDSçš„å­—ç¬¦ä¸²é•¿åº¦ä¸º3ï¼ˆä¸Cå­—ç¬¦ä¸²é•¿åº¦å®šä¹‰ä¸€æ ·ï¼Œä¸åŒ…æ‹¬æœ«å°¾çš„'\0'ï¼‰</p>
<p>ä¸‹å›¾å±•ç¤ºäº†å¦ä¸€ä¸ªSDSå¯¹è±¡çš„å†…éƒ¨ç»“æ„ï¼š</p>
<figure><img src="http://zzk31.320.io/img/20230521135902.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>åœ¨è¿™ä¸ªSDSå¯¹è±¡ä¸­ï¼Œbufæ•°ç»„çš„å†…å®¹ä¸º"sea"(æœ«å°¾è¿˜æœ‰ä¸ª'\0')ï¼Œlenä¸º3è¡¨ç¤ºè¿™ä¸ªSDSçš„å­—ç¬¦ä¸²é•¿åº¦ä¸º3ï¼Œè€Œfreeä¸º3è¡¨ç¤ºè¿™ä¸ªbufæ•°ç»„è¿˜æœ‰3ä¸ªå­—èŠ‚æœªè¢«ä½¿ç”¨ã€‚</p>
<h3>1. å¸¸æ•°æ—¶é—´è·å–å­—ç¬¦ä¸²é•¿åº¦</h3>
<p>ä»ä¸Šè¿°ä¸¤ä¸ªä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œbufæ•°ç»„çš„å®é™…å¤§å°å¹¶ä¸æ€»æ˜¯ç­‰äºï¼ˆå­—ç¬¦ä¸²é•¿åº¦+1ï¼‰ã€‚</p>
<p>è€Œåœ¨Cè¯­è¨€ä¸­ï¼Œä¸€ä¸ªCå­—ç¬¦ä¸²ä¾‹å­å¦‚ä¸‹ï¼š</p>
<figure><img src="http://zzk31.320.io/img/20230521135922.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>å¯ä»¥çœ‹å‡ºï¼ŒCå­—ç¬¦ä¸²å¹¶ä¸åŒ…å«é•¿åº¦ä¿¡æ¯ï¼Œå½“éœ€è¦è·å–å­—ç¬¦ä¸²é•¿åº¦ä¿¡æ¯æ—¶ï¼Œéœ€è¦éå†ä¸€éå­—ç¬¦ä¸²æ‰èƒ½è®¡ç®—å‡ºå…¶é•¿åº¦ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º$O(n) $,nä¸ºå­—ç¬¦ä¸²é•¿åº¦ã€‚ï¼ˆé¢˜å¤–è¯ï¼šstrlen()æ˜¯æ±‚Cå­—ç¬¦ä¸²é•¿åº¦å‡½æ•°ï¼Œæœ‰æ—¶å€™ç¼–ç¨‹ä¸æ³¨æ„ï¼Œè¿˜å¯èƒ½å°†strlen()å†™åˆ°å¾ªç¯åˆ¤æ–­æ¡ä»¶ä¸­ï¼Œé€ æˆå¤æ‚åº¦æå‡ä¸€ä¸ªé‡çº§ï¼‰</p>
<p>å› æ­¤ï¼Œè¿½æ±‚æ•ˆç‡çš„Rediså¹¶æ²¡æœ‰ç›´æ¥é‡‡ç”¨Cå­—ç¬¦ä¸²ä½œä¸ºå­—ç¬¦ä¸²å®ç°ï¼Œè€Œæ˜¯ä½¿ç”¨äº†lenæ¥è®°å½•å½“å‰ä½¿ç”¨çš„å­—ç¬¦å¤§å°ï¼Œä»è€Œå°†æ—¶é—´å¤æ‚åº¦é™ä½åˆ°$O(1)$ã€‚</p>
<h3>2. é˜²æ­¢ç¼“å†²åŒºæº¢å‡º</h3>
<p>å¦‚æœä½¿ç”¨ä¸å½“ï¼ŒCå­—ç¬¦ä¸²è¿˜å¯èƒ½å¸¦æ¥ç¼“å†²åŒºæº¢å‡ºçš„é—®é¢˜ã€‚</p>
<p>å‡è®¾å¦‚ä¸‹æƒ…å†µï¼Œæœ‰ä¸¤ä¸ªCå­—ç¬¦ä¸²s1å’Œs2ï¼Œä»–ä»¬çš„ç©ºé—´åˆ†é…ä½ç½®å¦‚ä¸‹ï¼Œs2ç´§æŒ¨åœ¨s1åé¢ã€‚</p>
<figure><img src="http://zzk31.320.io/img/20230521140010.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>è‹¥ç›´æ¥è°ƒç”¨Cå‡½æ•°strcat(s1, ",Lucy")ï¼Œä¼å›¾å°†s1çš„å†…å®¹ä¿®æ”¹ä¸º"Hey,Lucy"ï¼Œè¿™æ ·åšç¡®å®èƒ½è¾¾åˆ°ç›®çš„ã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹å¼æ˜¯é”™è¯¯çš„ï¼Œæ­£ç¡®çš„æ–¹å¼åº”è¯¥æ˜¯åœ¨è°ƒç”¨strcat()ä¹‹å‰ä¸ºs1åˆ†é…è¶³å¤Ÿçš„ç©ºé—´ï¼Œè€Œä¸æ˜¯ä¸ç»æ£€æŸ¥åœ°ç›´æ¥è°ƒç”¨ã€‚å› ä¸ºè¿™ç§æ–¹å¼ä¼šå¯¼è‡´s2è¢«è¦†ç›–ï¼Œç§°ä¹‹ä¸ºç¼“å†²åŒºæº¢å‡ºç°è±¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure><img src="http://zzk31.320.io/img/20230521135953.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>è€ŒSDSçš„è®¾è®¡åˆ™é¿å…äº†è¿™ä¸€æƒ…å†µã€‚å½“éœ€è¦å¯¹SDSè¿›è¡Œæ‰©å……æ—¶ï¼ŒSDSä¸­çš„freeå±æ€§ä½¿å¾—SDSçš„APIå¾ˆå®¹æ˜“æ£€æŸ¥SDSçš„å‰©ä½™ç©ºé—´æ˜¯å¦æ»¡è¶³ä¿®æ”¹çš„éœ€è¦ï¼Œå¦‚æœä¸æ»¡è¶³çš„è¯ï¼Œä¼šä¸ºSDSåˆ†é…ä¸€ä¸ªæ–°çš„å®¹é‡è¶³å¤Ÿçš„bufæ•°ç»„ï¼Œå†å»æ‰§è¡Œä¿®æ”¹æ“ä½œã€‚å› æ­¤ï¼ŒSDSçš„ä½¿ç”¨è€…ä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹SDSç©ºé—´å¤§å°ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒå‡ºç°ç¼“å†²åŒºæº¢å‡ºé—®é¢˜ã€‚</p>
<h3>3. æé«˜å†…å­˜é‡åˆ†é…æ•ˆç‡</h3>
<p>å¦‚å‰æ‰€è¿°ï¼ŒCå­—ç¬¦ä¸²æœ¬èº«å¹¶ä¸ä¿å­˜è‡ªèº«çš„é•¿åº¦ä¿¡æ¯ï¼Œè€Œæ˜¯é€šè¿‡åœ¨å­—ç¬¦ä¸²æœ«å°¾æ·»åŠ ä¸€ä¸ª'\0'æ¥æ ‡è¯†å­—ç¬¦ä¸²ç»“æŸã€‚å› æ­¤ï¼Œå¯¹äºä¸€ä¸ªåŒ…å«äº† N ä¸ªå­—ç¬¦çš„ C å­—ç¬¦ä¸²æ¥è¯´ï¼Œ è¿™ä¸ª C å­—ç¬¦ä¸²çš„åº•å±‚å®ç°æ€»æ˜¯ä¸€ä¸ª N+1 ä¸ªå­—ç¬¦é•¿çš„æ•°ç»„ï¼ˆé¢å¤–çš„ä¸€ä¸ªå­—ç¬¦ç”¨äºä¿å­˜'\0'å­—ç¬¦ï¼‰ã€‚</p>
<p>è¿™ç§å…³è”æ€§ä½¿å¾—å¯¹Cå­—ç¬¦ä¸²çš„å¢åŠ æˆ–è€…åˆ é™¤å­—ç¬¦æ“ä½œæ€»æ˜¯ä¼´éšç€å†…å­˜é‡åˆ†é…æ“ä½œã€‚</p>
<p>ä»ä»¥Cå­—ç¬¦ä¸²çš„æ‹¼æ¥åœºæ™¯ä¸ºä¾‹ï¼Œè‹¥è¦åœ¨å€¼ä¸ºâ€œhelloâ€çš„å­—ç¬¦ä¸²s1åé¢æ‹¼æ¥ä¸Šâ€œ,worldâ€ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨<code>strcat(s1,",world");</code>æ“ä½œä¹‹å‰ï¼Œéœ€è¦å…ˆä¸ºs1åˆ†é…è¶³å¤Ÿå¤§çš„ç©ºé—´ï¼Œå¦åˆ™å°±ä¼šå‘ç”Ÿç¼“å†²åŒºæº¢å‡ºã€‚</p>
<p>è‹¥ä¹‹åæˆ‘ä»¬æƒ³åœ¨s1ä¹‹ååœ¨æ‹¼æ¥ä¸Š"!!!"ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨<code>strcat(s1,"!!!");</code>æ“ä½œä¹‹å‰åˆéœ€è¦ä¸ºs1åˆ†é…ç©ºé—´ã€‚</p>
<p>è¿™ç§é¢‘ç¹åˆ†é…ç©ºé—´çš„æ–¹å¼ä¼šå¸¦æ¥æ€§èƒ½å¼€é”€ï¼Œè€ŒRedisä½œä¸ºé«˜æ€§èƒ½çš„ç¼“å†²ä¸­é—´ä»¶ï¼Œè‹¥æ˜¯é‡‡ç”¨è¿™ç§æ–¹å¼åˆ™å¿…ç„¶å¯¹æ€§èƒ½é€ æˆå½±å“ã€‚</p>
<p>å› æ­¤ï¼ŒSDSé‡‡ç”¨äº†ç©ºé—´é¢„åˆ†é…æ–¹å¼æ¥è§£å†³è¿™ä¸€é—®é¢˜ã€‚åœ¨ SDS ä¸­ï¼Œ buf æ•°ç»„çš„é•¿åº¦ä¸ä¸€å®šå°±æ˜¯å®é™…å­˜å‚¨çš„å­—ç¬¦æ•°é‡åŠ ä¸€ï¼Œ æ•°ç»„é‡Œé¢å¯ä»¥åŒ…å«æœªä½¿ç”¨çš„å­—èŠ‚ï¼Œ è€ŒSDS çš„ free å±æ€§è®°å½•äº†è¿™äº›å­—èŠ‚çš„æ•°é‡ ã€‚</p>
<h3>4.SDSçš„ç©ºé—´é¢„åˆ†é…ç­–ç•¥</h3>
<p>ç©ºé—´é¢„åˆ†é…ç­–ç•¥ç”¨äºä¼˜åŒ– SDS çš„å­—ç¬¦ä¸²å¢é•¿æ“ä½œï¼š å½“ SDS çš„ API å¯¹ä¸€ä¸ª SDS è¿›è¡Œä¿®æ”¹ï¼Œ å¹¶ä¸”éœ€è¦å¯¹ SDS è¿›è¡Œç©ºé—´æ‰©å±•çš„æ—¶å€™ï¼Œ ç¨‹åºä¸ä»…ä¼šä¸º SDS åˆ†é…ä¿®æ”¹æ‰€å¿…é¡»è¦çš„ç©ºé—´ï¼Œ è¿˜ä¼šä¸º SDS åˆ†é…é¢å¤–çš„æœªä½¿ç”¨ç©ºé—´ã€‚</p>
<p>å…¶ä¸­ï¼Œ é¢å¤–åˆ†é…çš„æœªä½¿ç”¨ç©ºé—´æ•°é‡ç”±ä»¥ä¸‹è§„åˆ™å†³å®šï¼š</p>
<ul>
<li>å¦‚æœå¯¹ SDS è¿›è¡Œä¿®æ”¹ä¹‹åï¼Œ SDS çš„é•¿åº¦ len å°äº 1 MB ï¼Œ é‚£ä¹ˆç¨‹åºåˆ†é…å’Œ len å±æ€§åŒæ ·å¤§å°çš„æœªä½¿ç”¨ç©ºé—´ï¼Œ è¿™æ—¶ SDS len å±æ€§çš„å€¼å’Œ free å±æ€§çš„å€¼ç›¸åŒã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œ å¦‚æœè¿›è¡Œä¿®æ”¹ä¹‹åï¼Œ SDS çš„ len å°†å˜æˆ 10 å­—èŠ‚ï¼Œ é‚£ä¹ˆç¨‹åºä¹Ÿä¼šåˆ†é…13 å­—èŠ‚çš„æœªä½¿ç”¨ç©ºé—´ï¼Œ SDS çš„ buf æ•°ç»„çš„å®é™…é•¿åº¦å°†å˜æˆ 10+ 10 + 1 = 21 å­—èŠ‚ï¼ˆé¢å¤–çš„ä¸€å­—èŠ‚ç”¨äºä¿å­˜'\0'å­—ç¬¦ï¼‰</li>
<li>å¦‚æœå¯¹ SDS è¿›è¡Œä¿®æ”¹ä¹‹åï¼Œ SDS çš„é•¿åº¦å°†å¤§äºç­‰äº 1 MB ï¼Œ é‚£ä¹ˆç¨‹åºä¼šåˆ†é… 1 MB çš„æœªä½¿ç”¨ç©ºé—´ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œ å¦‚æœè¿›è¡Œä¿®æ”¹ä¹‹åï¼Œ SDS çš„ len å°†å˜æˆ 10 MB ï¼Œ é‚£ä¹ˆç¨‹åºä¼šåˆ†é… 1 MB çš„æœªä½¿ç”¨ç©ºé—´ï¼Œ SDS çš„ buf æ•°ç»„çš„å®é™…é•¿åº¦å°†ä¸º 10 MB + 1 MB + 1 byte ã€‚</li>
</ul>
<p>ç¬¬ä¸€æ¡è§„åˆ™ç®€å•åœ°è¯´å°±æ˜¯æˆå€å¢é•¿è§„åˆ™ï¼Œåªä¸è¿‡è¿™ä¸ªåŸºæ•°æ˜¯ä¿®æ”¹ä¹‹åçš„é•¿åº¦ã€‚ç¬¬äºŒæ¡è§„åˆ™æ˜¯å› ä¸ºRediséœ€è¦åœ¨æ€§èƒ½å’Œæ•ˆç‡ä¹‹é—´å–èˆï¼Œå¦‚æœè¾¾åˆ°äº†1MBçš„çº§åˆ«è¿˜æ˜¯é‡‡ç”¨æˆå€å¢é•¿è§„åˆ™ï¼Œé‚£ä¹ˆSDSçš„å¢é•¿é€Ÿåº¦å¾ˆå¿«å¯¼è‡´å¤§é‡çš„å†…å­˜ç©ºé—´å ç”¨ã€‚</p>
<p>é€šè¿‡è¿™ç§é¢„åˆ†é…ç­–ç•¥ï¼Œ SDS å°†è¿ç»­å¢é•¿ N æ¬¡å­—ç¬¦ä¸²æ‰€éœ€çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°ä»å¿…å®š N æ¬¡é™ä½ä¸ºæœ€å¤š N æ¬¡ã€‚</p>
<p><strong>æ­¤å¤–ï¼ŒSDSè¿˜é‡‡ç”¨äº†æƒ°æ€§ç©ºé—´é‡Šæ”¾æ–¹å¼ã€‚</strong></p>
<p>æ‰€è°“æƒ°æ€§ç©ºé—´é‡Šæ”¾æ˜¯æŒ‡ï¼Œ å½“ SDS çš„ API éœ€è¦ç¼©çŸ­ SDS ä¿å­˜çš„å­—ç¬¦ä¸²æ—¶ï¼Œ ç¨‹åºå¹¶ä¸ç«‹å³ä½¿ç”¨å†…å­˜é‡åˆ†é…æ¥å›æ”¶ç¼©çŸ­åå¤šå‡ºæ¥çš„å­—èŠ‚ï¼Œ è€Œæ˜¯ä½¿ç”¨ free å±æ€§å°†è¿™äº›å­—èŠ‚çš„æ•°é‡è®°å½•èµ·æ¥ï¼Œ å¹¶ç­‰å¾…å°†æ¥ä½¿ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæƒ°æ€§ç©ºé—´é‡Šæ”¾ç”¨äºä¼˜åŒ– SDS çš„å­—ç¬¦ä¸²ç¼©çŸ­æ“ä½œã€‚</p>
<p>ä¾‹å¦‚ï¼Œ sdstrim å‡½æ•°æ¥å—ä¸€ä¸ª SDS å’Œä¸€ä¸ª Cå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œ ä» SDS å·¦å³ä¸¤ç«¯åˆ†åˆ«ç§»é™¤æ‰€æœ‰åœ¨ Cå­—ç¬¦ä¸²ä¸­å‡ºç°è¿‡çš„å­—ç¬¦ã€‚</p>
<p>æ‰§è¡Œ<code>sdstrim(s, "AA..");</code>åSDSçš„ç»“æ„å˜åŒ–å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<figure><img src="http://zzk31.320.io/img/20230521140039.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå¹¶æ²¡æœ‰å›æ”¶ä¸‰ä¸ª'A'å­—ç¬¦æ‰€å çš„ç©ºé—´ï¼Œè€Œæ˜¯ä½¿ç”¨freeè®°å½•äº†å‰©ä½™ç©ºé—´ã€‚</p>
<p>å½“åœ¨ä¸‹ä¸€æ¬¡å¯¹SDSè¿›è¡Œä¿®æ”¹æ“ä½œï¼Œæ¯”å¦‚è°ƒç”¨<code>strcat(s, "zzk")</code>æ—¶ï¼Œä¸å¿…åœ¨è¿›è¡Œå†…å­˜é‡åˆ†é…ï¼Œå› ä¸ºæœ‰è¶³å¤Ÿçš„å‰©ä½™ç©ºé—´æ”¯æŒæ‹¼æ¥æ“ä½œï¼Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure><img src="http://zzk31.320.io/img/20230521134208.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h3>5.äºŒè¿›åˆ¶å®‰å…¨</h3>
<p>æ­¤å¤–ï¼Œåœ¨Cå­—ç¬¦ä¸²ä¸­ï¼Œç”±äºåªä½¿ç”¨'\0'æ¥è¡¨ç¤ºå­—ç¬¦ä¸²ç»“æŸï¼Œå› æ­¤ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²é‡Œé¢ä¸èƒ½åŒ…å«ç©ºå­—ç¬¦ï¼Œå¦åˆ™å°±ä¼šè¢«è®¤ä¸ºæ˜¯å­—ç¬¦ä¸²ç»“å°¾ã€‚è¿™å°±ä½¿å¾—Cå­—ç¬¦ä¸²åªèƒ½å­˜å‚¨æ–‡æœ¬æ•°æ®ï¼Œè€Œä¸èƒ½å­˜å‚¨äºŒè¿›åˆ¶æ•°æ®å¦‚å›¾ç‰‡ã€è§†é¢‘ç­‰ã€‚</p>
<p>è€ŒRedisçš„SDSåˆ™å¯ä»¥ç”¨æ¥å­˜å‚¨äºŒè¿›åˆ¶æ•°æ®ï¼ŒSDSä¸é ç©ºå­—ç¬¦æ¥æ ‡è¯†å­˜å‚¨å†…å®¹çš„ç»“æŸï¼Œè€Œæ˜¯é€šè¿‡lenæ¥æ ‡è¯†ã€‚buf[]æ•°ç»„æ˜¯ä¸€ä¸ªcharæ•°æ®ï¼Œå¯ä»¥ç›´æ¥ç”¨äºå­˜å‚¨äºŒè¿›åˆ¶æ•°æ®ï¼ˆåªéœ€è¦å®šä¹‰å¥½ç¼–è§£ç æ ¼å¼å³å¯è¿›è¡Œè¯»å†™ï¼‰ã€‚</p>
<p>å½“ç„¶ï¼Œå¦ä¸€æ–¹é¢ï¼ŒSDSä¹Ÿä¼šåœ¨å­—ç¬¦ä¸²æœ«å°¾æ·»åŠ '\0'ï¼Œå› æ­¤SDSä¹Ÿå¯ä»¥å¤ç”¨éƒ¨åˆ†Cå­—ç¬¦ä¸²å‡½æ•°ã€‚</p>
]]></content:encoded>
      <enclosure url="http://zzk31.320.io/img/20230521135841.png" type="image/png"/>
    </item>
    <item>
      <title>hexoæ­å»ºä¸ªäººåšå®¢+NexTä¸»é¢˜</title>
      <link>https://kkwalking.github.com/person-database/person-database/blog/hexo-next.html</link>
      <guid>https://kkwalking.github.com/person-database/person-database/blog/hexo-next.html</guid>
      <source url="https://kkwalking.github.com/person-database/person-database/rss.xml">hexoæ­å»ºä¸ªäººåšå®¢+NexTä¸»é¢˜</source>
      <description>æ‹‰ä¸ªStar å¦‚æœæœ¬çŸ¥è¯†åº“çš„å†…å®¹å¸®åŠ©åˆ°ä½ ï¼Œè¿˜è¯·ç‚¹ä¸ªå…è´¹çš„Starï¼Œæ„Ÿè°¢ã€‚ä¼ é€é—¨ï¼šGitHub 1 hexoç®€ä»‹ Hexo æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ã€‚Hexo ä½¿ç”¨ Markdownï¼ˆæˆ–å…¶ä»–æ¸²æŸ“å¼•æ“ï¼‰è§£ææ–‡ç« ï¼Œç”Ÿæˆé™æ€ç½‘é¡µã€‚ --Hexoå®˜ç½‘ 2 hexoå®‰è£… å®‰è£…hexoéœ€è¦å…ˆå®‰è£…node.jså’ŒGit 2.1 å®‰è£…node.js Node.j...</description>
      <pubDate>Fri, 27 Nov 2020 00:00:00 GMT</pubDate>
      <content:encoded><![CDATA[<div class="hint-container tip">
<p class="hint-container-title">æ‹‰ä¸ªStar</p>
<ul>
<li>å¦‚æœ<a href="https://github.com/shzyjbr/person-database" target="blank">æœ¬çŸ¥è¯†åº“</a>çš„å†…å®¹å¸®åŠ©åˆ°ä½ ï¼Œè¿˜è¯·ç‚¹ä¸ªå…è´¹çš„Starï¼Œæ„Ÿè°¢ã€‚ä¼ é€é—¨ï¼š<a href="https://github.com/shzyjbr/person-database" target="blank">GitHub</a></li>
</ul>
</div>
<h3>1 hexoç®€ä»‹</h3>
<blockquote>
<p>Hexo æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ã€‚Hexo ä½¿ç”¨ <a href="http://daringfireball.net/projects/markdown/" target="_blank" rel="noopener noreferrer">Markdown</a>ï¼ˆæˆ–å…¶ä»–æ¸²æŸ“å¼•æ“ï¼‰è§£ææ–‡ç« ï¼Œç”Ÿæˆé™æ€ç½‘é¡µã€‚   --<a href="https://hexo.io/zh-cn/" target="_blank" rel="noopener noreferrer">Hexo</a>å®˜ç½‘</p>
</blockquote>
<h3>2 hexoå®‰è£…</h3>
<p>å®‰è£…hexoéœ€è¦å…ˆå®‰è£…node.jså’ŒGit</p>
<h4>2.1 å®‰è£…node.js</h4>
<blockquote>
<p>Node.js ç‰ˆæœ¬éœ€ä¸ä½äº 10.13ï¼Œå»ºè®®ä½¿ç”¨ Node.js 12.0 åŠä»¥ä¸Šç‰ˆæœ¬</p>
</blockquote>
<p>é€šè¿‡node.jså®˜ç½‘ä¸‹è½½å®‰è£…ç‰ˆè¿›è¡Œå®‰è£…ï¼Œé€‰æ‹©14.15.1é•¿æœŸæ”¯æŒç‰ˆ å®˜ç½‘ï¼š<a href="https://nodejs.org/zh-cn/" target="_blank" rel="noopener noreferrer">Node.js</a></p>
<figure><img src="https://i.loli.net/2020/11/27/Eym3zR8bX1FpcxT.png" alt="image-20201127135412872.png" tabindex="0" loading="lazy"><figcaption>image-20201127135412872.png</figcaption></figure>
<p>å®‰è£…è¿‡ç¨‹ä¸æ™®é€šè½¯ä»¶å®‰è£…æ²¡æœ‰å·®åˆ«ï¼Œä¸€è·¯nextã€‚</p>
<h4>2.2 å®‰è£…Git</h4>
<p>é€šè¿‡Gitå®˜ç½‘ä¸‹è½½Gitå®‰è£…ç‰ˆè¿›è¡Œå®‰è£…ï¼Œå®‰è£…ç‰ˆæœ¬2.29.2 å®˜ç½‘ï¼š<a href="https://git-scm.com/" target="_blank" rel="noopener noreferrer">Git (git-scm.com)</a></p>
<figure><img src="https://i.loli.net/2020/11/27/Dew6M4naP5Aucby.png" alt="git.png" tabindex="0" loading="lazy"><figcaption>git.png</figcaption></figure>
<h4>2.3 æ­£å¼å®‰è£…hexo</h4>
<p>å®‰è£…å¥½node.jså’ŒGitä¹‹åå°±å¯ä»¥å¼€å§‹è¿›è¡Œhexoçš„å®‰è£…</p>
<div class="language-text" data-ext="text" data-title="text"><pre class="language-text"><code>npm install -g hexo-cli
</code></pre></div><p>å®‰è£…æˆåŠŸä¹‹åå¯ä»¥åœ¨cmdå‘½ä»¤è¡Œä¸­è¾“å…¥hexoï¼ŒæŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</p>
<figure><img src="https://i.loli.net/2020/11/27/P4Mktm3IlERVxoC.png" alt="image-20201127140007483" tabindex="0" loading="lazy"><figcaption>image-20201127140007483</figcaption></figure>
<p>å‡ºç°å¦‚ä¸‹æç¤ºåˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸã€‚</p>
<h3>3 ä½¿ç”¨hexoæ­å»ºåšå®¢</h3>
<h4>3.1 åˆå§‹åŒ–</h4>
<p>åœ¨Windowsä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä½œä¸ºæƒ³è¦æ­å»ºçš„åšå®¢çš„æ ¹ç›®å½•ï¼Œæ¯”å¦‚æˆ‘çš„å°±æ˜¯ D:\blog\hexo</p>
<p><strong>åœ¨cmdä¸­è¿›å…¥æ ¹ç›®å½•ä¸‹</strong>ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆå§‹åŒ–ï¼Œè¯¥å‘½ä»¤ä¼šåœ¨æ ¹ç›®å½•ä¸‹åˆ›å»ºhexoæ‰€éœ€çš„æ–‡ä»¶</p>
<div class="language-text" data-ext="text" data-title="text"><pre class="language-text"><code>hexo init
</code></pre></div><p>åˆ›å»ºå®Œæˆä¹‹åçš„ç›®å½•å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="language-text" data-ext="text" data-title="text"><pre class="language-text"><code>.
â”œâ”€â”€ _config.yml
â”œâ”€â”€ package.json
â”œâ”€â”€ scaffolds
â”œâ”€â”€ source
|   â”œâ”€â”€ _drafts
|   â””â”€â”€ _posts
â””â”€â”€ themes
</code></pre></div><p>å…¶ä¸­_config.ymlç§°ä¸ºç«™ç‚¹é…ç½®æ–‡ä»¶ï¼Œå¯¹åº”çš„ï¼Œthemes/_config.ymlç§°ä¸ºä¸»é¢˜é…ç½®æ–‡ä»¶ã€‚
ç®€å•è§£é‡Šä¸‹ä¸¤ä¸ªé…ç½®æ–‡ä»¶ã€‚æ ¹ç›®å½•ä¸‹çš„_config.ymlæ˜¯å¯¹æ•´ä¸ªåšå®¢ç«™ç‚¹çš„å†…å®¹è¿›è¡Œè®¾ç½®ã€‚hexoçš„åšå®¢å¯ä»¥æŒ‡å®šå¤šç§ä¸»é¢˜ï¼Œä¸»é¢˜çš„é…ç½®æ˜¯é€šè¿‡themes/_config.ymlè¿›è¡Œè®¾ç½®çš„ã€‚</p>
<h4>3.2 å¯åŠ¨hexo</h4>
<p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯ä»¥å¯åŠ¨hexoï¼Œè¿›è¡Œå¿«é€Ÿæ•ˆæœé¢„è§ˆã€‚</p>
<div class="language-text" data-ext="text" data-title="text"><pre class="language-text"><code>hexo server
</code></pre></div><p>å¯ä»¥çœ‹åˆ°å‡ºç°å¦‚ä¸‹æç¤ºï¼š</p>
<p><img src="https://i.loli.net/2020/11/27/qUmerCBi3Wcf6aF.png" alt="image-20201127141157314.png" loading="lazy">)</p>
<p>æµè§ˆå™¨è®¿é—®localhost:4000å¯ä»¥çœ‹åˆ°åšå®¢æ­å»ºæˆåŠŸã€‚</p>
<figure><img src="https://i.loli.net/2020/11/27/w5hLyImDjSJio1k.png" alt="image-20201127141428928.png" tabindex="0" loading="lazy"><figcaption>image-20201127141428928.png</figcaption></figure>
<h3>4. ä½¿ç”¨NexTä¸»é¢˜</h3>
<p>hexoå¯ä»¥é€šè¿‡æŒ‡å®šä¸åŒçš„ä¸»é¢˜ï¼Œè¾¾åˆ°æ›´æ¢åšå®¢é£æ ¼çš„ç›®çš„ã€‚hexoçš„ä¸»é¢˜å¯ä»¥è®¿é—®<a href="https://hexo.io/themes/" target="_blank" rel="noopener noreferrer">Themes | Hexo</a></p>
<p>æœ¬æ¬¡é€‰ç”¨Textä¸»é¢˜ã€‚</p>
<h4>4.1 ä¸‹è½½NexTä¸»é¢˜</h4>
<p>æˆ‘ä»¬é€šè¿‡Gitæ¥ä¸‹è½½ã€‚</p>
<p><strong>åœ¨cmdç›®å½•ä¸‹è¿›å…¥æ ¹ç›®å½•</strong>ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ã€‚</p>
<div class="language-text" data-ext="text" data-title="text"><pre class="language-text"><code>git clone https://github.com/iissnan/hexo-theme-next themes/next
</code></pre></div><p>ä¸‹è½½å®Œæ¯•åå¯ä»¥çœ‹åˆ°themesç›®å½•ä¸‹å¤šäº†ä¸€ä¸ªnextæ–‡ä»¶å¤¹</p>
<p><em>hexoæŠŠæ‰€æœ‰çš„ä¸»é¢˜éƒ½æ”¾åœ¨äº†themesæ–‡ä»¶å¤¹é‡Œé¢ï¼Œæ‰€ä»¥é€šå¸¸çš„åšæ³•å°±æ˜¯æŠŠæƒ³è¦ä½¿ç”¨çš„ä¸»é¢˜æ”¾åˆ°åœ¨themesç›®å½•ä¸‹é¢ï¼Œä¹‹åå»ç«™ç‚¹é…ç½®æ–‡ä»¶é‡Œé¢è¿›è¡Œä¸»é¢˜çš„è®¾ç½®ã€‚</em></p>
<h4>4.2 è®¾ç½®ç«™ç‚¹é…ç½®æ–‡ä»¶ï¼Œè¿›è¡Œä¸»é¢˜æ›´æ¢</h4>
<p>æ‰“å¼€ç«™ç‚¹é…ç½®æ–‡ä»¶_config.yml,  å¯ä»¥ä½¿ç”¨æŸ¥æ‰¾åŠŸèƒ½å®šä½åˆ°themeså…³é”®å­—ï¼Œä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š</p>
<div class="language-text" data-ext="text" data-title="text"><pre class="language-text"><code>theme: next
</code></pre></div><h4>4.3 å¯åŠ¨åšå®¢è¿›è¡ŒéªŒè¯</h4>
<p>è¾“å…¥<code>hexo server</code>å¯åŠ¨åšå®¢ï¼Œå¯ä»¥çœ‹åˆ°ä¸»é¢˜å·²ç»æ›´æ¢ä¸ºNexTä¸»é¢˜ã€‚</p>
<p><em>ä¸‹å›¾çš„NexTä¸»é¢˜ç»è¿‡äº†å…¶ä»–è®¾ç½®ï¼Œæ‰€ä»¥ä½ çš„ä¸»é¢˜å¯èƒ½å’Œæˆ‘çœ‹èµ·æ¥æœ‰ç‚¹ä¸ä¸€æ ·</em></p>
<figure><img src="https://i.loli.net/2020/11/27/TO42oeM7bp8xQ6y.png" alt="image-20201127145135433.png" tabindex="0" loading="lazy"><figcaption>image-20201127145135433.png</figcaption></figure>
]]></content:encoded>
      <enclosure url="https://i.loli.net/2020/11/27/Eym3zR8bX1FpcxT.png" type="image/png"/>
    </item>
    <item>
      <title>logbackè‡ªå®šä¹‰æ—¥å¿—æ ¼å¼ï¼Œä»¥jsonæ ¼å¼ä¸ºä¾‹</title>
      <link>https://kkwalking.github.com/person-database/person-database/java/logback-custom-log-formattion.html</link>
      <guid>https://kkwalking.github.com/person-database/person-database/java/logback-custom-log-formattion.html</guid>
      <source url="https://kkwalking.github.com/person-database/person-database/rss.xml">logbackè‡ªå®šä¹‰æ—¥å¿—æ ¼å¼ï¼Œä»¥jsonæ ¼å¼ä¸ºä¾‹</source>
      <description>æ‹‰ä¸ªStar å¦‚æœæœ¬çŸ¥è¯†åº“çš„å†…å®¹å¸®åŠ©åˆ°ä½ ï¼Œè¿˜è¯·ç‚¹ä¸ªå…è´¹çš„Starï¼Œæ„Ÿè°¢ã€‚ä¼ é€é—¨ï¼šGitHub ã€åç«¯å¼€å‘ã€‘logbackè‡ªå®šä¹‰æ—¥å¿—æ ¼å¼ï¼Œä»¥jsonæ ¼å¼ä¸ºä¾‹ ä¸€ã€èƒŒæ™¯ åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æœ‰æ—¶å€™ä¼šé‡åˆ°éœ€è¦æŒ‡å®šæ—¥å¿—æ ¼å¼çš„åœºæ™¯ï¼Œæ¯”å¦‚é¡¹ç›®çš„æ—¥å¿—æ¥å…¥äº†åœ¨çº¿æ—¥å¿—æ”¶é›†ç³»ç»Ÿï¼Œè¯¥æ”¶é›†ç³»ç»Ÿè¦æ±‚æ—¥å¿—éœ€è¦æ»¡è¶³å…¶æŒ‡å®šçš„æ—¥å¿—æ ¼å¼æ‰ä¼šè¢«æ”¶é›†ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘å°±ä»¥æ‰“å°jsonæ ¼å¼çš„æ—¥å¿—ä¸ºä¾‹...</description>
      <pubDate>Tue, 12 Mar 2024 00:00:00 GMT</pubDate>
      <content:encoded><![CDATA[<div class="hint-container tip">
<p class="hint-container-title">æ‹‰ä¸ªStar</p>
<ul>
<li>å¦‚æœ<a href="https://github.com/kkwalking/person-database" target="blank">æœ¬çŸ¥è¯†åº“</a>çš„å†…å®¹å¸®åŠ©åˆ°ä½ ï¼Œè¿˜è¯·ç‚¹ä¸ªå…è´¹çš„Starï¼Œæ„Ÿè°¢ã€‚ä¼ é€é—¨ï¼š<a href="https://github.com/kkwalking/person-database" target="blank">GitHub</a></li>
</ul>
</div>
<h1>ã€åç«¯å¼€å‘ã€‘logbackè‡ªå®šä¹‰æ—¥å¿—æ ¼å¼ï¼Œä»¥jsonæ ¼å¼ä¸ºä¾‹</h1>
<h2>ä¸€ã€èƒŒæ™¯</h2>
<p>åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æœ‰æ—¶å€™ä¼šé‡åˆ°éœ€è¦æŒ‡å®šæ—¥å¿—æ ¼å¼çš„åœºæ™¯ï¼Œæ¯”å¦‚é¡¹ç›®çš„æ—¥å¿—æ¥å…¥äº†åœ¨çº¿æ—¥å¿—æ”¶é›†ç³»ç»Ÿï¼Œè¯¥æ”¶é›†ç³»ç»Ÿè¦æ±‚æ—¥å¿—éœ€è¦æ»¡è¶³å…¶æŒ‡å®šçš„æ—¥å¿—æ ¼å¼æ‰ä¼šè¢«æ”¶é›†ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°±ä»¥æ‰“å°jsonæ ¼å¼çš„æ—¥å¿—ä¸ºä¾‹ï¼Œå‘å„ä½åˆ†äº«ä¸¤ç§æ–¹æ¡ˆã€‚</p>
<h2>äºŒã€æ–¹æ¡ˆ</h2>
<h3>2.1 æ–¹æ¡ˆ1</h3>
<p>é€šè¿‡æŒ‡å®šencoderçš„å…·ä½“ç±»ä¸ºnet.logstash.logback.encoder.LoggingEventCompositeJsonEncoderç±»ï¼Œåœ¨patternä¸­å¯ä»¥æ‰“å°æŒ‡å®šæ ¼å¼çš„æ—¥å¿—ã€‚</p>
<p>patternä¸­çš„å˜é‡æ ¼å¼æœ‰ä¸‰ç±»ã€‚ä¸€ç±»æ˜¯logbackè‡ªå®šä¹‰çš„è¯¸å¦‚%levelç­‰ï¼Œä¸€ç±»æ˜¯å¦‚${app_name}è¿™æ ·æˆ‘ä»¬å®šä¹‰åœ¨logback.xmlä¸­çš„propertiesã€‚è¿˜æœ‰ä¸€ç±»å½¢å¦‚%X{variable_name}æ˜¯é€šè¿‡åœ¨ä»£ç ä¸­è®¾ç½®è¿›MDCå˜é‡çš„ï¼Œå…³äºMDCçš„ä½¿ç”¨æœ¬æ–‡å°±ä¸å±•å¼€äº†ï¼Œæ„Ÿå…´è¶£è¯·è‡ªè¡Œæœç´¢ã€‚</p>
<p>ç›´æ¥showå‡ºå¯ç”¨çš„logbacké…ç½®ä»£ç ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªappenderçš„ç¤ºä¾‹ä»£ç </p>
<div class="language-xml" data-ext="xml" data-title="xml"><pre class="language-xml"><code>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>your-appender-name<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>File</span><span class="token punctuation">&gt;</span></span>${log_path}/${app_name}-${currentTime}.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>File</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>append</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>append</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">&gt;</span></span>INFO<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">&gt;</span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">&gt;</span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>${log_path}/${app_name}-%d{yyyyMMdd}-%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">&gt;</span></span>${logback.file.maxHistory}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>${logback.file.maxFileSize}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>totalSizeCap</span><span class="token punctuation">&gt;</span></span>${logback.file.totalSizeCap}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>totalSizeCap</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">&gt;</span></span>
        
        <span class="token comment">&lt;!-- æ‰“å°jsonæ ¼å¼ï¼Œè¯·é‡ç‚¹çœ‹è¿™é‡Œ--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>providers</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>
                         <span class="token comment">&lt;!--ä¸‹é¢å®šä¹‰å‡ºä¸€ä¸ªjsonæ ¼å¼çš„æ¶ˆæ¯ï¼Œä»…åšç¤ºä¾‹--&gt;</span>
                        <span class="token comment">&lt;!--å…·ä½“çš„ä¿¡æ¯æ ¼å¼è¯·æ ¹æ®ä½ çš„éœ€æ±‚è€Œå®š--&gt;</span>
                        {
                        "app_name": "${app_name}_info",
                        "level": "%level",
                        "log_time": "%date{\"yyyy-MM-dd HH:mm:ss.SSS\"}",
                        <span class="token comment">&lt;!--   "logger": "%logger",  %loggeræ‰“å°loggeråå­—ï¼Œ %classæ‰“å°å…·ä½“ç±»å--&gt;</span>
                        "logger": "%class",
                        "transaction_id": "%X{transaction_id}",
                        "address": "%X{address}",
                        "response_headers": "%X{response_headers}",
                        "response_payload": "%X{response_payload}",
                        "response_code": "%X{response_code}"
                        }
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>providers</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><h3>2.2 æ–¹æ¡ˆ2</h3>
<p>å¦ä¸€ç§æ‰“å°è‡ªå®šä¹‰æ ¼å¼çš„æ–¹æ³•åˆ™æ˜¯é€šè¿‡ä»£ç å¤„ç†ã€‚</p>
<ol>
<li>é¦–å…ˆï¼Œç»§æ‰¿<code>ch.qos.logback.core.LayoutBase&lt;ILoggingEvent&gt;</code>ï¼Œå¹¶é‡å†™doLayout(ILoggingEvent event)æ–¹æ³•</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProgramLayout</span> <span class="token keyword">extends</span> <span class="token class-name">LayoutBase</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ILoggingEvent</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å‚æ•°ï¼Œåç»­å¯ä»¥åœ¨logback.xmlä¸­ä¼ å…¥</span>
    <span class="token keyword">protected</span> <span class="token class-name">String</span> appName<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ProgramLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * è¦†ç›–è¯¥æ–¹æ³•ï¼Œå¯ä»¥å®šåˆ¶éœ€è¦çš„æ—¥å¿—æ ¼å¼
     * <span class="token keyword">@param</span> <span class="token parameter">event</span> The event to format
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">doLayout</span><span class="token punctuation">(</span><span class="token class-name">ILoggingEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ProgramLogParam</span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProgramLogParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">setApp_name</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>appName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">setLevel</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">setLogger</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getLoggerName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">setLog_time</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Timestamp</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getTimeStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">setTransaction_id</span><span class="token punctuation">(</span><span class="token class-name">MDCUtil</span><span class="token punctuation">.</span><span class="token function">getTransactionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// é€šè¿‡event.getFormattedMessage()å°±å¯ä»¥è·å–åˆ°æºæ¶ˆæ¯</span>
        <span class="token class-name">String</span> message <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getFormattedMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getThrowableProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">ExtendedThrowableProxyConverter</span> throwableConverter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExtendedThrowableProxyConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            throwableConverter<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            message <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getFormattedMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span> <span class="token operator">+</span> throwableConverter<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
            throwableConverter<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

		<span class="token comment">// å¦‚æœæ‰“å°çš„æºæ—¥å¿—æ¶ˆæ¯å°±åŒ…å«jsonæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œåˆ™æˆªå–è¯¥éƒ¨åˆ†æ¶ˆæ¯ä½œä¸ºcode_message</span>
        <span class="token keyword">int</span> beginIndex <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"{"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> endIndex <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"}"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>beginIndex <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> jsonMsg <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>beginIndex<span class="token punctuation">,</span> endIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
            params<span class="token punctuation">.</span><span class="token function">setCode_message</span><span class="token punctuation">(</span>jsonMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            params<span class="token punctuation">.</span><span class="token function">setCode_message</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">CoreConstants</span><span class="token punctuation">.</span><span class="token constant">LINE_SEPARATOR</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ProgramLogParamæ˜¯ä¸ªbeanï¼Œæˆ‘ç®€å•æ”¾ä¸€ä¸‹ï¼Œç”¨äº†lombokçš„æ³¨è§£ï¼Œæ–¹ä¾¿æŸ¥çœ‹</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProgramLogParam</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> app_name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> level<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> logger<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> log_time<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> code_message<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> transaction_id<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2">
<li>åœ¨logback.xmlåœ¨é…ç½®encoderçš„layoutä¸ºè¯¥ProgramLayoutï¼Œå³å¯è¾¾åˆ°æ‰“å°æŒ‡å®šæ—¥å¿—æ ¼å¼çš„ç›®çš„ã€‚</li>
</ol>
<div class="language-xml" data-ext="xml" data-title="xml"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TRANSACTION_INFO_FILE<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡æ¡£çš„è·¯å¾„åŠæ–‡æ¡£å --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">&gt;</span></span>${LOG_HOME}/${APP_NAME}_info-info.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--æ—¥å¿—æ–‡æ¡£è¾“å‡ºæ ¼å¼--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.encoder.LayoutWrappingEncoder<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.demo.log.layout.TransactionLayout<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!--ä¼ å…¥è‡ªå®šä¹‰å‚æ•°--&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appName</span><span class="token punctuation">&gt;</span></span>${APP_NAME}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appName</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>${LOG_HOME}/${APP_NAME}-%d{yyyy-MM-dd}.%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>1024MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">&gt;</span></span>info<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">&gt;</span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">&gt;</span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>
</code></pre></div>]]></content:encoded>
    </item>
    <item>
      <title>zzkçš„ä¸ªäººçŸ¥è¯†åº“</title>
      <link>https://kkwalking.github.com/person-database/person-database/home.html</link>
      <guid>https://kkwalking.github.com/person-database/person-database/home.html</guid>
      <source url="https://kkwalking.github.com/person-database/person-database/rss.xml">zzkçš„ä¸ªäººçŸ¥è¯†åº“</source>
      <description>æ‹‰ä¸ª Star å¦‚æœæœ¬çŸ¥è¯†åº“çš„å†…å®¹å¸®åŠ©åˆ°ä½ ï¼Œè¿˜è¯·ç‚¹ä¸ªå…è´¹çš„ Starï¼Œæ„Ÿè°¢ã€‚ä¼ é€é—¨ï¼šGitHub å¼€å‘ Redis æ“ä½œç³»ç»Ÿ è®¾è®¡æ¨¡å¼ åšå®¢</description>
      <pubDate>Thu, 07 Mar 2024 09:41:42 GMT</pubDate>
      <content:encoded><![CDATA[<div class="hint-container tip">
<p class="hint-container-title">æ‹‰ä¸ª Star</p>
<ul>
<li>å¦‚æœ<a href="https://github.com/kkwalking/person-database" target="blank">æœ¬çŸ¥è¯†åº“</a>çš„å†…å®¹å¸®åŠ©åˆ°ä½ ï¼Œè¿˜è¯·ç‚¹ä¸ªå…è´¹çš„ Starï¼Œæ„Ÿè°¢ã€‚ä¼ é€é—¨ï¼š<a href="https://github.com/kkwalking/person-database" target="blank">GitHub</a></li>
</ul>
</div>
<h2>å¼€å‘</h2>
<ul>
<li><a href="/person-database/java/dif-between-transactionlog-and-programlog.html" target="_blank">é¡¹ç›®æ—¥å¿—å»ºè®¾ä¹‹æµæ°´æ—¥å¿—å’Œç¨‹åºæ—¥å¿—çš„åŒºåˆ†</a></li>
<li><a href="/person-database/java/logback-custom-log-formattion.html" target="_blank">logback è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼ï¼Œä»¥ json æ ¼å¼ä¸ºä¾‹</a></li>
<li><a href="/person-database/java/distributed-lock-introduction.html" target="_blank">åˆ†å¸ƒå¼é”ç†è®ºä»‹ç»</a></li>
<li><a href="/person-database/java/how-to-write-a-distributed-lock.html" target="_blank">å¦‚ä½•å®ç°ä¸€ä¸ªåˆ†å¸ƒå¼é”</a></li>
<li><a href="/person-database/java/javafx-package-introduction.html" target="_blank">ä½¿ç”¨jlinkå’Œjpackageå¯¹javafxæ‰“åŒ…æˆå¯æ‰§è¡Œç¨‹åºå’Œå¯å®‰è£…ç¨‹åº</a></li>
<li><a href="/person-database/java/okhttp-conncection-pool-problem.html" target="_blank">OkHttpå¼€å¯çº¿ç¨‹æ± å¤ç”¨è¿æ¥å¯¼è‡´çš„EOFExceptionè§£å†³æ–¹æ¡ˆ</a></li>
</ul>
<h2>Redis</h2>
<ul>
<li><a href="/person-database/middleware/redis/redis-learn-string.html" target="_blank">Redis å­¦ä¹ ç¬”è®°ä¹‹å­—ç¬¦ä¸²</a></li>
<li><a href="/person-database/middleware/redis/redis-learn-list.html" target="_blank">Redis å­¦ä¹ ç¬”è®°ä¹‹é“¾è¡¨</a></li>
</ul>
<h2>æ“ä½œç³»ç»Ÿ</h2>
<ul>
<li><a href="/person-database/java/deadlock.html" target="_blank">å…³äºæ­»é”çš„ä¸€ç‚¹ç¬”è®°</a></li>
</ul>
<h2>è®¾è®¡æ¨¡å¼</h2>
<ul>
<li><a href="/person-database/java/about-singleton-pattern.html" target="_blank">æµ…è°ˆå•ä¾‹æ¨¡å¼</a></li>
</ul>
<h2>åšå®¢</h2>
<ul>
<li><a href="/person-database/blog/hexo-next.html" target="_blank">hexo æ­å»ºä¸ªäººåšå®¢+NexT ä¸»é¢˜</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>ä»‹ç»é¡µ</title>
      <link>https://kkwalking.github.com/person-database/person-database/intro.html</link>
      <guid>https://kkwalking.github.com/person-database/person-database/intro.html</guid>
      <source url="https://kkwalking.github.com/person-database/person-database/rss.xml">ä»‹ç»é¡µ</source>
      <description>ä»‹ç»é¡µ é—®æ¸ å“ªå¾—æ¸…å¦‚è®¸ï¼Œä¸ºæœ‰æºå¤´æ´»æ°´æ¥ã€‚ä¸€ä¸ªæ™®é€šçš„åç«¯ç¨‹åºå‘˜ã€‚</description>
      <pubDate>Thu, 07 Mar 2024 00:00:00 GMT</pubDate>
      <content:encoded><![CDATA[
<p>é—®æ¸ å“ªå¾—æ¸…å¦‚è®¸ï¼Œä¸ºæœ‰æºå¤´æ´»æ°´æ¥ã€‚ä¸€ä¸ªæ™®é€šçš„åç«¯ç¨‹åºå‘˜ã€‚</p>
]]></content:encoded>
    </item>
    <item>
      <title>å…³äºä½œè€…</title>
      <link>https://kkwalking.github.com/person-database/person-database/about-the-author/self-introduction.html</link>
      <guid>https://kkwalking.github.com/person-database/person-database/about-the-author/self-introduction.html</guid>
      <source url="https://kkwalking.github.com/person-database/person-database/rss.xml">å…³äºä½œè€…</source>
      <description>ä¸»è¦æŒæ¡è¯­è¨€æ˜¯Javaï¼Œå¯¹å†™ä¸€äº›æ¡Œé¢å·¥å…·è½¯ä»¶ä¹Ÿå¾ˆæ„Ÿå…´è¶£ï¼Œç›®å‰æ­£åœ¨å†™ä¸€ä¸ªRedis GUI</description>
      <pubDate>Thu, 07 Mar 2024 00:00:00 GMT</pubDate>
      <content:encoded><![CDATA[<p>ä¸»è¦æŒæ¡è¯­è¨€æ˜¯Javaï¼Œå¯¹å†™ä¸€äº›æ¡Œé¢å·¥å…·è½¯ä»¶ä¹Ÿå¾ˆæ„Ÿå…´è¶£ï¼Œç›®å‰æ­£åœ¨å†™ä¸€ä¸ªRedis GUI</p>
]]></content:encoded>
    </item>
    <item>
      <title>é¡¹ç›®æ—¥å¿—å»ºè®¾ä¹‹æµæ°´æ—¥å¿—å’Œç¨‹åºæ—¥å¿—çš„åŒºåˆ†</title>
      <link>https://kkwalking.github.com/person-database/person-database/java/dif-between-transactionlog-and-programlog.html</link>
      <guid>https://kkwalking.github.com/person-database/person-database/java/dif-between-transactionlog-and-programlog.html</guid>
      <source url="https://kkwalking.github.com/person-database/person-database/rss.xml">é¡¹ç›®æ—¥å¿—å»ºè®¾ä¹‹æµæ°´æ—¥å¿—å’Œç¨‹åºæ—¥å¿—çš„åŒºåˆ†</source>
      <description>æ‹‰ä¸ªStar å¦‚æœæœ¬çŸ¥è¯†åº“çš„å†…å®¹å¸®åŠ©åˆ°ä½ ï¼Œè¿˜è¯·ç‚¹ä¸ªå…è´¹çš„Starï¼Œæ„Ÿè°¢ã€‚ä¼ é€é—¨ï¼šGitHub é¡¹ç›®æ—¥å¿—å»ºè®¾ä¹‹æµæ°´æ—¥å¿—å’Œç¨‹åºæ—¥å¿—çš„åŒºåˆ† æœ€è¿‘é¡¹ç›®è¦æ±‚å¯¹ç¨‹åºæ—¥å¿—è¿›è¡Œä¸¤ç±»åŒºåˆ†ï¼Œå°†æ—¥å¿—å¤§ä½“è®°å½•ä¸ºæµæ°´æ—¥å¿—å’Œç¨‹åºæ—¥å¿—ã€‚ æ‰€è°“æµæ°´æ—¥å¿—ï¼Œæ›´è¯¦ç»†çš„è¯´æ˜¯è¯·æ±‚å“åº”æµæ°´æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯ç³»ç»Ÿæ‰§è¡Œçš„webè¯·æ±‚ã€å“åº”çš„å†…å®¹ã€‚å…¶ä¸»è¦æ–¹é¢ä¸€èˆ¬åŒ…æ‹¬åç«¯æ¥å£è°ƒç”¨ã€åç«¯è°ƒç”¨å…¶ä»–æœåŠ¡æ¥å£çš„è¯·æ±‚ä¸...</description>
      <category>é¡¹ç›®å®è·µ</category>
      <pubDate>Fri, 08 Mar 2024 00:00:00 GMT</pubDate>
      <content:encoded><![CDATA[<div class="hint-container tip">
<p class="hint-container-title">æ‹‰ä¸ªStar</p>
<ul>
<li>å¦‚æœ<a href="https://github.com/shzyjbr/person-database" target="blank">æœ¬çŸ¥è¯†åº“</a>çš„å†…å®¹å¸®åŠ©åˆ°ä½ ï¼Œè¿˜è¯·ç‚¹ä¸ªå…è´¹çš„Starï¼Œæ„Ÿè°¢ã€‚ä¼ é€é—¨ï¼š<a href="https://github.com/shzyjbr/person-database" target="blank">GitHub</a></li>
</ul>
</div>
<h1>é¡¹ç›®æ—¥å¿—å»ºè®¾ä¹‹æµæ°´æ—¥å¿—å’Œç¨‹åºæ—¥å¿—çš„åŒºåˆ†</h1>
<p>æœ€è¿‘é¡¹ç›®è¦æ±‚å¯¹ç¨‹åºæ—¥å¿—è¿›è¡Œä¸¤ç±»åŒºåˆ†ï¼Œå°†æ—¥å¿—å¤§ä½“è®°å½•ä¸ºæµæ°´æ—¥å¿—å’Œç¨‹åºæ—¥å¿—ã€‚</p>
<p>æ‰€è°“æµæ°´æ—¥å¿—ï¼Œæ›´è¯¦ç»†çš„è¯´æ˜¯è¯·æ±‚å“åº”æµæ°´æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯ç³»ç»Ÿæ‰§è¡Œçš„webè¯·æ±‚ã€å“åº”çš„å†…å®¹ã€‚å…¶ä¸»è¦æ–¹é¢ä¸€èˆ¬åŒ…æ‹¬åç«¯æ¥å£è°ƒç”¨ã€åç«¯è°ƒç”¨å…¶ä»–æœåŠ¡æ¥å£çš„è¯·æ±‚ä¸å“åº”æ—¥å¿—ã€‚å¦‚æœé¡¹ç›®æœ‰å¯¹å¤–å‘å…¶ä»–ç³»ç»Ÿæš´éœ²æœåŠ¡ï¼Œé‚£ä¹ˆè¿˜éœ€è¦åŒ…æ‹¬å…¶ä»–æœåŠ¡è°ƒç”¨æœ¬ç³»ç»Ÿæ¥å£çš„è¯·æ±‚å“åº”æ—¥å¿—ã€‚</p>
<p>è€Œç¨‹åºæ—¥å¿—åˆ™æ˜¯æˆ‘ä»¬åŸæ¥ç†ŸçŸ¥çš„åœ¨ç¨‹åºä¸­è®°å½•çš„ä¸€äº›å¸¸è§„æ—¥å¿—ï¼Œå¦‚è®°å½•å¼‚å¸¸è¯·æ±‚å¤„ç†ã€è¿è¡Œä¸­ä¸€äº›åŠ©äºæ’æŸ¥çš„ä¿¡æ¯è®°å½•ç­‰ï¼Œå¯ä»¥è¯´æ˜¯é™¤äº†æµæ°´æ—¥å¿—å¤–çš„å…¶ä»–æ—¥å¿—ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œåœ¨åŒºåˆ†æµæ°´æ—¥å¿—å’Œç¨‹åºæ—¥å¿—çš„åŸºç¡€ä¸Šï¼Œè¿˜å¸Œæœ›å°†debugã€infoã€warnã€errorç­‰ä¸åŒçº§åˆ«çš„æ—¥å¿—å†™å…¥ä¸åŒçš„æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œæ–¹ä¾¿æŸ¥çœ‹ã€‚</p>
<h2>å¦‚ä½•å»åšè¿™æ ·çš„ä¸€ä¸ªæ—¥å¿—åŒºåˆ†å‘¢ï¼Ÿ</h2>
<p>åœ¨åŠ¨æ‰‹ç¼–å†™æ—¥å¿—é…ç½®æ–‡ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥å¤§æ¦‚è®¾æƒ³ä¸€ä¸‹æˆ‘ä»¬éœ€è¦çš„æ—¥å¿—æ–‡ä»¶ç»“æ„ã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒæŒ‰ç…§ä»¥ä¸Šè¦æ±‚ï¼Œå¯¹äºæµæ°´æ—¥å¿—ï¼Œæˆ‘ä»¬éœ€è¦å†…å®¹ä¸ºæµæ°´ç±»å‹ä¸”æ—¥å¿—çº§åˆ«ä¸ºinfoçš„æ—¥å¿—æ–‡ä»¶ï¼Œ..., å†…å®¹ä¸ºæµæ°´ç±»å‹ä¸”æ—¥å¿—çº§åˆ«ä¸ºerrorçš„æ—¥å¿—æ–‡ä»¶ã€‚ä¸ºæ–¹ä¾¿åç»­æè¿°ï¼Œæˆ‘ä»¬å¯ä»¥å°†æµæ°´ç”¨transactionè¡¨ç¤ºï¼Œç¨‹åºç”¨programè¡¨ç¤ºã€‚æ—¥å¿—å‘½åæ ¼å¼ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨<code>é¡¹ç›®å_æ—¥å¿—ç±»å‹-æ—¥å¿—çº§åˆ«-æ—¥æœŸ.log</code>æ¥å‘½åã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæœ‰ä¸€ä¸ªé¡¹ç›®åä¸ºxxx-gatewayï¼Œé‚£ä¹ˆè¿™ä¸ªé¡¹ç›®åœ¨2023å¹´8æœˆ29æ—¥è¿™å¤©çš„infoçº§åˆ«çš„æµæ°´æ—¥å¿—ï¼Œå¯ä»¥å‘½åä¸º<code>xxx-gateway_transaction-info-2023-08-29.log</code>ï¼ŒåŒç†è¿˜æœ‰<code>xxx-gateway_transaction-debug-2023-08-29.log</code>ã€<code>xxx-gateway_transaction-warn-2023-08-29.log</code>å’Œ<code>xxx-gateway_transaction-error-2023-08-29.log</code>ã€‚å¯¹äºç¨‹åºæ—¥å¿—åˆ™æœ‰<code>xxx-gateway_program-info-2023-08-29.log</code>ã€<code>xxx-gateway_program-warn-2023-08-29.log</code>ç­‰ï¼Œå…¶ä»–ä¸å†åˆ—ä¸¾ã€‚
æ€»ç»“ä¸€ä¸‹ï¼Œå‡è®¾æ—¥å¿—ç›®å½•ä¸ºlogsï¼Œæ–‡ä»¶ç»“æ„å¦‚ä¸‹:</p>
<div class="language-C" data-ext="C" data-title="C"><pre class="language-C"><code>-logs
    - xxx-gateway_transaction-debug-2023-08-29.log
    - xxx-gateway_transaction-info-2023-08-29.log
    - xxx-gateway_transaction-warn-2023-08-29.log
    - xxx-gateway_transaction-error-2023-08-29.log
    - xxx-gateway_program-error-2023-08-29.log
    - xxx-gateway_program-info-2023-08-29.log
    - xxx-gateway_program-warn-2023-08-29.log
    - xxx-gateway_program-error-2023-08-29.log
</code></pre></div><p>æœ¬æ–‡é‡‡ç”¨çš„æ—¥å¿—æ¡†æ¶æ˜¯logbackï¼Œåœ¨Spring Booté¡¹ç›®ä¸­æ­é…ä½¿ç”¨ã€‚</p>
<h2>å…·ä½“åšæ³•</h2>
<h3>1. å®šä¹‰appender</h3>
<p>æ ¹æ®ä»¥ä¸Šæ€è·¯ï¼Œæˆ‘ä»¬éœ€è¦åœ¨logbacké…ç½®æ–‡ä»¶ï¼ˆæœ¬æ–‡æ˜¯logback-spring.xmlï¼‰ä¸­é…ç½®å…«ä¸ªappenderæ¥å®ç°å‘ä¸Šè¿°å…«ä¸ªä¸åŒæ—¥å¿—æ–‡ä»¶å†™å…¥ä¸åŒæ—¥å¿—çº§åˆ«çš„æ—¥å¿—è®°å½•ã€‚</p>
<p>ä»¥å†™å…¥<code>xxx-gateway_transaction-info-2023-08-29.log</code>çš„appenderä¸ºä¾‹ï¼Œæˆ‘ä»¬æ‹†è§£ä¸€ä¸‹è¿™æ ·ä¸€ä¸ªappenderéœ€è¦ä»€ä¹ˆé…ç½®ï¼Œç›¸å…³çš„æ³¨é‡Šæˆ‘éƒ½æ ‡æ³¨åœ¨ä»£ç ä¸Šäº†</p>
<div class="language-xml" data-ext="xml" data-title="xml"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TRANSACTION_INFO_FILE<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- æ­£åœ¨è®°å½•çš„æ—¥å¿—æ–‡æ¡£çš„è·¯å¾„åŠæ–‡æ¡£å --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">&gt;</span></span>${LOG_HOME}/${APP_NAME}_transaction-info.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--æ—¥å¿—æ–‡æ¡£è¾“å‡ºæ ¼å¼--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.encoder.LayoutWrappingEncoder<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxx.gateway.log.layout.TransactionLayout<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appName</span><span class="token punctuation">&gt;</span></span>${APP_NAME}_info<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appName</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- è®¾ç½®å­—ç¬¦é›† --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- æ—¥å¿—è®°å½•å™¨çš„æ»šåŠ¨ç­–ç•¥ï¼ŒæŒ‰æ—¥æœŸï¼ŒæŒ‰å¤§å°è®°å½• --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- æ¯å¤©æ—¥å¿—å½’æ¡£è·¯å¾„ä»¥åŠæ ¼å¼ --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>${LOG_HOME}/${APP_NAME}-info-%d{yyyy-MM-dd}.%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>timeBasedFileNamingAndTriggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>1024MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>timeBasedFileNamingAndTriggeringPolicy</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--æ—¥å¿—æ–‡æ¡£ä¿ç•™å¤©æ•°--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- æ­¤æ—¥å¿—æ–‡æ¡£åªè®°å½•infoçº§åˆ«çš„ --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ch.qos.logback.classic.filter.LevelFilter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>level</span><span class="token punctuation">&gt;</span></span>info<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>level</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMatch</span><span class="token punctuation">&gt;</span></span>ACCEPT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMatch</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>onMismatch</span><span class="token punctuation">&gt;</span></span>DENY<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>onMismatch</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>&lt;appender&gt;</code>:æˆ‘å°†è¿™ä¸ªappenderå‘½åä¸ºTRANSACTION_INFO_FILEï¼Œè¡¨ç¤ºå®ƒæ˜¯ç”¨æ¥å†™å…¥è¯·æ±‚å“åº”æµæ°´æ—¥å¿—ä¸”ä¸ºinfoçº§åˆ«çš„æ—¥å¿—æ–‡ä»¶ã€‚classé€‰æ‹©logbackæä¾›çš„ä¸€ä¸ªç±»ï¼Œè¯¥ç±»å¯ä»¥è¿›è¡Œæ—¥å¿—æ–‡ä»¶çš„æ»šåŠ¨æ›´æ–°ã€‚æ‰€è°“æ»šåŠ¨æ›´æ–°ç”¨å¤§ç™½è¯è§£é‡Šå°±æ˜¯ï¼Œæ€ä¹ˆåˆ†å‰²å½’æ¡£æ–‡ä»¶ã€‚ä¸»è¦çœ‹<code>&lt;rollingPolicy&gt;</code>ä¸­çš„é…ç½®,å½“å‰ä¾‹å­æ˜¯%d{yyyy-MM-dd}ï¼Œä¹Ÿå°±æ˜¯æŒ‰ä¸åŒçš„æ—¥æœŸè¿›è¡Œå½’æ¡£ï¼ˆ%iä½œç”¨æ˜¯å½“æ–‡ä»¶å¤§å°å¤ªå¤§åˆ™æŒ‰1024MBåˆ†å‰²å‡ºæ–‡ä»¶è¿›è¡Œæ ‡å·ï¼‰</p>
<p><code>&lt;File&gt;</code>æ ‡ç­¾ä¸­çš„${LOG_HOME}è¿™äº›éƒ½æ˜¯è‡ªå®šä¹‰çš„å˜é‡ï¼Œæ¯”å¦‚æˆ‘çš„é¡¹ç›®çš„LOG_HOMEå°±æ˜¯logsï¼Œ${APP_NAME}å°±æ˜¯é¡¹ç›®åç§°ï¼Œæ¯”å¦‚åœ¨è¿™é‡Œå°±æ˜¯xxx-gatewayï¼Œå› æ­¤ç»„åˆèµ·æ¥çš„æ–‡ä»¶å‘½åæ ¼å¼å°±æ˜¯ä¸Šæ–‡æè¿°çš„æ ¼å¼ã€‚</p>
<p><code>&lt;encoder&gt;</code>ç”¨æ¥è‡ªå®šä¹‰ä¸€æ¡æ—¥å¿—æ‰“å°çš„å…·ä½“æ ¼å¼ï¼Œåœ¨è¿™é‡Œä¸å†å±•å¼€ï¼Œè¿™é‡Œæœ‰æˆ‘å†™çš„ä¸€ç¯‡å…³äºè‡ªå®šä¹‰æ—¥å¿—æ ¼å¼çš„æ–‡ç« :<a href="./logback-custom-log-formattion" target="blank">logbackè‡ªå®šä¹‰æ—¥å¿—æ ¼å¼ï¼Œä»¥jsonæ ¼å¼ä¸ºä¾‹</a>ï¼Œå¯ä»¥å‚è€ƒã€‚</p>
<p><code>&lt;rollingPolicy&gt;</code>æ ‡ç­¾ä½¿ç”¨åˆ°logbackæä¾›çš„TimeBasedRollingPolicyï¼Œè¿™æ„å‘³ç€æ—¥å¿—æ–‡ä»¶å°†æ ¹æ®å¤§å°å’Œæ—¶é—´é™åˆ¶è¿›è¡Œæ»šåŠ¨ã€‚<code>&lt;fileNamePattern&gt;</code>æŒ‡å®šæ»šåŠ¨çš„æ—¶å€™æ–‡ä»¶åçš„æ ¼å¼ï¼Œ<code>&lt;timeBasedFileNamingAndTriggeringPolicy&gt;</code>ç”¨äºæ§åˆ¶æ—¥å¿—æ–‡ä»¶å¤§å°åˆ°è¾¾æŸä¸€é˜ˆå€¼éœ€è¦è¿›è¡Œåˆ‡åˆ†ã€‚<code>&lt;maxHistory&gt;</code>ç”¨äºæ§åˆ¶å½’æ¡£çš„æ—¥å¿—ç•™å­˜çš„æ—¶é•¿ï¼Œå•ä½æ˜¯å¤©ã€‚</p>
<p><code>&lt;filter&gt;</code>è¡¨è¾¾çš„æ„ä¹‰æ˜¯è¿™æ˜¯ä¸€ä¸ªåªæ¥å—INFOçº§åˆ«æ—¥å¿—äº‹ä»¶çš„çº§åˆ«ç­›é€‰å™¨ã€‚å¯¹äºä»»ä½•éINFOçº§åˆ«çš„æ—¥å¿—äº‹ä»¶éƒ½å°†è¢«æ‹’ç»ã€‚</p>
<p>å› æ­¤ï¼Œè¿™ä¸ªappenderåšçš„äº‹æƒ…å°±æ˜¯ï¼Œå®šä¹‰äº†è¯·æ±‚å“åº”æµæ°´æ—¥å¿—ä¸”æ—¥å¿—çº§åˆ«ä¸ºinfoçš„æ—¥å¿—è¦è¾“å‡ºåˆ°<code>${LOG_HOME}/${APP_NAME}_transaction-info.log</code>è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚æ»šåŠ¨ç­–ç•¥æ˜¯å…ˆæ ¹æ®æ—¥æœŸå°†æ—¥å¿—è®°å½•åˆ°ä¸åŒçš„æ–‡ä»¶ä¸­ï¼Œç„¶åæ ¹æ®æ–‡ä»¶å¤§å°æ»šåŠ¨æ¯ä¸ªæ—¥æœŸçš„æ—¥å¿—æ–‡ä»¶ã€‚è¿™æ ·å¯ä»¥å®ç°æŒ‰å¤©æ»šåŠ¨çš„åŸºç¡€ä¸Šï¼Œå†æ ¹æ®æ–‡ä»¶å¤§å°è¿›è¡Œæ»šåŠ¨çš„æ•ˆæœã€‚æ—¥å¿—å¸ƒå±€ä¹Ÿå°±æ˜¯æ—¥å¿—çš„æ‰“å°æ ¼å¼é€šè¿‡com.xxx.gateway.log.layout.TransactionLayoutè¿›è¡Œè‡ªå®šä¹‰ã€‚</p>
<p>æŒ‰ç…§ä»¥ä¸Šåšæ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä¾è‘«èŠ¦ç”»ç“¢ï¼Œå®šä¹‰å‡ºå¦å¤–7ä¸ªappenderã€‚</p>
<h3>2. å®šä¹‰logger</h3>
<p>loggerç§°ä½œæ—¥å¿—è®°å½•å™¨ï¼Œç”¨äºå®šä¹‰æŸä¸€æ—¥å¿—è®°å½•å™¨çš„è¡Œä¸º
ä»¥ä¸‹é¢è¿™ä¸ªrootè®°å½•å™¨ä¸ºä¾‹</p>
<div class="language-xml" data-ext="xml" data-title="xml"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span> <span class="token attr-name">additivity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PROGRAM_INFO_FILE<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PROGRAM_WARN_FILE<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PROGRAM_ERROR_FILE<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>STDOUT<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul>
<li>level: æŒ‡å®šrootæ—¥å¿—è®°å½•å™¨çš„æ—¥å¿—çº§åˆ«ä¸º"info"ã€‚è¿™æ„å‘³ç€rootæ—¥å¿—è®°å½•å™¨å°†è®°å½•æ‰€æœ‰"info"çº§åˆ«åŠä»¥ä¸Šçš„æ—¥å¿—æ¶ˆæ¯ï¼Œè€Œä½äº"info"çº§åˆ«çš„æ¶ˆæ¯å°†è¢«å¿½ç•¥ã€‚æ³¨æ„ï¼è¿™é‡Œæ˜¯infoåŠä»¥ä¸Šï¼</li>
<li>additivity: æ˜¯å¦å¯ç”¨æ—¥å¿—äº‹ä»¶çš„ä¼ æ’­ã€‚å¦‚æœè®¾ç½®ä¸º"false"ï¼Œåˆ™rootæ—¥å¿—è®°å½•å™¨çš„æ—¥å¿—æ¶ˆæ¯å°†åªè¢«å‘é€åˆ°æŒ‡å®šçš„appenderï¼Œå¹¶ä¸ä¼šä¼ æ’­åˆ°å…¶ä»–æ—¥å¿—è®°å½•å™¨ã€‚å¦‚æœè®¾ç½®ä¸º"true"ï¼Œåˆ™æ—¥å¿—æ¶ˆæ¯å°†ä¼ æ’­ç»™å…¶ä»–é€‚ç”¨çš„æ—¥å¿—è®°å½•å™¨ï¼Œä¹Ÿå°±æ˜¯ä¸€æ¡æ—¥å¿—è¢«rootæ—¥å¿—è®°å½•å™¨æ¶ˆè´¹æ‰äº†ï¼Œç‹¬å ã€‚</li>
<li>appender-ref: å¼•ç”¨äº†å››ä¸ªä¸åŒçš„appenderï¼Œåˆ†åˆ«æ˜¯"PROGRAM_INFO_FILE"ã€"PROGRAM_WARN_FILE"ã€"PROGRAM_ERROR_FILE"å’Œ"STDOUT"ã€‚è¿™äº›å¼•ç”¨å®šä¹‰äº†å°†æ—¥å¿—æ¶ˆæ¯å‘é€åˆ°å“ªäº›appenderè¿›è¡Œè®°å½•ã€‚ä¹Ÿå°±æ˜¯ä¸€æ¡æ¶ˆæ¯ä¼šè¢«å‘å¾€è¿™å››ä¸ªappender,è¿™äº›appenderä¼šæ ¹æ®è‡ªå·±çš„é…ç½®å»å†³å®šæ˜¯å¦è®°å½•è¯¥æ—¥å¿—ã€‚</li>
</ul>
<p>ä»¥ä¸Šè¿™ä¸ªæ—¥å¿—è®°å½•å™¨å°±å¯ä»¥ä½œä¸ºæˆ‘ä»¬é¡¹ç›®ä¸­çš„ç¨‹åºæ—¥å¿—è®°å½•å™¨ï¼Œé€šå¸¸æˆ‘ä»¬åœ¨ç±»ä¸­é€šè¿‡<code>private static Logger log = org.slf4j.LoggerFactory.getLogger(AnyExample.class);</code>å®šä¹‰å‡ºæ¥çš„logå¯¹è±¡å°±ä¼šä½¿ç”¨åˆ°è¿™ä¸ªæ—¥å¿—è®°å½•å™¨ï¼ŒåŒ…æ‹¬ä½¿ç”¨@Slf4jæ³¨è§£ä¹Ÿä¸€æ ·ã€‚</p>
<p>è€Œé’ˆå¯¹æµæ°´æ—¥å¿—è®°å½•å™¨ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>
<div class="language-xml" data-ext="xml" data-title="xml"><pre class="language-xml"><code>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>web_transaction_logger<span class="token punctuation">"</span></span> <span class="token attr-name">additivity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>info<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TRANSACTION_INFO_FILE<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TRANSACTION_WARN_FILE<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TRANSACTION_ERROR_FILE<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>STDOUT<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logger</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>è¯¥logger å¤šäº†ä¸€ä¸ªåå­—ï¼Œä¹Ÿå°±æ˜¯"web_transaction_logger"ã€‚åœ¨ä»£ç ä¸­ï¼Œå½“æˆ‘ä»¬éœ€è¦è®°å½•æµæ°´æ—¥å¿—æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è¿™æ ·å¼•ç”¨è¯¥logger:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="language-java"><code>    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> transactionlogger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token string">"web_transaction_logger"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å°†ç¨‹åºæ—¥å¿—å’Œæµæ°´æ—¥å¿—è¿›è¡Œäº†åŒºåˆ†ã€‚
è¿™ç§é…ç½®çš„ä¸€ä¸ªå¥½å¤„æ˜¯å¯ä»¥æ— ä¾µå…¥åœ°åœ¨æ—§æœ‰é¡¹ç›®ä¸Šå¯¹ç¨‹åºæ—¥å¿—å’Œæµæ°´æ—¥å¿—è¿›è¡ŒåŒºåˆ†ã€‚åŸå…ˆä»£ç ä¸­æ‰“æ—¥å¿—çš„åœ°æ–¹ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ä¸åšæ”¹åŠ¨ï¼Œé»˜è®¤ä½œä¸ºç¨‹åºæ—¥å¿—ï¼Œè€Œé’ˆå¯¹webè¯·æ±‚å“åº”ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¯¸å¦‚filterç­‰åœ°æ–¹ä½¿ç”¨web_transaction_loggerè¿›è¡Œè®°å½•ã€‚</p>
]]></content:encoded>
    </item>
    <item>
      <title>å…³äºåˆ†äº«å†…å®¹</title>
      <link>https://kkwalking.github.com/person-database/person-database/life/comeon.html</link>
      <guid>https://kkwalking.github.com/person-database/person-database/life/comeon.html</guid>
      <source url="https://kkwalking.github.com/person-database/person-database/rss.xml">å…³äºåˆ†äº«å†…å®¹</source>
      <description>åˆ†äº«å†…å®¹ ç”Ÿæ´»åˆ†äº«çš„å†…å®¹å†™åœ¨è¿™é‡Œ</description>
      <pubDate>Thu, 07 Mar 2024 00:00:00 GMT</pubDate>
      <content:encoded><![CDATA[<h2>åˆ†äº«å†…å®¹</h2>
<p>ç”Ÿæ´»åˆ†äº«çš„å†…å®¹å†™åœ¨è¿™é‡Œ</p>
]]></content:encoded>
    </item>
  </channel>
</rss>